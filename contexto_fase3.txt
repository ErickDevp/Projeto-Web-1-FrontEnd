<codebase>
  <file name='src\pages\Dashboard\Cartoes.tsx'>
import { useCartoes } from '../../hooks/useCartoes'
import PageHeader from '../../components/ui/PageHeader'
import { CartaoList } from '../../components/dashboard/cartoes/CartaoList'
import { CartaoFormModal } from '../../components/dashboard/cartoes/CartaoFormModal'

export default function Cartoes() {
  const {
    cards,
    programas,
    loading,
    isSaving,
    isFormOpen,
    editingCard,
    openNewForm,
    openEditForm,
    closeForm,
    saveCard,
    deleteCard,
  } = useCartoes()

  return (
    <section className="space-y-6">
      <PageHeader
        title="CartÃµes"
        description="Cadastre e acompanhe seus cartÃµes e programas de fidelidade."
      >
        <button
          type="button"
          onClick={openNewForm}
          className="btn-primary"
        >
          <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Novo cartÃ£o
        </button>
      </PageHeader>

      {/* Modal de FormulÃ¡rio */}
      <CartaoFormModal
        isOpen={isFormOpen}
        onClose={closeForm}
        onSave={saveCard}
        initialData={editingCard}
        programas={programas}
        isSaving={isSaving}
      />

      {/* Grid de CartÃµes */}
      <CartaoList
        cards={cards} // Mantenha "cards" se sua API retornar isso
        loading={loading}
        onEdit={openEditForm}
        onDelete={deleteCard}
      />
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\Configuracoes.tsx'>
import { useState } from 'react'
import { AppearanceSettings } from '../../components/dashboard/config/AppearanceSettings'
import { GeneralSettings } from '../../components/dashboard/config/GeneralSettings'
import { NotificationSettings } from '../../components/dashboard/config/NotificationSettings'
import { SecuritySettings } from '../../components/dashboard/config/SecuritySettings'

// Types
type TabId = 'appearance' | 'general' | 'notifications' | 'security'

type Tab = {
  id: TabId
  label: string
  icon: React.ReactNode
}

// Tab definitions
const tabs: Tab[] = [
  {
    id: 'appearance',
    label: 'AparÃªncia',
    icon: (
      <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M4.098 19.902a3.75 3.75 0 005.304 0l6.401-6.402M6.75 21A3.75 3.75 0 013 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 003.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008z" />
      </svg>
    ),
  },
  {
    id: 'general',
    label: 'Geral',
    icon: (
      <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    ),
  },
  {
    id: 'notifications',
    label: 'NotificaÃ§Ãµes',
    icon: (
      <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
      </svg>
    ),
  },
  {
    id: 'security',
    label: 'SeguranÃ§a',
    icon: (
      <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
      </svg>
    ),
  },
]

// Main Component
export default function Configuracoes() {
  const [activeTab, setActiveTab] = useState<TabId>('appearance')

  // Render tab content
  const renderTabContent = () => {
    switch (activeTab) {
      case 'appearance':
        return <AppearanceSettings />
      case 'general':
        return <GeneralSettings />
      case 'notifications':
        return <NotificationSettings />
      case 'security':
        return <SecuritySettings />
      default:
        return null
    }
  }

  return (
    <section className="space-y-6">
      <header>
        <h1 className="titulo-grafico text-2xl font-bold">ConfiguraÃ§Ãµes</h1>
        <p className="mt-1 text-sm text-fg-secondary">Personalize sua experiÃªncia no painel.</p>
      </header>

      <div className="grid gap-6 lg:grid-cols-[240px_1fr]">
        {/* Sidebar Navigation */}
        <nav className="dashboard-card !p-4 lg:!min-h-0 lg:h-fit">
          <ul className="space-y-1">
            {tabs.map((tab) => (
              <li key={tab.id}>
                <button
                  type="button"
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex w-full items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium transition-all duration-300 ${activeTab === tab.id
                    ? 'bg-gradient-to-r from-accent-sky/20 to-accent-pool/20 text-accent-pool'
                    : 'text-fg-secondary hover:bg-white/5 hover:text-fg-primary'
                    }`}
                >
                  {tab.icon}
                  {tab.label}
                </button>
              </li>
            ))}
          </ul>
        </nav>

        {/* Content Area */}
        <div className="flex-1">{renderTabContent()}</div>
      </div>
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\Dashboard.tsx'>
import type { ReactNode } from 'react'
import { useMemo } from 'react'
import { useOutletContext } from 'react-router-dom'

// Hooks
import { useDashboardData } from '../../hooks/useDashboardData'
import { useDashboardCalculations } from '../../hooks/useDashboardCalculations'
import { useDashboardExport } from '../../hooks/useDashboardExport'

// Components
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import { DashboardHeader } from '../../components/dashboard/dashboard/DashboardHeader'
import { DashboardStats } from '../../components/dashboard/dashboard/DashboardStats'
import { DashboardCards } from '../../components/dashboard/dashboard/DashboardCards'
import { PointsPerCardChart } from '../../components/dashboard/dashboard/PointsPerCardChart'
import { PointsPerMonthChart } from '../../components/dashboard/dashboard/PointsPerMonthChart'
import { PointsPerProgramChart } from '../../components/dashboard/dashboard/PointsPerProgramChart'
import { HistoryChart } from '../../components/dashboard/dashboard/HistoryChart'

type OutletContext = {
  searchTerm: string
}

type Block = {
  id: string
  title: string
  keywords: string
  content: ReactNode
}

export default function Dashboard() {
  const { searchTerm } = useOutletContext<OutletContext>()
  const normalizedSearch = searchTerm.trim().toLowerCase()

  const { cards, saldo, relatorio, loading } = useDashboardData()
  const {
    totalPoints,
    programSummary,
    pontosPorCartao,
    historico,
    monthlyPoints,
    historySeries,
  } = useDashboardCalculations({ relatorio, saldo })
  const { handleDownload } = useDashboardExport()

  const blocks = useMemo<Block[]>(() => {
    return [
      {
        id: 'saldo',
        title: 'PatrimÃ´nio & Metas',
        keywords: `saldo total pontos milhas patrimonio metas ${programSummary.map((item) => item.label).join(' ')}`,
        content: (
          <DashboardStats
            totalPoints={totalPoints}
            programSummary={programSummary}
            relatorio={relatorio}
          />
        ),
      },
      {
        id: 'cartoes',
        title: 'CartÃµes cadastrados',
        keywords: `cartoes cartÃµes ${cards.map((card) => card.nome ?? '').join(' ')}`,
        content: <DashboardCards cards={cards} />,
      },
      {
        id: 'pontos-cartao',
        title: 'Pontos por cartÃ£o',
        keywords: `pontos cartao cartÃ£o grafico barras ${pontosPorCartao.map((item) => item.nomeCartao).join(' ')}`,
        content: <PointsPerCardChart pontosPorCartao={pontosPorCartao} />,
      },
      {
        id: 'pontos-mes',
        title: 'Pontos por mÃªs',
        keywords: 'pontos mes grafico linha',
        content: <PointsPerMonthChart monthlyPoints={monthlyPoints} />,
      },
      {
        id: 'pontos-programa',
        title: 'Pontos por programa',
        keywords: `pontos programa grafico ${programSummary.map((item) => item.label).join(' ')}`,
        content: <PointsPerProgramChart programSummary={programSummary} />,
      },
      {
        id: 'historico',
        title: 'HistÃ³rico de acÃºmulo',
        keywords: 'historico acumulo area grafico',
        content: <HistoryChart historySeries={historySeries} />,
      },
    ]
  }, [cards, historySeries, monthlyPoints, pontosPorCartao, programSummary, relatorio, totalPoints, historico])

  const filteredBlocks = useMemo(() => {
    if (!normalizedSearch) return blocks
    return blocks.filter((block) => {
      const target = `${block.title} ${block.keywords}`.toLowerCase()
      return target.includes(normalizedSearch)
    })
  }, [blocks, normalizedSearch])

  const blockMap = useMemo(() => {
    return new Map(filteredBlocks.map((block) => [block.id, block]))
  }, [filteredBlocks])

  const getBlock = (id: string) => blockMap.get(id)

  return (
    <section className="space-y-8">
      <DashboardHeader
        onExportCsv={() => handleDownload('csv')}
        onExportPdf={() => handleDownload('pdf')}
      />

      {loading ? (
        <div className="dashboard-card">
          <LoadingSpinner message="Carregando dados do dashboard..." />
        </div>
      ) : null}

      <div className="dashboard-grid">
        {getBlock('saldo') ? <div className="full-width">{getBlock('saldo')?.content}</div> : null}

        {/* Linha 1-2: CartÃµes + Pontos por cartÃ£o (lado a lado, ambos podem ocupar 2 linhas) */}
        {getBlock('cartoes') ? (
          <div className={cards.length > 2 ? 'lg:row-span-2' : ''}>
            {getBlock('cartoes')?.content}
          </div>
        ) : null}
        {getBlock('pontos-cartao') ? (
          <div className="lg:row-span-2">
            {getBlock('pontos-cartao')?.content}
          </div>
        ) : null}

        {/* Linha 2 (se cartÃµes nÃ£o ocupar) ou Linha 3: Pontos por programa + Pontos por mÃªs */}
        {getBlock('pontos-programa') ? <div>{getBlock('pontos-programa')?.content}</div> : null}
        {getBlock('pontos-mes') ? <div>{getBlock('pontos-mes')?.content}</div> : null}

        {/* Largura total: HistÃ³rico */}
        {getBlock('historico') ? <div className="full-width">{getBlock('historico')?.content}</div> : null}
      </div>
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\DashboardLayout.tsx'>
import { Outlet } from 'react-router-dom'
import TopBar from '../../components/topbar/TopBar'
import { Sidebar } from '../../components/sidebar/Sidebar'
import { MobileToggle } from '../../components/ui/MobileToggle'
import { useDashboardLayout } from '../../hooks/useDashboardLayout'

export default function DashboardLayout() {
  const {
    searchTerm,
    setSearchTerm,
    mobileMenuOpen,
    handleNavigation,
    handleLogout,
    toggleMobileMenu,
    closeMobileMenu,
  } = useDashboardLayout()

  return (
    <div className="min-h-screen bg-bg-primary text-fg-primary font-sans selection:bg-accent-pool/30">
      {/* BotÃ£o do Menu Mobile - Flutuante ou Barra Superior */}
      <MobileToggle isOpen={mobileMenuOpen} onToggle={toggleMobileMenu} />

      {/* Overlay da Sidebar Mobile */}
      <div
        className={`fixed inset-0 z-50 bg-black/60 backdrop-blur-sm transition-opacity duration-300 md:hidden ${mobileMenuOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'
          }`}
        onClick={closeMobileMenu}
      />

      <div className="flex min-h-screen">
        {/* Sidebar - Fixa em todos os tamanhos de tela */}
        <Sidebar mobileMenuOpen={mobileMenuOpen} onNavigate={handleNavigation} onLogout={handleLogout} />

        <main className="flex-1 w-full min-w-0 transition-all duration-300 md:ml-28 lg:ml-32">
          {/* Limitador de largura para telas ultra-wide */}
          <div className="mx-auto max-w-[100rem] px-4 py-4 md:px-8 md:py-6 lg:px-10">
            <div className="mb-6 md:mb-8 pt-12 md:pt-0">
              <TopBar searchTerm={searchTerm} onSearchChange={setSearchTerm} />
            </div>
            <div className="animate-fadeIn">
              <Outlet context={{ searchTerm }} />
            </div>
          </div>
        </main>
      </div>
    </div>
  )
}

  </file>
  <file name='src\pages\Dashboard\index.ts'>
export { default } from './DashboardLayout'

  </file>
  <file name='src\pages\Dashboard\Movimentacoes.tsx'>
import { useMovimentacoes } from '../../hooks/useMovimentacoes'
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import MovimentacoesHeader from '../../components/dashboard/movimentacoes/MovimentacoesHeader'
import MovimentacoesStats from '../../components/dashboard/movimentacoes/MovimentacoesStats'
import MovimentacoesTable from '../../components/dashboard/movimentacoes/MovimentacoesTable'
import MovimentacoesList from '../../components/dashboard/movimentacoes/MovimentacoesList'

export default function Movimentacoes() {
  const {
    cards,
    programas,
    movimentacoes,
    saldoGlobal,
    loading,
    editingId,
    form,
    setForm,
    cardMap,
    programMap,
    startEdit,
    cancelEdit,
    handleSave,
    handleDelete,
    totalValor,
    statusCounts
  } = useMovimentacoes()

  return (
    <section className="space-y-6">
      <MovimentacoesHeader totalValor={totalValor} saldoGlobal={saldoGlobal} />

      <MovimentacoesStats counts={statusCounts} />

      {/* Main Table */}
      <div className="dashboard-card !min-h-0 p-6">
        <div className="section-header mb-4">
          <div className="card-icon">
            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
            </svg>
          </div>
          <div className="flex-1">
            <h2 className="section-title text-base">HistÃ³rico de MovimentaÃ§Ãµes</h2>
            <p className="text-xs text-fg-secondary">{movimentacoes.length} registro{movimentacoes.length !== 1 ? 's' : ''}</p>
          </div>
        </div>

        {loading ? (
          <LoadingSpinner message="Carregando movimentaÃ§Ãµes..." />
        ) : movimentacoes.length === 0 ? (
          <div className="flex flex-col items-center justify-center gap-4 py-12 text-center">
            <div className="rounded-full bg-white/5 p-6">
              <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <p className="text-sm text-fg-secondary">Nenhuma movimentaÃ§Ã£o registrada.</p>
          </div>
        ) : (
          <>
            <MovimentacoesTable
              movimentacoes={movimentacoes}
              editingId={editingId}
              form={form}
              setForm={setForm}
              cards={cards}
              programas={programas}
              cardMap={cardMap}
              programMap={programMap}
              startEdit={startEdit}
              cancelEdit={cancelEdit}
              handleSave={handleSave}
              handleDelete={handleDelete}
            />
            <MovimentacoesList
              movimentacoes={movimentacoes}
              editingId={editingId}
              form={form}
              setForm={setForm}
              cards={cards}
              programas={programas}
              cardMap={cardMap}
              programMap={programMap}
              startEdit={startEdit}
              cancelEdit={cancelEdit}
              handleSave={handleSave}
              handleDelete={handleDelete}
            />
          </>
        )}
      </div>
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\Notificacoes.tsx'>
import { useCallback, useEffect, useState } from 'react'
import { notificacaoService } from '../../services/notificacao/notificacao.service'
import { usuarioService } from '../../services/usuario/usuario.service'
import { notify } from '../../utils/notify'
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import PageHeader from '../../components/ui/PageHeader'
import type { Notificacao, NotificacaoRequestDTO } from '../../interfaces/notificacao'
import type { UsuarioDTO } from '../../interfaces/auth'

// Format relative time
function formatRelativeTime(dateStr: string): string {
  const date = new Date(dateStr)
  const now = new Date()
  const diffMs = now.getTime() - date.getTime()
  const diffMinutes = Math.floor(diffMs / 60000)
  const diffHours = Math.floor(diffMs / 3600000)
  const diffDays = Math.floor(diffMs / 86400000)

  if (diffMinutes < 1) return 'agora mesmo'
  if (diffMinutes < 60) return `hÃ¡ ${diffMinutes} minuto${diffMinutes > 1 ? 's' : ''}`
  if (diffHours < 24) return `hÃ¡ ${diffHours} hora${diffHours > 1 ? 's' : ''}`
  if (diffDays < 7) return `hÃ¡ ${diffDays} dia${diffDays > 1 ? 's' : ''}`
  return date.toLocaleDateString('pt-BR')
}

// Notification type colors
const TIPO_COLORS: Record<string, { bg: string; border: string; icon: string }> = {
  ALERTA: { bg: 'bg-yellow-500/10', border: 'border-yellow-500/30', icon: 'text-yellow-400' },
  PROMOCAO: { bg: 'bg-green-500/10', border: 'border-green-500/30', icon: 'text-green-400' },
  INFO: { bg: 'bg-blue-500/10', border: 'border-blue-500/30', icon: 'text-blue-400' },
  EXPIRACAO: { bg: 'bg-red-500/10', border: 'border-red-500/30', icon: 'text-red-400' },
}

export default function Notificacoes() {
  const [items, setItems] = useState<Notificacao[]>([])
  const [loading, setLoading] = useState(true)
  const [user, setUser] = useState<UsuarioDTO | null>(null)

  // Admin form state
  const [showCreateForm, setShowCreateForm] = useState(false)
  const [formLoading, setFormLoading] = useState(false)
  const [formData, setFormData] = useState<NotificacaoRequestDTO>({
    titulo: '',
    mensagem: '',
    tipo: 'INFO',
  })

  const isAdmin = user?.role === 'ADMIN'

  // Load notifications and user data
  useEffect(() => {
    let isActive = true

    const loadData = async () => {
      try {
        const [notificacoesData, userData] = await Promise.all([
          notificacaoService.list(),
          usuarioService.getMe(),
        ])
        if (!isActive) return
        setItems(Array.isArray(notificacoesData) ? notificacoesData : [])
        setUser(userData)
      } catch (error) {
        notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel carregar as notificaÃ§Ãµes.' })
      } finally {
        if (isActive) setLoading(false)
      }
    }

    loadData()
    return () => { isActive = false }
  }, [])

  // Mark notification as read
  const handleMarkAsRead = useCallback(async (id: number) => {
    try {
      await notificacaoService.markAsRead(id)
      setItems((prev) => prev.map((item) => (item.id === id ? { ...item, lida: true } : item)))
      // Dispatch event to sync with TopBar
      window.dispatchEvent(new CustomEvent('notification-read', { detail: { id } }))
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel marcar como lida.' })
    }
  }, [])

  // Delete notification (dismiss for user)
  const handleDelete = useCallback(async (id: number, e: React.MouseEvent) => {
    e.stopPropagation() // Prevent triggering mark as read
    try {
      await notificacaoService.dismiss(id)
      setItems((prev) => prev.filter((item) => item.id !== id))
      window.dispatchEvent(new CustomEvent('notification-deleted', { detail: { id } }))
      notify.success('NotificaÃ§Ã£o removida.')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel remover.' })
    }
  }, [])

  // Mark all as read
  const handleMarkAllAsRead = useCallback(async () => {
    const unread = items.filter((n) => !n.lida)
    if (unread.length === 0) return

    try {
      await Promise.all(unread.map((n) => notificacaoService.markAsRead(n.id)))
      setItems((prev) => prev.map((item) => ({ ...item, lida: true })))
      window.dispatchEvent(new CustomEvent('notifications-all-read'))
      notify.success('Todas marcadas como lidas.')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel marcar todas.' })
    }
  }, [items])

  // Delete all notifications (dismiss for user)
  const handleDeleteAll = useCallback(async () => {
    if (items.length === 0) return

    try {
      await Promise.all(items.map((n) => notificacaoService.dismiss(n.id)))
      setItems([])
      window.dispatchEvent(new CustomEvent('notifications-all-deleted'))
      notify.success('Todas as notificaÃ§Ãµes removidas.')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel remover todas.' })
    }
  }, [items])

  // Admin: Permanently delete notification for all users
  const handleAdminDelete = useCallback(async (id: number, e: React.MouseEvent) => {
    e.stopPropagation()
    if (!confirm('Excluir esta notificaÃ§Ã£o permanentemente para TODOS os usuÃ¡rios?')) return

    try {
      await notificacaoService.removeForAll(id)
      setItems((prev) => prev.filter((item) => item.id !== id))
      window.dispatchEvent(new CustomEvent('notification-deleted', { detail: { id } }))
      notify.success('NotificaÃ§Ã£o excluÃ­da permanentemente.')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel excluir.' })
    }
  }, [])

  // Admin: Permanently delete all notifications
  const handleAdminDeleteAll = useCallback(async () => {
    if (items.length === 0) return
    if (!confirm('Excluir TODAS as notificaÃ§Ãµes permanentemente para TODOS os usuÃ¡rios?')) return

    try {
      await Promise.all(items.map((n) => notificacaoService.removeForAll(n.id)))
      setItems([])
      window.dispatchEvent(new CustomEvent('notifications-all-deleted'))
      notify.success('Todas as notificaÃ§Ãµes excluÃ­das permanentemente.')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel excluir todas.' })
    }
  }, [items])

  // Create notification (admin only)
  const handleCreate = useCallback(async (e: React.FormEvent) => {
    e.preventDefault()
    if (!formData.titulo.trim() || !formData.mensagem.trim()) {
      notify.warn('Preencha todos os campos.')
      return
    }

    setFormLoading(true)
    try {
      await notificacaoService.create(formData)
      notify.success('NotificaÃ§Ã£o criada com sucesso!')
      setFormData({ titulo: '', mensagem: '', tipo: 'INFO' })
      setShowCreateForm(false)

      // Reload list
      const data = await notificacaoService.list()
      setItems(Array.isArray(data) ? data : [])
      // Notify TopBar to refresh
      window.dispatchEvent(new CustomEvent('notification-created'))
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel criar a notificaÃ§Ã£o.' })
    } finally {
      setFormLoading(false)
    }
  }, [formData])

  const unreadCount = items.filter((n) => !n.lida).length

  return (
    <section className="space-y-6">
      <PageHeader
        title="NotificaÃ§Ãµes"
        description={
          unreadCount > 0
            ? `VocÃª tem ${unreadCount} ${unreadCount > 1 ? 'notificaÃ§Ãµes nÃ£o lidas' : 'notificaÃ§Ã£o nÃ£o lida'}.`
            : 'Todas as notificaÃ§Ãµes foram lidas.'
        }
      >
        <div className="flex flex-wrap items-center gap-2">
          {items.length > 0 && (
            <>
              {unreadCount > 0 && (
                <button
                  type="button"
                  onClick={handleMarkAllAsRead}
                  className="btn-secondary text-xs"
                >
                  <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Ler todas
                </button>
              )}
              <button
                type="button"
                onClick={handleDeleteAll}
                className="btn-secondary text-xs text-red-400 hover:text-red-300"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                </svg>
                Ocultar todas
              </button>
            </>
          )}
          {isAdmin && items.length > 0 && (
            <button
              type="button"
              onClick={handleAdminDeleteAll}
              className="btn-secondary text-xs text-red-500 hover:text-red-400 border-red-500/30"
            >
              <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
              </svg>
              Excluir tudo (Admin)
            </button>
          )}
          {isAdmin && (
            <button
              type="button"
              onClick={() => setShowCreateForm(!showCreateForm)}
              className="btn-primary"
            >
              <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
              Nova notificaÃ§Ã£o
            </button>
          )}
        </div>
      </PageHeader>

      {/* Admin Create Form */}
      {isAdmin && showCreateForm && (
        <div className="dashboard-card !min-h-0 p-6 animate-fadeIn">
          <div className="section-header mb-4">
            <div className="card-icon">
              <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div className="flex-1">
              <h2 className="section-title text-base">Criar notificaÃ§Ã£o</h2>
              <p className="text-xs text-fg-secondary">Todos os usuÃ¡rios receberÃ£o esta notificaÃ§Ã£o.</p>
            </div>
          </div>

          <form onSubmit={handleCreate} className="space-y-4">
            <div className="grid gap-4 md:grid-cols-2">
              <div className="space-y-1.5">
                <label htmlFor="titulo" className="block text-xs font-medium text-fg-primary">
                  TÃ­tulo
                </label>
                <input
                  id="titulo"
                  type="text"
                  value={formData.titulo}
                  onChange={(e) => setFormData((prev) => ({ ...prev, titulo: e.target.value }))}
                  placeholder="Ex: Pontos expirando"
                  className="w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                />
              </div>

              <div className="space-y-1.5">
                <label htmlFor="tipo" className="block text-xs font-medium text-fg-primary">
                  Tipo
                </label>
                <select
                  id="tipo"
                  value={formData.tipo}
                  onChange={(e) => setFormData((prev) => ({ ...prev, tipo: e.target.value }))}
                  className="w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                >
                  <option value="INFO">InformaÃ§Ã£o</option>
                  <option value="ALERTA">Alerta</option>
                  <option value="PROMOCAO">PromoÃ§Ã£o</option>
                  <option value="EXPIRACAO">ExpiraÃ§Ã£o</option>
                </select>
              </div>
            </div>

            <div className="space-y-1.5">
              <label htmlFor="mensagem" className="block text-xs font-medium text-fg-primary">
                Mensagem
              </label>
              <textarea
                id="mensagem"
                rows={3}
                value={formData.mensagem}
                onChange={(e) => setFormData((prev) => ({ ...prev, mensagem: e.target.value }))}
                placeholder="Descreva a notificaÃ§Ã£o..."
                className="w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all resize-none"
              />
            </div>

            <div className="flex gap-3">
              <button
                type="submit"
                disabled={formLoading}
                className="btn-primary disabled:opacity-50"
              >
                {formLoading ? 'Enviando...' : 'Enviar para todos'}
              </button>
              <button
                type="button"
                onClick={() => setShowCreateForm(false)}
                className="btn-secondary"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      )}

      {/* Notifications List */}
      <div className="dashboard-card !min-h-0 p-6">
        <div className="section-header mb-4">
          <div className="card-icon">
            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
            </svg>
          </div>
          <div className="flex-1">
            <h2 className="section-title text-base">HistÃ³rico</h2>
          </div>
          {unreadCount > 0 && (
            <span className="badge">{unreadCount} nova{unreadCount > 1 ? 's' : ''}</span>
          )}
        </div>

        {loading ? (
          <LoadingSpinner message="Carregando notificaÃ§Ãµes..." />
        ) : items.length === 0 ? (
          <div className="flex flex-col items-center justify-center gap-4 py-12 text-center">
            <div className="rounded-full bg-white/5 p-6">
              <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
              </svg>
            </div>
            <p className="text-sm text-fg-secondary">Nenhuma notificaÃ§Ã£o encontrada.</p>
          </div>
        ) : (
          <div className="space-y-3">
            {items.map((item) => {
              const tipoStyle = TIPO_COLORS[item.tipo] ?? TIPO_COLORS.INFO
              const isUnread = !item.lida

              return (
                <button
                  key={item.id}
                  type="button"
                  onClick={() => isUnread && handleMarkAsRead(item.id)}
                  className={`w-full text-left rounded-xl border p-4 transition-all duration-300 ${isUnread
                    ? `${tipoStyle.bg} ${tipoStyle.border} hover:shadow-lg cursor-pointer`
                    : 'border-white/5 bg-white/[0.02] opacity-70'
                    }`}
                >
                  <div className="flex items-start gap-3">
                    {/* Icon */}
                    <div className={`flex-shrink-0 rounded-lg p-2 ${tipoStyle.bg}`}>
                      <svg className={`h-5 w-5 ${tipoStyle.icon}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        {item.tipo === 'ALERTA' && (
                          <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        )}
                        {item.tipo === 'PROMOCAO' && (
                          <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.835L16.5 21.75l-.398-.915a2.25 2.25 0 00-1.193-1.193L14 19.5l.909-.398a2.25 2.25 0 001.193-1.193L16.5 17l.398.909a2.25 2.25 0 001.193 1.193l.909.398-.909.398a2.25 2.25 0 00-1.193 1.193z" />
                        )}
                        {item.tipo === 'EXPIRACAO' && (
                          <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        )}
                        {item.tipo === 'INFO' && (
                          <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                        )}
                      </svg>
                    </div>

                    {/* Content */}
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2">
                        <h3 className={`font-semibold text-sm ${isUnread ? 'text-fg-primary' : 'text-fg-secondary'}`}>
                          {item.titulo}
                        </h3>
                        {isUnread && (
                          <span className="flex h-2 w-2 rounded-full bg-accent-pool animate-pulse" />
                        )}
                      </div>
                      <p className="mt-1 text-xs text-fg-secondary line-clamp-2">{item.mensagem}</p>
                      <p className="mt-2 text-[0.625rem] text-fg-secondary/60">
                        {item.dataCriacao ? formatRelativeTime(item.dataCriacao) : 'Data desconhecida'}
                      </p>
                    </div>

                    {/* Actions */}
                    <div className="flex flex-shrink-0 items-center gap-2">
                      {isUnread && (
                        <span className="hidden sm:inline text-[0.625rem] text-accent-pool font-medium">
                          Clique para ler
                        </span>
                      )}
                      <button
                        type="button"
                        onClick={(e) => handleDelete(item.id, e)}
                        className="p-1.5 rounded-lg text-fg-secondary hover:text-orange-400 hover:bg-orange-500/10 transition-colors"
                        title="Ocultar notificaÃ§Ã£o"
                      >
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                          <path strokeLinecap="round" strokeLinejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                        </svg>
                      </button>
                      {isAdmin && (
                        <button
                          type="button"
                          onClick={(e) => handleAdminDelete(item.id, e)}
                          className="p-1.5 rounded-lg text-fg-secondary hover:text-red-500 hover:bg-red-500/10 transition-colors"
                          title="Excluir permanentemente (Admin)"
                        >
                          <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                          </svg>
                        </button>
                      )}
                    </div>
                  </div>
                </button>
              )
            })}
          </div>
        )}
      </div>
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\Perfil.tsx'>
import { useCallback, useEffect, useRef, useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { usuarioService } from '../../services/usuario/usuario.service'
import { useAuth } from '../../hooks/useAuth'
import { notify } from '../../utils/notify'
import LoadingSpinner from '../../components/ui/LoadingSpinner'

type UserData = {
  id: number
  nome: string
  email: string
}

export default function Perfil() {
  const navigate = useNavigate()
  const { logout } = useAuth()
  const fileInputRef = useRef<HTMLInputElement>(null)

  // States
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)
  const [deleting, setDeleting] = useState(false)
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)
  const [deleteConfirmText, setDeleteConfirmText] = useState('')

  const [userData, setUserData] = useState<UserData | null>(null)
  const [photoUrl, setPhotoUrl] = useState<string | null>(null)
  const [uploadingPhoto, setUploadingPhoto] = useState(false)

  // Form state
  const [nome, setNome] = useState('')
  const [email, setEmail] = useState('')

  // Load user data
  useEffect(() => {
    let isActive = true
    let objectUrl: string | null = null

    const loadData = async () => {
      try {
        const [user, photoBlob] = await Promise.all([
          usuarioService.getMe(),
          usuarioService.getFoto().catch(() => null),
        ])

        if (!isActive) return

        setUserData(user)
        setNome(user.nome)
        setEmail(user.email)

        if (photoBlob && photoBlob.size > 0) {
          objectUrl = URL.createObjectURL(photoBlob)
          setPhotoUrl(objectUrl)
        }
      } catch (error) {
        notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel carregar os dados do perfil.' })
      } finally {
        if (isActive) setLoading(false)
      }
    }

    loadData()

    return () => {
      isActive = false
      if (objectUrl) URL.revokeObjectURL(objectUrl)
    }
  }, [])

  // Handle photo upload
  const handlePhotoChange = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    // Validate file
    if (!file.type.startsWith('image/')) {
      notify.error('Por favor, selecione uma imagem vÃ¡lida.')
      return
    }

    if (file.size > 5 * 1024 * 1024) {
      notify.error('A imagem deve ter no mÃ¡ximo 5MB.')
      return
    }

    setUploadingPhoto(true)
    try {
      await usuarioService.uploadFoto(file)

      // Create preview
      const newUrl = URL.createObjectURL(file)
      setPhotoUrl((prev) => {
        if (prev) URL.revokeObjectURL(prev)
        return newUrl
      })

      notify.success('Foto atualizada com sucesso!')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel atualizar a foto.' })
    } finally {
      setUploadingPhoto(false)
    }
  }, [])

  // Handle form submit
  const handleSubmit = useCallback(async (e: React.FormEvent) => {
    e.preventDefault()

    if (!nome.trim()) {
      notify.error('O nome Ã© obrigatÃ³rio.')
      return
    }

    if (!email.trim() || !email.includes('@')) {
      notify.error('Informe um e-mail vÃ¡lido.')
      return
    }

    setSaving(true)
    try {
      await usuarioService.updateMe({
        nome: nome.trim(),
        email: email.trim(),
      })

      notify.success('Dados atualizados com sucesso!')
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel atualizar os dados.' })
    } finally {
      setSaving(false)
    }
  }, [nome, email])

  // Handle account deletion
  const handleDeleteAccount = useCallback(async () => {
    if (deleteConfirmText !== 'EXCLUIR') return

    setDeleting(true)
    try {
      await usuarioService.deleteMe()
      notify.success('Conta excluÃ­da com sucesso.')
      logout()
      navigate('/', { replace: true })
    } catch (error) {
      notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel excluir a conta.' })
      setDeleting(false)
    }
  }, [deleteConfirmText, logout, navigate])

  // Get initials for avatar fallback
  const getInitials = (name: string) => {
    return name
      .split(' ')
      .map((n) => n[0])
      .slice(0, 2)
      .join('')
      .toUpperCase()
  }

  if (loading) {
    return (
      <section className="space-y-6">
        <header>
          <h1 className="titulo-grafico text-2xl font-bold">Meu perfil</h1>
          <p className="mt-1 text-sm text-fg-secondary">Gerencie seus dados pessoais e preferÃªncias.</p>
        </header>
        <div className="dashboard-card">
          <LoadingSpinner message="Carregando dados do perfil..." />
        </div>
      </section>
    )
  }

  return (
    <section className="space-y-6">
      <header>
        <h1 className="titulo-grafico text-2xl font-bold">Meu perfil</h1>
        <p className="mt-1 text-sm text-fg-secondary">Gerencie seus dados pessoais e preferÃªncias.</p>
      </header>

      <div className="grid gap-6 lg:grid-cols-3">
        {/* Avatar Card */}
        <div className="dashboard-card lg:col-span-1">
          <div className="section-header">
            <div className="card-icon">
              <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
              </svg>
            </div>
            <div className="flex-1">
              <h2 className="section-title">Foto de perfil</h2>
            </div>
          </div>

          <div className="mt-6 flex flex-col items-center">
            {/* Avatar with upload overlay */}
            <div className="group relative">
              <div className="relative h-32 w-32 overflow-hidden rounded-full border-4 border-accent-pool/30 shadow-lg shadow-accent-pool/20">
                {photoUrl ? (
                  <img
                    src={photoUrl}
                    alt="Foto de perfil"
                    className="h-full w-full object-cover"
                  />
                ) : (
                  <div className="flex h-full w-full items-center justify-center bg-gradient-to-br from-accent-sky to-accent-pool">
                    <span className="text-3xl font-bold text-white">
                      {userData?.nome ? getInitials(userData.nome) : '?'}
                    </span>
                  </div>
                )}

                {/* Upload overlay */}
                <button
                  type="button"
                  onClick={() => fileInputRef.current?.click()}
                  disabled={uploadingPhoto}
                  className="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 transition-opacity group-hover:opacity-100"
                >
                  {uploadingPhoto ? (
                    <div className="h-8 w-8 animate-spin rounded-full border-2 border-white border-t-transparent" />
                  ) : (
                    <svg className="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
                      <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                    </svg>
                  )}
                </button>
              </div>

              {/* Glow effect */}
              <div className="absolute -inset-2 -z-10 rounded-full bg-gradient-to-r from-accent-sky to-accent-pool opacity-20 blur-xl" />
            </div>

            <input
              ref={fileInputRef}
              type="file"
              accept="image/*"
              onChange={handlePhotoChange}
              className="hidden"
            />

            <p className="mt-4 text-center text-sm text-fg-secondary">
              Clique na foto para alterar
            </p>
            <p className="mt-1 text-center text-xs text-fg-secondary/70">
              JPG, PNG ou GIF. MÃ¡ximo 5MB.
            </p>
          </div>
        </div>

        {/* Personal Data Card */}
        <div className="dashboard-card lg:col-span-2">
          <div className="section-header">
            <div className="card-icon">
              <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
              </svg>
            </div>
            <div className="flex-1">
              <h2 className="section-title">Dados pessoais</h2>
            </div>
            <span className="badge">EditÃ¡vel</span>
          </div>

          <form onSubmit={handleSubmit} className="mt-6 space-y-5">
            {/* Nome field */}
            <div className="space-y-2">
              <label htmlFor="nome" className="block text-sm font-medium text-fg-primary">
                Nome completo
              </label>
              <input
                id="nome"
                type="text"
                value={nome}
                onChange={(e) => setNome(e.target.value)}
                placeholder="Seu nome completo"
                className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
              />
            </div>

            {/* Email field */}
            <div className="space-y-2">
              <label htmlFor="email" className="block text-sm font-medium text-fg-primary">
                E-mail
              </label>
              <input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="seu@email.com"
                className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
              />
            </div>

            {/* Submit button */}
            <div className="flex justify-end pt-2">
              <button
                type="submit"
                disabled={saving}
                className="btn-primary group relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {saving ? (
                  <>
                    <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                    Salvando...
                  </>
                ) : (
                  <>
                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                    </svg>
                    Salvar alteraÃ§Ãµes
                  </>
                )}
              </button>
            </div>
          </form>
        </div>
      </div>

      {/* Danger Zone */}
      <div className="dashboard-card border-red-500/30 bg-red-500/5">
        <div className="section-header">
          <div className="card-icon bg-red-500/20 text-red-400">
            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
          </div>
          <div className="flex-1">
            <h2 className="text-lg font-semibold text-red-400">Zona de perigo</h2>
            <p className="text-sm text-fg-secondary">AÃ§Ãµes irreversÃ­veis para sua conta</p>
          </div>
        </div>

        <div className="mt-6">
          {!showDeleteConfirm ? (
            <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
              <div>
                <h3 className="font-medium text-fg-primary">Excluir conta permanentemente</h3>
                <p className="mt-1 text-sm text-fg-secondary">
                  Ao excluir sua conta, todos os seus dados serÃ£o removidos permanentemente.
                </p>
              </div>
              <button
                type="button"
                onClick={() => setShowDeleteConfirm(true)}
                className="flex items-center gap-2 rounded-xl border border-red-500/30 bg-red-500/10 px-5 py-2.5 text-xs font-semibold text-red-400 transition-all hover:bg-red-500/20 hover:border-red-500/50"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                </svg>
                Excluir minha conta
              </button>
            </div>
          ) : (
            <div className="rounded-xl border border-red-500/30 bg-red-500/10 p-5">
              <h3 className="font-medium text-red-400">Confirmar exclusÃ£o</h3>
              <p className="mt-2 text-sm text-fg-secondary">
                Esta aÃ§Ã£o Ã© <strong className="text-red-400">irreversÃ­vel</strong>. Para confirmar, digite{' '}
                <code className="rounded bg-red-500/20 px-2 py-0.5 font-mono text-red-400">EXCLUIR</code>{' '}
                abaixo:
              </p>

              <input
                type="text"
                value={deleteConfirmText}
                onChange={(e) => setDeleteConfirmText(e.target.value)}
                placeholder="Digite EXCLUIR para confirmar"
                className="mt-4 w-full rounded-xl border border-red-500/30 bg-bg-primary px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500/20"
              />

              <div className="mt-4 flex gap-3">
                <button
                  type="button"
                  onClick={() => {
                    setShowDeleteConfirm(false)
                    setDeleteConfirmText('')
                  }}
                  className="btn-secondary"
                >
                  Cancelar
                </button>
                <button
                  type="button"
                  onClick={handleDeleteAccount}
                  disabled={deleteConfirmText !== 'EXCLUIR' || deleting}
                  className="flex items-center gap-2 rounded-xl bg-red-500 px-5 py-2.5 text-xs font-semibold text-white transition-all hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {deleting ? (
                    <>
                      <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                      Excluindo...
                    </>
                  ) : (
                    <>
                      <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                      </svg>
                      Confirmar exclusÃ£o
                    </>
                  )}
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\Programas.tsx'>
import { useCallback, useEffect, useMemo, useState } from 'react'
import { programaFidelidadeService } from '../../services/programaFidelidade/programaFidelidade.service'
import { saldoUsuarioProgramaService } from '../../services/saldoUsuarioPrograma/saldoUsuarioPrograma.service'
import { usuarioService } from '../../services/usuario/usuario.service'
import { notify } from '../../utils/notify'
import { formatPoints } from '../../utils/programaHelpers'
import { ProgramCard, ProgramFormModal, DeleteConfirmModal } from '../../components/dashboard/programas'
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import PageHeader from '../../components/ui/PageHeader'
import SensitiveValue from '../../components/ui/SensitiveValue'
import type { CategoriaPrograma, Programa, SaldoPrograma, ViewMode } from '../../interfaces/programa'
import type { UsuarioDTO } from '../../interfaces/auth'

const CATEGORY_OPTIONS = [
    { value: '', label: 'Todas as categorias' },
    { value: 'AEREA', label: 'AÃ©rea' },
    { value: 'BANCO', label: 'Banco' },
    { value: 'FINANCEIRO', label: 'Financeiro' },
    { value: 'VAREJO', label: 'Varejo' },
    { value: 'OUTRO', label: 'Outro' },
]

export default function Programas() {
    // State
    const [programas, setProgramas] = useState<Programa[]>([])
    const [saldos, setSaldos] = useState<SaldoPrograma[]>([])
    const [user, setUser] = useState<UsuarioDTO | null>(null)
    const [loading, setLoading] = useState(true)
    const [viewMode, setViewMode] = useState<ViewMode>('all')
    const [searchTerm, setSearchTerm] = useState('')
    const [categoryFilter, setCategoryFilter] = useState('')

    // Modal states
    const [formModalOpen, setFormModalOpen] = useState(false)
    const [formModalMode, setFormModalMode] = useState<'create' | 'edit'>('create')
    const [deleteModalOpen, setDeleteModalOpen] = useState(false)
    const [selectedPrograma, setSelectedPrograma] = useState<Programa | null>(null)
    const [saving, setSaving] = useState(false)

    const isAdmin = user?.role === 'ADMIN'

    // Load data
    const loadData = useCallback(async () => {
        try {
            const [programasData, saldosData, userData] = await Promise.all([
                programaFidelidadeService.list(),
                saldoUsuarioProgramaService.list(),
                usuarioService.getMe(),
            ])
            setUser(userData)
            setProgramas(Array.isArray(programasData) ? programasData.map(p => ({
                id: p.id,
                nome: p.nome,
                descricao: p.descricao,
                categoria: p.categoria,
                multiplicadorPontos: p.multiplicadorPontos,
                promocoes: p.promocoes
            })) : [])
            setSaldos(Array.isArray(saldosData) ? saldosData.map(s => ({
                id: s.id,
                pontos: s.pontos,
                programaId: typeof s.programaId === 'object' ? s.programaId?.id : s.programaId,
                programa: typeof s.programaId === 'object' ? s.programaId : undefined,
            })) : [])
        } catch (error) {
            notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel carregar os programas.' })
        } finally {
            setLoading(false)
        }
    }, [])

    useEffect(() => {
        loadData()
    }, [loadData])

    // Computed data
    const saldoMap = useMemo(() => {
        const map = new Map<number, { pontos: number; cartaoNome?: string }>()
        saldos.forEach((s) => {
            const programaId = s.programaId ?? s.programa?.id
            if (programaId !== undefined) {
                const existing = map.get(programaId)
                map.set(programaId, {
                    pontos: (existing?.pontos ?? 0) + (s.pontos ?? 0),
                    cartaoNome: s.cartao?.nome ?? existing?.cartaoNome,
                })
            }
        })
        return map
    }, [saldos])

    const meusProgramas = useMemo(() => programas.filter((p) => saldoMap.has(p.id)), [programas, saldoMap])

    const totalPontos = useMemo(() =>
        Array.from(saldoMap.values()).reduce((acc, s) => acc + s.pontos, 0),
        [saldoMap])

    // Apply all filters
    const displayedProgramas = useMemo(() => {
        let result = viewMode === 'all' ? programas : meusProgramas

        // Search filter
        if (searchTerm.trim()) {
            const term = searchTerm.toLowerCase()
            result = result.filter(p => p.nome.toLowerCase().includes(term))
        }

        // Category filter
        if (categoryFilter) {
            result = result.filter(p => p.categoria === categoryFilter)
        }

        return result
    }, [viewMode, programas, meusProgramas, searchTerm, categoryFilter])

    // Handlers
    const openCreateModal = useCallback(() => {
        setFormModalMode('create')
        setSelectedPrograma(null)
        setFormModalOpen(true)
    }, [])

    const openEditModal = useCallback((prog: Programa) => {
        setFormModalMode('edit')
        setSelectedPrograma(prog)
        setFormModalOpen(true)
    }, [])

    const openDeleteModal = useCallback((id: number) => {
        const prog = programas.find(p => p.id === id)
        if (prog) {
            setSelectedPrograma(prog)
            setDeleteModalOpen(true)
        }
    }, [programas])

    const closeFormModal = useCallback(() => {
        setFormModalOpen(false)
        setSelectedPrograma(null)
    }, [])

    const closeDeleteModal = useCallback(() => {
        setDeleteModalOpen(false)
        setSelectedPrograma(null)
    }, [])

    const handleFormSubmit = useCallback(async (data: { nome: string; descricao: string; categoria?: CategoriaPrograma; multiplicadorPontos?: number }) => {
        if (!isAdmin) {
            notify.error('Apenas administradores podem gerenciar programas.')
            return
        }

        setSaving(true)
        try {
            if (formModalMode === 'create') {
                await programaFidelidadeService.create(data)
                notify.success('Programa criado com sucesso!')
            } else if (selectedPrograma) {
                await programaFidelidadeService.update(selectedPrograma.id, data)
                notify.success('Programa atualizado com sucesso!')
            }
            closeFormModal()
            await loadData()
        } catch (error) {
            const action = formModalMode === 'create' ? 'criar' : 'atualizar'
            notify.apiError(error, { fallback: `NÃ£o foi possÃ­vel ${action} o programa.` })
        } finally {
            setSaving(false)
        }
    }, [isAdmin, formModalMode, selectedPrograma, closeFormModal, loadData])

    const handleConfirmDelete = useCallback(async (id: number) => {
        if (!isAdmin) {
            notify.error('Apenas administradores podem excluir programas.')
            return
        }

        setSaving(true)
        try {
            await programaFidelidadeService.remove(id)
            notify.success('Programa excluÃ­do com sucesso!')
            closeDeleteModal()
            await loadData()
        } catch (error) {
            notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel excluir o programa.' })
        } finally {
            setSaving(false)
        }
    }, [isAdmin, closeDeleteModal, loadData])

    if (loading) {
        return (
            <section className="space-y-6">
                <header>
                    <h1 className="titulo-grafico text-2xl font-bold">Programas de Fidelidade</h1>
                    <p className="mt-1 text-sm text-fg-secondary">Explore e gerencie seus programas de pontos.</p>
                </header>
                <div className="dashboard-card">
                    <LoadingSpinner message="Carregando programas..." />
                </div>
            </section>
        )
    }

    return (
        <section className="space-y-6">
            {/* Header */}
            <PageHeader
                title="Programas de Fidelidade"
                description="Explore e gerencie seus programas de pontos e milhas."
            >
                {isAdmin && (
                    <button type="button" onClick={openCreateModal} className="btn-primary">
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        Novo Programa
                    </button>
                )}
            </PageHeader>

            {/* View Mode Tabs */}
            {/* Stats - Always visible */}
            <div className="grid grid-cols-2 gap-4 sm:grid-cols-3">
                <div className="dashboard-card !min-h-0 !p-4">
                    <p className="text-xs text-fg-secondary">Total de Programas</p>
                    <p className="text-2xl font-bold text-fg-primary">{programas.length}</p>
                </div>
                <div className="dashboard-card !min-h-0 !p-4">
                    <p className="text-xs text-fg-secondary">Meus Programas</p>
                    <p className="text-2xl font-bold text-fg-primary">{meusProgramas.length}</p>
                </div>
                <div className="dashboard-card !min-h-0 !p-4 col-span-2 sm:col-span-1">
                    <p className="text-xs text-fg-secondary">Total de Pontos</p>
                    <p className="text-2xl font-bold text-accent-pool">
                        <SensitiveValue>{formatPoints(totalPontos)}</SensitiveValue>
                    </p>
                </div>
            </div>

            {/* Filters Bar */}
            <div className="flex flex-wrap items-center gap-3">
                {/* Search Input */}
                <div className="relative flex-1 min-w-[200px] max-w-sm">
                    <svg
                        className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-fg-secondary pointer-events-none"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        strokeWidth={1.5}
                    >
                        <path strokeLinecap="round" strokeLinejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                    <input
                        type="text"
                        placeholder="Buscar programa..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full rounded-lg border border-border-primary bg-bg-secondary py-2 pl-10 pr-4 text-sm text-fg-primary placeholder-fg-secondary focus:border-accent-pool focus:ring-1 focus:ring-accent-pool focus:outline-none transition-colors"
                    />
                </div>

                {/* Category Filter */}
                <select
                    value={categoryFilter}
                    onChange={(e) => setCategoryFilter(e.target.value)}
                    className="rounded-lg border border-border-primary bg-bg-secondary py-2 px-3 text-sm text-fg-primary focus:border-accent-pool focus:ring-1 focus:ring-accent-pool focus:outline-none transition-colors cursor-pointer"
                >
                    {CATEGORY_OPTIONS.map((opt) => (
                        <option key={opt.value} value={opt.value}>{opt.label}</option>
                    ))}
                </select>

                {/* View Mode Pills */}
                <div className="flex items-center gap-1 p-1 rounded-lg bg-white/5">
                    <button
                        type="button"
                        onClick={() => setViewMode('all')}
                        className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${viewMode === 'all'
                            ? 'bg-accent-pool text-white'
                            : 'text-fg-secondary hover:text-fg-primary'
                            }`}
                    >
                        Todos
                    </button>
                    <button
                        type="button"
                        onClick={() => setViewMode('mine')}
                        className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${viewMode === 'mine'
                            ? 'bg-accent-pool text-white'
                            : 'text-fg-secondary hover:text-fg-primary'
                            }`}
                    >
                        Meus
                    </button>
                </div>

                {/* Clear Filters */}
                {(searchTerm || categoryFilter) && (
                    <button
                        type="button"
                        onClick={() => {
                            setSearchTerm('')
                            setCategoryFilter('')
                        }}
                        className="text-xs text-fg-secondary hover:text-accent-pool transition-colors"
                    >
                        Limpar filtros
                    </button>
                )}
            </div>

            {/* Results count */}
            {(searchTerm || categoryFilter) && (
                <p className="text-sm text-fg-secondary">
                    {displayedProgramas.length} {displayedProgramas.length === 1 ? 'programa encontrado' : 'programas encontrados'}
                </p>
            )}

            {/* Programs Grid */}
            {displayedProgramas.length > 0 ? (
                <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                    {displayedProgramas.map((programa) => {
                        const saldoInfo = saldoMap.get(programa.id)
                        return (
                            <ProgramCard
                                key={programa.id}
                                programa={programa}
                                mode={viewMode}
                                saldo={saldoInfo?.pontos}
                                cartaoNome={saldoInfo?.cartaoNome}
                                isAdmin={isAdmin}
                                onEdit={openEditModal}
                                onDelete={openDeleteModal}
                            />
                        )
                    })}
                </div>
            ) : (
                <div className="dashboard-card flex flex-col items-center justify-center py-12 text-center">
                    <div className="rounded-full bg-white/5 p-6 mb-4">
                        <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </div>
                    <p className="text-fg-primary font-medium">
                        {(searchTerm || categoryFilter)
                            ? 'Nenhum programa encontrado'
                            : viewMode === 'all'
                                ? 'Nenhum programa cadastrado'
                                : 'Nenhum programa associado'}
                    </p>
                    <p className="text-sm text-fg-secondary mt-1">
                        {(searchTerm || categoryFilter)
                            ? 'Tente ajustar os filtros de busca.'
                            : viewMode === 'all'
                                ? 'Aguarde o administrador cadastrar novos programas.'
                                : 'Registre pontos em um cartÃ£o para associar um programa automaticamente.'}
                    </p>
                </div>
            )}

            {/* Modals */}
            <ProgramFormModal
                isOpen={formModalOpen}
                mode={formModalMode}
                programa={selectedPrograma}
                onClose={closeFormModal}
                onSubmit={handleFormSubmit}
                loading={saving}
            />

            <DeleteConfirmModal
                isOpen={deleteModalOpen}
                programa={selectedPrograma}
                onClose={closeDeleteModal}
                onConfirm={handleConfirmDelete}
                loading={saving}
            />
        </section>
    )
}

  </file>
  <file name='src\pages\Dashboard\Promocoes.tsx'>
import { useCallback, useEffect, useMemo, useState } from 'react'
import { promocaoService } from '../../services/promocao/promocao.service'
import { programaFidelidadeService } from '../../services/programaFidelidade/programaFidelidade.service'
import { usuarioService } from '../../services/usuario/usuario.service'
import { notify } from '../../utils/notify'
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import PageHeader from '../../components/ui/PageHeader'
import type { PromocaoRequestDTO } from '../../interfaces/promocao'
import type { Programa } from '../../interfaces/cardTypes'
import type { UsuarioDTO } from '../../interfaces/auth'

// Promocao entity type (response from backend - using camelCase)
type Promocao = {
    id: number
    programaId: number | { id: number; nome: string } // Can be number or object
    programa?: { id: number; nome: string }
    titulo: string
    descricao: string
    dataInicio: string  // camelCase
    dataFim: string     // camelCase
    pontosPorReal?: number
    ativo: boolean | string // Can be boolean or 'ATIVO'/'VENCIDO'
}

// Calculate days until expiration
function getDaysUntilExpiration(dateStr: string): number {
    const expirationDate = new Date(dateStr)
    const today = new Date()
    today.setHours(0, 0, 0, 0)
    expirationDate.setHours(0, 0, 0, 0)
    const diffTime = expirationDate.getTime() - today.getTime()
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24))
}

// Format date for display
function formatDate(dateStr: string): string {
    return new Date(dateStr).toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
    })
}

export default function Promocoes() {
    const [promocoes, setPromocoes] = useState<Promocao[]>([])
    const [programas, setProgramas] = useState<Programa[]>([])
    const [user, setUser] = useState<UsuarioDTO | null>(null)
    const [loading, setLoading] = useState(true)
    const [saving, setSaving] = useState(false)
    const [showForm, setShowForm] = useState(false)
    const [editingPromo, setEditingPromo] = useState<Promocao | null>(null)
    const [deletingId, setDeletingId] = useState<number | null>(null)
    const [confirmDeleteId, setConfirmDeleteId] = useState<number | null>(null)

    const [form, setForm] = useState<{
        titulo: string
        descricao: string
        programaId: string
        dataInicio: string  // camelCase
        dataFim: string     // camelCase
        pontosPorReal: string
        ativo: boolean
    }>({
        titulo: '',
        descricao: '',
        programaId: '',
        dataInicio: new Date().toISOString().split('T')[0],
        dataFim: '',
        pontosPorReal: '1',
        ativo: true,
    })

    // Check if user is admin
    const isAdmin = user?.role === 'ADMIN'

    // Load data
    const loadData = useCallback(async () => {
        try {
            const [promoData, programaData, userData] = await Promise.all([
                promocaoService.list(),
                programaFidelidadeService.list(),
                usuarioService.getMe(),
            ])

            // Map promoData to local Promocao type
            setPromocoes(Array.isArray(promoData) ? promoData.map(p => ({
                id: p.id,
                programaId: typeof p.programaId === 'object' ? p.programaId.id : p.programaId,
                programa: typeof p.programaId === 'object' ? p.programaId : undefined,
                titulo: p.titulo,
                descricao: p.descricao,
                dataInicio: p.dataInicio,
                dataFim: p.dataFim,
                pontosPorReal: p.pontosPorReal,
                ativo: p.ativo === 'ATIVO',
            })) : [])
            setProgramas(Array.isArray(programaData) ? programaData.map(p => ({ id: p.id, nome: p.nome })) : [])
            setUser(userData)
        } catch (error) {
            notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel carregar as promoÃ§Ãµes.' })
        } finally {
            setLoading(false)
        }
    }, [])

    useEffect(() => {
        loadData()

        // Polling: refresh data every 15 seconds for real-time updates
        const pollingInterval = setInterval(async () => {
            try {
                const promoData = await promocaoService.list()
                setPromocoes(Array.isArray(promoData) ? promoData.map(p => ({
                    id: p.id,
                    programaId: typeof p.programaId === 'object' ? p.programaId.id : p.programaId,
                    programa: typeof p.programaId === 'object' ? p.programaId : undefined,
                    titulo: p.titulo,
                    descricao: p.descricao,
                    dataInicio: p.dataInicio,
                    dataFim: p.dataFim,
                    pontosPorReal: p.pontosPorReal,
                    ativo: p.ativo === 'ATIVO',
                })) : [])
            } catch {
                // Silent failure for polling
            }
        }, 15000)

        // Listen for promotion-created events (from same browser session)
        const handlePromotionCreated = async () => {
            try {
                const promoData = await promocaoService.list()
                setPromocoes(Array.isArray(promoData) ? promoData.map(p => ({
                    id: p.id,
                    programaId: typeof p.programaId === 'object' ? p.programaId.id : p.programaId,
                    programa: typeof p.programaId === 'object' ? p.programaId : undefined,
                    titulo: p.titulo,
                    descricao: p.descricao,
                    dataInicio: p.dataInicio,
                    dataFim: p.dataFim,
                    pontosPorReal: p.pontosPorReal,
                    ativo: p.ativo === 'ATIVO',
                })) : [])
            } catch {
                // Silent failure
            }
        }
        window.addEventListener('promotion-created', handlePromotionCreated)

        return () => {
            clearInterval(pollingInterval)
            window.removeEventListener('promotion-created', handlePromotionCreated)
        }
    }, [loadData])

    // Program name lookup
    const programaMap = useMemo(() => {
        const map = new Map<number, string>()
        programas.forEach((p) => map.set(p.id, p.nome))
        return map
    }, [programas])

    // Reset form
    const resetForm = useCallback(() => {
        setForm({
            titulo: '',
            descricao: '',
            programaId: '',
            dataInicio: new Date().toISOString().split('T')[0],
            dataFim: '',
            pontosPorReal: '1',
            ativo: true,
        })
        setEditingPromo(null)
        setShowForm(false)
    }, [])

    // Open form for editing
    const openEditForm = useCallback((promo: Promocao) => {
        setEditingPromo(promo)
        setForm({
            titulo: promo.titulo ?? '',
            descricao: promo.descricao ?? '',
            programaId: String(typeof promo.programaId === 'object' ? promo.programaId.id : promo.programaId ?? promo.programa?.id ?? ''),
            dataInicio: promo.dataInicio?.split('T')[0] ?? '',
            dataFim: promo.dataFim?.split('T')[0] ?? '',
            pontosPorReal: String(promo.pontosPorReal ?? '1'),
            ativo: typeof promo.ativo === 'boolean' ? promo.ativo : promo.ativo === 'ATIVO',
        })
        setShowForm(true)
    }, [])

    // Handle form submit
    const handleSubmit = useCallback(async (event: React.FormEvent) => {
        event.preventDefault()

        if (!form.titulo.trim()) {
            notify.warn('Informe o tÃ­tulo da promoÃ§Ã£o.')
            return
        }

        if (!form.programaId) {
            notify.warn('Selecione um programa de fidelidade.')
            return
        }

        if (!form.dataFim) {
            notify.warn('Informe a data de validade.')
            return
        }

        setSaving(true)
        const payload: PromocaoRequestDTO = {
            titulo: form.titulo.trim(),
            descricao: form.descricao.trim(),
            programaId: Number(form.programaId),
            dataInicio: form.dataInicio,
            dataFim: form.dataFim,
            pontosPorReal: Number(form.pontosPorReal) || 1,
        }

        try {
            if (editingPromo?.id) {
                await promocaoService.update(editingPromo.id, payload)
                notify.success('PromoÃ§Ã£o atualizada com sucesso.')
            } else {
                await promocaoService.create(payload)
                notify.success('PromoÃ§Ã£o criada com sucesso.')
            }
            resetForm()
            await loadData()
            // Dispatch event to notify other users' pages
            window.dispatchEvent(new CustomEvent('promotion-created'))
        } catch (error) {
            notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel salvar a promoÃ§Ã£o.' })
        } finally {
            setSaving(false)
        }
    }, [form, editingPromo, resetForm, loadData])

    // Handle delete
    const handleDeleteConfirm = useCallback((id: number) => {
        setConfirmDeleteId(id)
    }, [])

    const handleDeleteCancel = useCallback(() => {
        setConfirmDeleteId(null)
    }, [])

    const handleDelete = useCallback(async (id: number) => {
        setDeletingId(id)
        setConfirmDeleteId(null)
        try {
            await promocaoService.remove(id)
            notify.success('PromoÃ§Ã£o excluÃ­da com sucesso.')
            await loadData()
        } catch (error) {
            notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel excluir a promoÃ§Ã£o.' })
        } finally {
            setDeletingId(null)
        }
    }, [loadData])

    // Count active promotions
    const activeCount = useMemo(() => {
        return promocoes.filter((p) => p.ativo && getDaysUntilExpiration(p.dataFim) >= 0).length
    }, [promocoes])

    return (
        <section className="space-y-6">
            <PageHeader
                title="PromoÃ§Ãµes"
                description={
                    activeCount > 0
                        ? `${activeCount} ${activeCount === 1 ? 'promoÃ§Ã£o ativa' : 'promoÃ§Ãµes ativas'} disponÃ­veis.`
                        : 'Nenhuma promoÃ§Ã£o ativa no momento.'
                }
            >
                {isAdmin && (
                    <button
                        type="button"
                        onClick={() => {
                            resetForm()
                            setShowForm(true)
                        }}
                        className="btn-primary"
                    >
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        Nova promoÃ§Ã£o
                    </button>
                )}
            </PageHeader>

            {/* Form Modal/Panel - Admin only */}
            {isAdmin && showForm && (
                <div className="dashboard-card">
                    <div className="section-header">
                        <div className="card-icon">
                            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h2 className="section-title">{editingPromo ? 'Editar promoÃ§Ã£o' : 'Nova promoÃ§Ã£o'}</h2>
                        </div>
                        <button
                            type="button"
                            onClick={resetForm}
                            className="rounded-lg p-2 text-fg-secondary hover:bg-white/10 hover:text-fg-primary transition-colors"
                        >
                            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <form onSubmit={handleSubmit} className="mt-6 space-y-6">
                        <div className="grid gap-5 md:grid-cols-2">
                            {/* TÃ­tulo */}
                            <div className="space-y-2">
                                <label htmlFor="promo-titulo" className="block text-sm font-medium text-fg-primary">
                                    TÃ­tulo
                                </label>
                                <input
                                    id="promo-titulo"
                                    value={form.titulo}
                                    onChange={(e) => setForm((prev) => ({ ...prev, titulo: e.target.value }))}
                                    placeholder="Ex: BÃ´nus de 50% em transferÃªncias"
                                    className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                                />
                            </div>

                            {/* Programa */}
                            <div className="space-y-2">
                                <label htmlFor="promo-programa" className="block text-sm font-medium text-fg-primary">
                                    Programa de fidelidade
                                </label>
                                <select
                                    id="promo-programa"
                                    value={form.programaId}
                                    onChange={(e) => setForm((prev) => ({ ...prev, programaId: e.target.value }))}
                                    className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                                >
                                    <option value="">Selecione um programa</option>
                                    {programas.map((p) => (
                                        <option key={p.id} value={p.id}>
                                            {p.nome}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            {/* DescriÃ§Ã£o */}
                            <div className="space-y-2 md:col-span-2">
                                <label htmlFor="promo-descricao" className="block text-sm font-medium text-fg-primary">
                                    DescriÃ§Ã£o
                                </label>
                                <textarea
                                    id="promo-descricao"
                                    rows={3}
                                    value={form.descricao}
                                    onChange={(e) => setForm((prev) => ({ ...prev, descricao: e.target.value }))}
                                    placeholder="Descreva os detalhes da promoÃ§Ã£o..."
                                    className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all resize-none"
                                />
                            </div>

                            {/* Data InÃ­cio */}
                            <div className="space-y-2">
                                <label htmlFor="promo-inicio" className="block text-sm font-medium text-fg-primary">
                                    Data de inÃ­cio
                                </label>
                                <input
                                    id="promo-inicio"
                                    type="date"
                                    value={form.dataInicio}
                                    onChange={(e) => setForm((prev) => ({ ...prev, dataInicio: e.target.value }))}
                                    className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                                />
                            </div>

                            {/* Data Fim */}
                            <div className="space-y-2">
                                <label htmlFor="promo-fim" className="block text-sm font-medium text-fg-primary">
                                    Data de validade
                                </label>
                                <input
                                    id="promo-fim"
                                    type="date"
                                    value={form.dataFim}
                                    onChange={(e) => setForm((prev) => ({ ...prev, dataFim: e.target.value }))}
                                    min={form.dataInicio}
                                    className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                                />
                            </div>
                        </div>

                        {/* Ativo checkbox */}
                        <div className="flex items-center gap-3">
                            <input
                                id="promo-ativo"
                                type="checkbox"
                                checked={form.ativo}
                                onChange={(e) => setForm((prev) => ({ ...prev, ativo: e.target.checked }))}
                                className="h-4 w-4 rounded border-white/10 bg-white/5 text-accent-pool focus:ring-accent-pool/20"
                            />
                            <label htmlFor="promo-ativo" className="text-sm text-fg-primary">
                                PromoÃ§Ã£o ativa
                            </label>
                        </div>

                        {/* Actions */}
                        <div className="flex justify-end gap-3 pt-2">
                            <button type="button" onClick={resetForm} className="btn-secondary">
                                Cancelar
                            </button>
                            <button type="submit" disabled={saving} className="btn-primary disabled:opacity-50">
                                {saving ? (
                                    <>
                                        <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                                        Salvando...
                                    </>
                                ) : (
                                    <>
                                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                        </svg>
                                        {editingPromo ? 'Atualizar' : 'Criar promoÃ§Ã£o'}
                                    </>
                                )}
                            </button>
                        </div>
                    </form>
                </div>
            )}

            {/* Promotions Grid */}
            {loading ? (
                <div className="dashboard-card">
                    <LoadingSpinner message="Carregando promoÃ§Ãµes..." />
                </div>
            ) : promocoes.length === 0 ? (
                <div className="dashboard-card flex flex-col items-center justify-center gap-4 py-12">
                    <div className="rounded-full bg-white/5 p-6">
                        <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                        </svg>
                    </div>
                    <div className="text-center">
                        <p className="font-medium text-fg-primary">Nenhuma promoÃ§Ã£o disponÃ­vel</p>
                        <p className="mt-1 text-sm text-fg-secondary">
                            {isAdmin ? 'Cadastre a primeira promoÃ§Ã£o.' : 'Volte mais tarde para conferir novas ofertas.'}
                        </p>
                    </div>
                    {isAdmin && (
                        <button
                            type="button"
                            onClick={() => setShowForm(true)}
                            className="btn-primary mt-2"
                        >
                            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                            Criar promoÃ§Ã£o
                        </button>
                    )}
                </div>
            ) : (
                <div className="grid gap-6 grid-cols-[repeat(auto-fill,minmax(20rem,1fr))]">
                    {promocoes.map((promo) => {
                        const daysLeft = getDaysUntilExpiration(promo.dataFim)
                        const isExpired = daysLeft < 0
                        const isUrgent = daysLeft >= 0 && daysLeft <= 3
                        const programaIdNum = typeof promo.programaId === 'object' ? promo.programaId.id : promo.programaId
                        const programaNome = promo.programa?.nome ?? programaMap.get(programaIdNum) ?? 'Programa'

                        return (
                            <div
                                key={promo.id}
                                className={`dashboard-card relative overflow-hidden transition-all duration-300 ${isExpired ? 'opacity-60' : ''
                                    } ${isUrgent && !isExpired ? 'border-yellow-500/30' : ''}`}
                            >
                                {/* Urgency Badge */}
                                {isUrgent && !isExpired && (
                                    <div className={`absolute right-3 top-3 z-10 flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-semibold ${daysLeft <= 1 ? 'bg-red-500/20 text-red-400' : 'bg-yellow-500/20 text-yellow-400'
                                        }`}>
                                        <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        {daysLeft === 0 ? 'Ãšltimo dia!' : `${daysLeft} dia${daysLeft > 1 ? 's' : ''}`}
                                    </div>
                                )}

                                {/* Expired Badge */}
                                {isExpired && (
                                    <div className="absolute right-3 top-3 z-10 rounded-full bg-fg-secondary/20 px-2.5 py-1 text-xs font-semibold text-fg-secondary">
                                        Expirada
                                    </div>
                                )}

                                {/* Header */}
                                <div className="section-header mb-4">
                                    <div className="card-icon">
                                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                                        </svg>
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <span className="badge">{programaNome}</span>
                                    </div>
                                </div>

                                {/* Content */}
                                <div className="flex-1">
                                    <h3 className="text-lg font-semibold text-fg-primary line-clamp-2">
                                        {promo.titulo}
                                    </h3>
                                    <p className="mt-2 text-sm text-fg-secondary line-clamp-3">
                                        {promo.descricao || 'Sem descriÃ§Ã£o disponÃ­vel.'}
                                    </p>
                                </div>

                                {/* Footer */}
                                <div className="mt-4 pt-4 border-t border-white/10">
                                    {/* Date info */}
                                    <div className="flex items-center gap-2 text-xs text-fg-secondary mb-4">
                                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                                        </svg>
                                        <span>VÃ¡lido atÃ© {formatDate(promo.dataFim)}</span>
                                    </div>

                                    {/* Admin Actions */}
                                    {isAdmin && (
                                        <div className="flex gap-1">
                                            <button
                                                type="button"
                                                onClick={() => openEditForm(promo)}
                                                className="p-2 rounded-lg text-fg-secondary hover:text-accent-pool hover:bg-accent-pool/10 transition-colors"
                                                title="Editar"
                                            >
                                                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                                </svg>
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => handleDeleteConfirm(promo.id)}
                                                disabled={deletingId === promo.id}
                                                className="p-2 rounded-lg text-fg-secondary hover:text-red-400 hover:bg-red-500/10 transition-colors disabled:opacity-50"
                                                title="Excluir"
                                            >
                                                {deletingId === promo.id ? (
                                                    <div className="h-4 w-4 animate-spin rounded-full border-2 border-red-400 border-t-transparent" />
                                                ) : (
                                                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                                    </svg>
                                                )}
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Delete Confirmation */}
                                {confirmDeleteId === promo.id && (
                                    <div className="mt-3 p-3 rounded-lg bg-red-500/10 border border-red-500/30">
                                        <p className="text-xs text-red-400 mb-2">Excluir esta promoÃ§Ã£o?</p>
                                        <div className="flex gap-2">
                                            <button
                                                type="button"
                                                onClick={handleDeleteCancel}
                                                className="flex-1 rounded-lg border border-white/20 bg-gray-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-gray-500 transition-colors"
                                            >
                                                Cancelar
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => handleDelete(promo.id)}
                                                className="flex-1 rounded-lg bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600 transition-colors"
                                            >
                                                Excluir
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )
                    })}
                </div>
            )}
        </section>
    )
}

  </file>
  <file name='src\pages\Dashboard\RegistrarPontos.tsx'>
import { useCallback, useEffect, useMemo, useState } from 'react'
import { NavLink } from 'react-router-dom'
import { cartaoUsuarioService } from '../../services/cartaoUsuario/cartaoUsuario.service'
import { programaFidelidadeService } from '../../services/programaFidelidade/programaFidelidade.service'
import { movimentacaoPontosService } from '../../services/movimentacaoPontos/movimentacaoPontos.service'
import { comprovanteService } from '../../services/comprovante/comprovante.service'
import { saldoUsuarioProgramaService } from '../../services/saldoUsuarioPrograma/saldoUsuarioPrograma.service'
import { notify } from '../../utils/notify'
import { formatCurrency, formatPoints } from '../../utils/format'
import { getTipoLabel } from '../../utils/cardConstants'
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import PageHeader from '../../components/ui/PageHeader'
import TabButton from '../../components/ui/TabButton'
import CreditCardPreview, { type CardVariant } from '../../components/dashboard/cartoes/CreditCardPreview'
import type { CartaoResponseDTO } from '../../interfaces/cartaoUsuario'
import type { MovimentacaoRequestDTO } from '../../interfaces/movimentacaoPontos'
import type { ProgramaComPromocoesResponseDTO } from '../../interfaces/programaFidelidade'
import type { SaldoResponseDTO } from '../../interfaces/saldoUsuarioPrograma'

type ModoMovimentacao = 'acumular' | 'resgatar'

// Helper para converter bandeira em variante visual do cartÃ£o
const getCardVariant = (bandeira?: string): CardVariant => {
  switch (bandeira) {
    case 'VISA':
      return 'black'
    case 'MASTERCARD':
      return 'mastercard'
    case 'AMERICAN_EXPRESS':
      return 'gold'
    case 'ELO':
      return 'elo'
    case 'HIPERCARD':
      return 'hipercard'
    default:
      return 'platinum'
  }
}

export default function RegistrarPontos() {
  const [cards, setCards] = useState<CartaoResponseDTO[]>([])
  const [programasComPromocoes, setProgramasComPromocoes] = useState<ProgramaComPromocoesResponseDTO[]>([])
  const [saldos, setSaldos] = useState<SaldoResponseDTO[]>([])
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)

  // Estado do modo ativo
  const [modoAtivo, setModoAtivo] = useState<ModoMovimentacao>('acumular')
  const isResgate = modoAtivo === 'resgatar'

  // Estado do formulÃ¡rio - Acumular
  const [cartaoId, setCartaoId] = useState<string>('')
  const [programaId, setProgramaId] = useState<string>('')
  const [promocaoId, setPromocaoId] = useState<string>('')
  const [valor, setValor] = useState<string>('')
  const [data, setData] = useState<string>(new Date().toISOString().split('T')[0])
  const [file, setFile] = useState<File | null>(null)
  const [dragActive, setDragActive] = useState(false)

  // Estado do formulÃ¡rio - Resgatar
  const [quantidadePontos, setQuantidadePontos] = useState<string>('')

  // Carrega cartÃµes e programas
  useEffect(() => {
    let isActive = true

    const loadData = async () => {
      try {
        const [cardData, programasData, saldosData] = await Promise.all([
          cartaoUsuarioService.list(),
          programaFidelidadeService.list(),
          saldoUsuarioProgramaService.list(),
        ])
        if (!isActive) return
        setCards(Array.isArray(cardData) ? cardData : [])
        setProgramasComPromocoes(Array.isArray(programasData) ? programasData : [])
        setSaldos(Array.isArray(saldosData) ? saldosData : [])
      } catch (error) {
        notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel carregar os dados.' })
      } finally {
        if (isActive) setLoading(false)
      }
    }

    loadData()
    return () => { isActive = false }
  }, [])

  // CartÃ£o selecionado
  const selectedCard = useMemo(() => {
    if (!cartaoId) return null
    return cards.find((c) => c.id === Number(cartaoId)) ?? null
  }, [cartaoId, cards])

  // Programas disponÃ­veis - do cartÃ£o (acÃºmulo) ou todos (resgate)
  const availablePrograms = useMemo(() => {
    if (isResgate) {
      // Para resgate: mostrar todos os programas disponÃ­veis
      return programasComPromocoes.map(p => ({ id: p.id, nome: p.nome, descricao: p.descricao }))
    }
    // Para acÃºmulo: apenas programas do cartÃ£o selecionado
    return selectedCard?.programas ?? []
  }, [isResgate, selectedCard, programasComPromocoes])

  // PromoÃ§Ãµes disponÃ­veis - obtÃ©m de programasComPromocoes baseado no programa selecionado
  const availablePromocoes = useMemo(() => {
    if (!programaId) return []
    const programaCompleto = programasComPromocoes.find(p => p.id === Number(programaId))
    if (!programaCompleto?.promocoes) return []
    // Filtra apenas promoÃ§Ãµes ativas (ativo === 'ATIVO' e dataFim >= hoje)
    const today = new Date().toISOString().split('T')[0]
    return programaCompleto.promocoes.filter(
      p => p.ativo === 'ATIVO' && p.dataFim >= today
    )
  }, [programaId, programasComPromocoes])

  // PromoÃ§Ã£o selecionada (para exibir multiplicador)
  const promocaoSelecionada = useMemo(() => {
    if (!promocaoId) return null
    return availablePromocoes.find(p => p.id === Number(promocaoId)) ?? null
  }, [promocaoId, availablePromocoes])

  // Saldo disponÃ­vel do programa selecionado (para modo Resgate)
  const saldoDisponivelPrograma = useMemo(() => {
    if (!programaId) return null
    const saldo = saldos.find(s => s.programaId?.id === Number(programaId))
    return saldo?.pontos ?? 0
  }, [programaId, saldos])

  // CÃ¡lculo de previsÃ£o de pontos (apenas para modo Acumular)
  const previsaoPontos = useMemo(() => {
    if (isResgate || !valor || !promocaoId) return null
    if (!promocaoSelecionada) return null
    const valorNumerico = parseFloat(valor.replace(',', '.')) || 0
    return Math.floor(valorNumerico * promocaoSelecionada.pontosPorReal)
  }, [isResgate, valor, promocaoId, promocaoSelecionada])

  // Reseta programa e promoÃ§Ã£o quando cartÃ£o muda
  useEffect(() => {
    setProgramaId('')
    setPromocaoId('')
  }, [cartaoId])

  // Reseta promoÃ§Ã£o quando programa muda
  useEffect(() => {
    setPromocaoId('')
  }, [programaId])

  // Lida com eventos de arrastar
  const handleDrag = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    e.stopPropagation()
    if (e.type === 'dragenter' || e.type === 'dragover') {
      setDragActive(true)
    } else if (e.type === 'dragleave') {
      setDragActive(false)
    }
  }, [])

  // Lida com soltar
  const handleDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    e.stopPropagation()
    setDragActive(false)

    const droppedFile = e.dataTransfer.files?.[0]
    if (droppedFile) {
      const validTypes = ['application/pdf', 'image/png', 'image/jpeg', 'image/jpg']
      if (validTypes.includes(droppedFile.type)) {
        setFile(droppedFile)
      } else {
        notify.error('Arquivo invÃ¡lido. Use PDF, PNG ou JPG.')
      }
    }
  }, [])

  // Lida com envio do formulÃ¡rio
  const handleSubmit = useCallback(async (e: React.FormEvent) => {
    e.preventDefault()

    // Para acÃºmulo, cartÃ£o Ã© obrigatÃ³rio
    if (!isResgate && !cartaoId) {
      notify.warn('Selecione um cartÃ£o.')
      return
    }

    if (!programaId) {
      notify.warn('Selecione um programa de fidelidade.')
      return
    }

    if (isResgate) {
      // ValidaÃ§Ãµes especÃ­ficas para resgate
      if (!quantidadePontos || parseInt(quantidadePontos) <= 0) {
        notify.warn('Informe uma quantidade de pontos vÃ¡lida.')
        return
      }
    } else {
      // ValidaÃ§Ãµes especÃ­ficas para acÃºmulo
      if (!promocaoId) {
        notify.warn('Selecione uma promoÃ§Ã£o.')
        return
      }

      if (!valor || parseFloat(valor.replace(',', '.')) <= 0) {
        notify.warn('Informe um valor vÃ¡lido.')
        return
      }
    }

    if (!data) {
      notify.warn('Informe a data.')
      return
    }

    setSaving(true)

    const payload: MovimentacaoRequestDTO = {
      programaId: Number(programaId),
      data: data,
      ...(isResgate
        ? { quantidadePontos: parseInt(quantidadePontos) }
        : {
          cartaoId: Number(cartaoId),
          promocaoId: Number(promocaoId),
          valor: parseFloat(valor.replace(',', '.'))
        }
      ),
    }

    try {
      const response = await movimentacaoPontosService.create(payload)

      if (file && !isResgate) {
        try {
          await comprovanteService.create({ movimentacaoId: response.id, file })
        } catch {
          notify.warn('MovimentaÃ§Ã£o registrada, mas houve erro ao enviar o comprovante.')
        }
      }

      notify.success(isResgate ? 'Resgate registrado com sucesso!' : 'MovimentaÃ§Ã£o registrada com sucesso!')

      // Reseta formulÃ¡rio
      setCartaoId('')
      setProgramaId('')
      setPromocaoId('')
      setValor('')
      setQuantidadePontos('')
      setData(new Date().toISOString().split('T')[0])
      setFile(null)
    } catch (error) {
      notify.apiError(error, { fallback: isResgate ? 'NÃ£o foi possÃ­vel registrar o resgate.' : 'NÃ£o foi possÃ­vel registrar a movimentaÃ§Ã£o.' })
    } finally {
      setSaving(false)
    }
  }, [cartaoId, programaId, promocaoId, valor, data, file, isResgate, quantidadePontos])

  return (
    <section className="space-y-6">
      <PageHeader
        title={isResgate ? 'Resgatar pontos' : 'Registrar pontos'}
        description={
          isResgate
            ? 'Registre o uso dos seus pontos acumulados.'
            : 'Registre uma compra e acumule pontos automaticamente.'
        }
      >
        <NavLink
          to="/dashboard/movimentacoes"
          className="btn-secondary"
        >
          <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
          </svg>
          Ver movimentaÃ§Ãµes
        </NavLink>
      </PageHeader>

      {/* NavegaÃ§Ã£o por abas */}
      <div className="flex gap-2">
        <TabButton active={modoAtivo === 'acumular'} onClick={() => setModoAtivo('acumular')}>
          <svg className="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Acumular Pontos
        </TabButton>
        <TabButton active={modoAtivo === 'resgatar'} onClick={() => setModoAtivo('resgatar')}>
          <svg className={`h-4 w-4 mr-1.5 ${isResgate ? 'text-red-400' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M5 12h14" />
          </svg>
          <span className={isResgate ? 'text-red-400' : ''}>Resgatar/Utilizar</span>
        </TabButton>
      </div>

      {loading ? (
        <div className="dashboard-card !min-h-0">
          <LoadingSpinner message="Carregando dados..." />
        </div>
      ) : cards.length === 0 ? (
        <div className="dashboard-card !min-h-0 flex flex-col items-center justify-center gap-4 py-12">
          <div className="rounded-full bg-white/5 p-6">
            <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
            </svg>
          </div>
          <div className="text-center">
            <p className="font-medium text-fg-primary">Nenhum cartÃ£o cadastrado</p>
            <p className="mt-1 text-sm text-fg-secondary">
              Cadastre um cartÃ£o antes de registrar pontos.
            </p>
          </div>
          <NavLink to="/dashboard/cartoes" className="btn-primary mt-2">
            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Cadastrar cartÃ£o
          </NavLink>
        </div>
      ) : (
        <form onSubmit={handleSubmit} className="grid items-start gap-6 lg:grid-cols-3">
          {/* Coluna Esquerda - FormulÃ¡rio */}
          <div className="lg:col-span-2 flex flex-col gap-4">
            {/* Alerta visual para resgate */}
            {isResgate && (
              <div className="flex items-center gap-3 rounded-xl border border-red-500/30 bg-red-500/10 px-4 py-3">
                <svg className="h-5 w-5 text-red-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                </svg>
                <p className="text-sm text-red-300">
                  <strong>AtenÃ§Ã£o:</strong> VocÃª estÃ¡ registrando uma saÃ­da de pontos do seu saldo.
                </p>
              </div>
            )}

            {/* SeleÃ§Ã£o de CartÃ£o - apenas para Acumular */}
            {!isResgate && (
              <div className="dashboard-card !min-h-0 p-5">
                <div className="section-header mb-4">
                  <div className="card-icon">
                    <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                    </svg>
                  </div>
                  <div className="flex-1">
                    <h2 className="section-title text-base">Selecione o cartÃ£o</h2>
                  </div>
                </div>

                <div className="grid gap-4 grid-cols-[repeat(auto-fill,minmax(14rem,1fr))]">
                  {cards.map((card, index) => {
                    const isSelected = cartaoId === String(card.id)
                    const variant = getCardVariant(card.bandeira)

                    return (
                      <button
                        key={card.id}
                        type="button"
                        onClick={() => setCartaoId(String(card.id))}
                        className={`group relative rounded-xl transition-all duration-300 ${isSelected
                          ? 'ring-2 ring-accent-pool ring-offset-2 ring-offset-bg-primary scale-[1.02]'
                          : 'hover:scale-[1.01] hover:shadow-lg'
                          }`}
                      >
                        <CreditCardPreview
                          holderName={card.nome ?? `CartÃ£o ${index + 1}`}
                          lastDigits={card.numero ? card.numero.slice(-4) : '****'}
                          cardTier={getTipoLabel(card.tipo) ?? 'CrÃ©dito'}
                          variant={variant}
                          size="mini"
                        />
                        {/* Selection indicator */}
                        {isSelected && (
                          <div className="absolute -top-1.5 -right-1.5 flex h-5 w-5 items-center justify-center rounded-full bg-accent-pool shadow-lg">
                            <svg className="h-3 w-3 text-white" fill="currentColor" viewBox="0 0 24 24">
                              <path fillRule="evenodd" d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z" clipRule="evenodd" />
                            </svg>
                          </div>
                        )}
                      </button>
                    )
                  })}
                </div>
              </div>
            )}

            {/* Programa + Valor/Pontos + Data */}
            <div className="dashboard-card !min-h-0 p-5 !h-fit w-full">
              <div className="section-header mb-4">
                <div className={`card-icon ${isResgate ? '!bg-red-500/20' : ''}`}>
                  <svg className={`h-5 w-5 ${isResgate ? 'text-red-400' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div className="flex-1">
                  <h2 className="section-title text-base">
                    {isResgate ? 'Dados do resgate' : 'Dados da compra'}
                  </h2>
                </div>
              </div>

              <div className="grid gap-4 md:grid-cols-2">
                {/* Programa */}
                <div className="space-y-1.5">
                  <label htmlFor="programa" className="block text-xs font-medium text-fg-primary">
                    Programa de fidelidade
                  </label>
                  <select
                    id="programa"
                    value={programaId}
                    onChange={(e) => setProgramaId(e.target.value)}
                    disabled={!isResgate && !cartaoId}
                    className="w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all disabled:opacity-50"
                  >
                    <option value="">
                      {isResgate
                        ? 'Selecione o programa'
                        : cartaoId
                          ? 'Selecione o programa'
                          : 'Selecione cartÃ£o primeiro'}
                    </option>
                    {availablePrograms.map((prog) => (
                      <option key={prog.id} value={prog.id}>
                        {prog.nome}
                      </option>
                    ))}
                  </select>
                </div>

                {/* PromoÃ§Ã£o - apenas para Acumular */}
                {!isResgate && (
                  <div className="space-y-1.5">
                    <label htmlFor="promocao" className="block text-xs font-medium text-fg-primary">
                      PromoÃ§Ã£o ativa
                    </label>
                    <select
                      id="promocao"
                      value={promocaoId}
                      onChange={(e) => setPromocaoId(e.target.value)}
                      disabled={!programaId || availablePromocoes.length === 0}
                      className="w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all disabled:opacity-50"
                    >
                      <option value="">
                        {!programaId
                          ? 'Selecione programa primeiro'
                          : availablePromocoes.length === 0
                            ? 'Nenhuma promoÃ§Ã£o ativa'
                            : 'Selecione a promoÃ§Ã£o'}
                      </option>
                      {availablePromocoes.map((promo) => (
                        <option key={promo.id} value={promo.id}>
                          {promo.titulo} ({promo.pontosPorReal}pts/R$)
                        </option>
                      ))}
                    </select>
                  </div>
                )}

                {/* Data */}
                <div className="space-y-1.5">
                  <label htmlFor="data" className="block text-xs font-medium text-fg-primary">
                    {isResgate ? 'Data do resgate' : 'Data da compra'}
                  </label>
                  <input
                    id="data"
                    type="date"
                    value={data}
                    onChange={(e) => setData(e.target.value)}
                    max={new Date().toISOString().split('T')[0]}
                    className="w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                  />
                </div>

                {/* Valor (Acumular) ou Quantidade de Pontos (Resgatar) */}
                {isResgate ? (
                  <div className="space-y-1.5">
                    <label htmlFor="quantidadePontos" className="block text-xs font-medium text-fg-primary">
                      Quantidade de pontos
                    </label>
                    <div className="relative">
                      <span className="absolute left-3 top-1/2 -translate-y-1/2 text-red-400 text-sm">pts</span>
                      <input
                        id="quantidadePontos"
                        type="text"
                        inputMode="numeric"
                        value={quantidadePontos}
                        onChange={(e) => {
                          // Allow only numbers
                          const val = e.target.value.replace(/[^0-9]/g, '')
                          setQuantidadePontos(val)
                        }}
                        placeholder="0"
                        className="w-full rounded-xl border border-red-500/30 bg-red-500/5 pl-10 pr-4 py-2.5 text-sm text-fg-primary focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500/20 transition-all font-medium"
                      />
                    </div>
                  </div>
                ) : (
                  <div className="space-y-1.5">
                    <label htmlFor="valor" className="block text-xs font-medium text-fg-primary">
                      Valor da compra (R$)
                    </label>
                    <div className="relative">
                      <span className="absolute left-3 top-1/2 -translate-y-1/2 text-fg-secondary text-sm">R$</span>
                      <input
                        id="valor"
                        type="text"
                        inputMode="decimal"
                        value={valor}
                        onChange={(e) => {
                          // Allow only numbers, comma and dot
                          const val = e.target.value.replace(/[^0-9.,]/g, '')
                          setValor(val)
                        }}
                        placeholder="0,00"
                        className="w-full rounded-xl border border-white/10 bg-white/5 pl-10 pr-4 py-2.5 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all font-medium"
                      />
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Coluna Direita - PrÃ©via e Upload de Arquivo */}
          <div className="space-y-4 self-start">
            {/* PrÃ©via de Pontos - apenas para Acumular */}
            {!isResgate ? (
              <div className="dashboard-card stat-card !min-h-0 p-5">
                <div className="section-header mb-4">
                  <div className="card-icon">
                    <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                    </svg>
                  </div>
                  <div className="flex-1">
                    <h2 className="section-title text-base">PrevisÃ£o de pontos</h2>
                  </div>
                </div>

                <div className="text-center">
                  {previsaoPontos !== null ? (
                    <>
                      <p className="text-4xl font-bold text-accent-pool">
                        +{formatPoints(previsaoPontos)}
                      </p>
                      <p className="mt-1 text-xs text-fg-secondary">pontos a acumular</p>
                      {/* Destaque do multiplicador */}
                      {promocaoSelecionada && (
                        <div className="mt-3 inline-flex items-center gap-1.5 rounded-full bg-accent-pool/10 px-3 py-1">
                          <svg className="h-3.5 w-3.5 text-accent-pool" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                          </svg>
                          <span className="text-xs font-semibold text-accent-pool">
                            {promocaoSelecionada.pontosPorReal}x pts/R$
                          </span>
                        </div>
                      )}
                    </>
                  ) : (
                    <div className="rounded-xl border border-white/10 bg-white/5 p-4">
                      <svg className="mx-auto h-8 w-8 text-fg-secondary/40" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                      </svg>
                      <p className="mt-2 text-xs text-fg-secondary">
                        Preencha o valor e selecione uma promoÃ§Ã£o para ver a previsÃ£o.
                      </p>
                    </div>
                  )}

                  {/* Resumo da compra quando dados preenchidos */}
                  {selectedCard && valor && (
                    <div className="mt-4 space-y-2 text-xs text-fg-secondary">
                      <div className="flex items-center justify-between">
                        <span>CartÃ£o</span>
                        <span className="font-medium text-fg-primary truncate max-w-[60%]">
                          {selectedCard.nome}
                        </span>
                      </div>
                      <div className="flex items-center justify-between">
                        <span>Valor</span>
                        <span className="font-medium text-fg-primary">
                          {formatCurrency(parseFloat(valor.replace(',', '.')) || 0)}
                        </span>
                      </div>
                    </div>
                  )}
                </div>

                {/* BotÃ£o de Enviar */}
                <button
                  type="submit"
                  disabled={saving || !cartaoId || !programaId || !promocaoId || !valor}
                  className="mt-5 w-full btn-primary justify-center disabled:opacity-50 disabled:cursor-not-allowed py-3"
                >
                  {saving ? (
                    <>
                      <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                      Registrando...
                    </>
                  ) : (
                    <>
                      <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                      </svg>
                      Registrar pontos
                    </>
                  )}
                </button>
              </div>
            ) : (
              // Card de confirmaÃ§Ã£o para Resgate
              <div className="dashboard-card stat-card !min-h-0 p-5 border-red-500/30">
                <div className="section-header mb-4">
                  <div className="card-icon !bg-red-500/20">
                    <svg className="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                  </div>
                  <div className="flex-1">
                    <h2 className="section-title text-base">Confirmar resgate</h2>
                  </div>
                </div>

                <div className="text-center">
                  {quantidadePontos && parseInt(quantidadePontos) > 0 ? (
                    <>
                      <p className="text-4xl font-bold text-red-400">
                        -{formatPoints(parseInt(quantidadePontos))}
                      </p>
                      <p className="mt-1 text-xs text-fg-secondary">pontos a resgatar</p>
                    </>
                  ) : (
                    <div className="rounded-xl border border-red-500/20 bg-red-500/5 p-4">
                      <svg className="mx-auto h-8 w-8 text-red-400/40" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M5 12h14" />
                      </svg>
                      <p className="mt-2 text-xs text-fg-secondary">
                        Informe a quantidade de pontos que deseja resgatar.
                      </p>
                    </div>
                  )}

                  {/* Saldo disponÃ­vel do programa */}
                  {programaId && (
                    <div className="mt-4 rounded-xl border border-white/10 bg-white/5 p-3">
                      <div className="flex items-center justify-between text-xs">
                        <span className="text-fg-secondary">Saldo disponÃ­vel</span>
                        <span className={`font-semibold ${quantidadePontos && parseInt(quantidadePontos) > (saldoDisponivelPrograma ?? 0)
                          ? 'text-red-400'
                          : 'text-accent-pool'
                          }`}>
                          {formatPoints(saldoDisponivelPrograma ?? 0)} pts
                        </span>
                      </div>
                      {quantidadePontos && parseInt(quantidadePontos) > (saldoDisponivelPrograma ?? 0) && (
                        <p className="mt-2 text-[0.625rem] text-red-400">
                          âš ï¸ Saldo insuficiente para este resgate
                        </p>
                      )}
                    </div>
                  )}
                </div>

                {/* BotÃ£o de Resgatar */}
                <button
                  type="submit"
                  disabled={saving || !programaId || !quantidadePontos || (parseInt(quantidadePontos) > (saldoDisponivelPrograma ?? 0))}
                  className="mt-5 w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed py-3 inline-flex items-center gap-2 px-4 font-medium rounded-xl transition-all duration-200 bg-gradient-to-r from-red-600 to-red-500 text-white shadow-lg shadow-red-500/25 hover:shadow-red-500/40 hover:scale-[1.02]"
                >
                  {saving ? (
                    <>
                      <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                      Resgatando...
                    </>
                  ) : (
                    <>
                      <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M5 12h14" />
                      </svg>
                      Resgatar pontos
                    </>
                  )}
                </button>
              </div>
            )}

            {/* Upload de Arquivo - apenas para Acumular */}
            {!isResgate && (
              <div className="dashboard-card !min-h-0 p-4">
                <div className="section-header mb-3">
                  <div className="card-icon !h-8 !w-8">
                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                      <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                  </div>
                  <div className="flex-1">
                    <h2 className="section-title text-sm">Comprovante</h2>
                    <p className="text-[0.625rem] text-fg-secondary">Opcional</p>
                  </div>
                </div>

                <div
                  onDragEnter={handleDrag}
                  onDragLeave={handleDrag}
                  onDragOver={handleDrag}
                  onDrop={handleDrop}
                  className={`rounded-xl border border-dashed text-center transition-all ${dragActive
                    ? 'border-accent-pool bg-accent-pool/10 py-6'
                    : file
                      ? 'border-accent-pool/50 bg-accent-pool/5 py-3'
                      : 'border-fg-secondary/20 hover:border-fg-secondary/40 py-6'
                    }`}
                >
                  {file ? (
                    <div className="flex items-center justify-center gap-3">
                      <svg className="h-4 w-4 text-accent-pool" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <div className="text-left min-w-0 max-w-[7.5rem]">
                        <p className="truncate font-medium text-xs text-fg-primary">{file.name}</p>
                      </div>
                      <button
                        type="button"
                        onClick={() => setFile(null)}
                        className="rounded p-1 text-fg-secondary hover:bg-red-500/10 hover:text-red-400 transition-colors"
                      >
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                          <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                      </button>
                    </div>
                  ) : (
                    <>
                      <p className="text-[0.625rem] text-fg-secondary">
                        Arraste ou
                        <label className="mx-1 cursor-pointer font-semibold text-accent-pool hover:underline">
                          selecione
                          <input
                            type="file"
                            accept=".pdf,.png,.jpg,.jpeg"
                            onChange={(e) => setFile(e.target.files?.[0] ?? null)}
                            className="hidden"
                          />
                        </label>
                      </p>
                    </>
                  )}
                </div>
              </div>
            )}
          </div>
        </form>
      )}
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\Relatorios.tsx'>
import { useRelatoriosDashboard } from '../../hooks/useRelatoriosDashboard'
import LoadingSpinner from '../../components/ui/LoadingSpinner'
import PageHeader from '../../components/ui/PageHeader'
import { LineChart, DonutChart } from '../../components/dashboard/relatorios/RelatorioCharts'
import { RelatorioSummary } from '../../components/dashboard/relatorios/RelatorioSummary'
import { RelatorioHistory } from '../../components/dashboard/relatorios/RelatorioHistory'

export default function Relatorios() {
  const {
    data,
    loading,
    stats,
    exportingPdf,
    exportingCsv,
    handleExportPdf,
    handleExportCsv
  } = useRelatoriosDashboard()

  if (loading) {
    return (
      <section className="space-y-6">
        <header>
          <h1 className="titulo-grafico text-2xl font-bold">RelatÃ³rios de Desempenho</h1>
          <p className="mt-1 text-sm text-fg-secondary">Analise a evoluÃ§Ã£o dos seus pontos.</p>
        </header>
        <div className="dashboard-card">
          <LoadingSpinner message="Carregando relatÃ³rios..." />
        </div>
      </section>
    )
  }

  return (
    <section className="space-y-6">
      {/* Header */}
      <PageHeader
        title="RelatÃ³rios de Desempenho"
        description="Analise a evoluÃ§Ã£o dos seus pontos e cartÃµes."
      >
        <div className="flex items-center gap-2">
          <button
            type="button"
            onClick={handleExportPdf}
            disabled={exportingPdf}
            className="btn-secondary disabled:opacity-50"
          >
            {exportingPdf ? (
              <div className="h-4 w-4 animate-spin rounded-full border-2 border-fg-primary border-t-transparent" />
            ) : (
              <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
              </svg>
            )}
            Baixar PDF
          </button>
          <button
            type="button"
            onClick={handleExportCsv}
            disabled={exportingCsv}
            className="btn-secondary disabled:opacity-50"
          >
            {exportingCsv ? (
              <div className="h-4 w-4 animate-spin rounded-full border-2 border-fg-primary border-t-transparent" />
            ) : (
              <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125" />
              </svg>
            )}
            Baixar CSV
          </button>
        </div>
      </PageHeader>

      {/* Summary Stats */}
      {stats && <RelatorioSummary stats={stats} />}

      {/* Charts Grid */}
      <div className="grid gap-6 lg:grid-cols-2">
        {/* Evolution Chart */}
        <div className="dashboard-card">
          <div className="section-header mb-6">
            <div className="card-icon">
              <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
              </svg>
            </div>
            <div className="flex-1">
              <h2 className="section-title">EvoluÃ§Ã£o Mensal</h2>
              <p className="text-xs text-fg-secondary">Crescimento dos pontos ao longo do tempo</p>
            </div>
          </div>
          <LineChart data={data?.evolucaoMensal ?? []} />
        </div>

        {/* Distribution Chart */}
        <div className="dashboard-card">
          <div className="section-header mb-6">
            <div className="card-icon">
              <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" />
                <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" />
              </svg>
            </div>
            <div className="flex-1">
              <h2 className="section-title">DistribuiÃ§Ã£o por CartÃ£o</h2>
              <p className="text-xs text-fg-secondary">Pontos acumulados em cada cartÃ£o</p>
            </div>
          </div>
          <DonutChart data={data?.pontosPorCartao ?? []} />
        </div>
      </div>

      {/* History Table */}
      <RelatorioHistory historico={data?.historico ?? []} />
    </section>
  )
}

  </file>
  <file name='src\pages\Dashboard\utils.ts'>
import visaLogo from '../../assets/brands/bandeiras/visa.svg'
import mastercardLogo from '../../assets/brands/bandeiras/mastercard.svg'
import amexLogo from '../../assets/brands/bandeiras/amex.svg'
import eloLogo from '../../assets/brands/bandeiras/elo.svg'
import hipercardLogo from '../../assets/brands/bandeiras/hipercard.svg'

// Constants
export const chartWidth = 240
export const chartHeight = 80

// Helpers
export const toNumber = (value: unknown): number => {
    if (typeof value === 'number') return value
    if (typeof value === 'string') return Number(value.replace(',', '.'))
    return 0
}

export const buildLinePoints = (values: number[]): string => {
    if (!values.length) return ''
    const maxValue = Math.max(...values, 1)
    const step = values.length > 1 ? chartWidth / (values.length - 1) : chartWidth
    return values
        .map((value, index) => {
            const x = Math.round(index * step)
            const y = Math.round(chartHeight - (value / maxValue) * (chartHeight - 18) - 6)
            return `${x},${y}`
        })
        .join(' ')
}

export const buildAreaPolygon = (values: number[]): string => {
    if (!values.length) return ''
    const points = buildLinePoints(values)
    return `0,${chartHeight} ${points} ${chartWidth},${chartHeight}`
}

export const getBrandLogo = (bandeira?: string): string | null => {
    switch (bandeira) {
        case 'VISA': return visaLogo
        case 'MASTERCARD': return mastercardLogo
        case 'AMERICAN_EXPRESS': return amexLogo
        case 'ELO': return eloLogo
        case 'HIPERCARD': return hipercardLogo
        default: return null
    }
}

  </file>
  <file name='src\pages\ForgotPassword\index.tsx'>
import { useEffect, useRef, useState } from 'react'
import type { ChangeEvent, FormEvent } from 'react'
import axios from 'axios'
import { Link, useLocation } from 'react-router-dom'
import { authService } from '../../services/auth/auth.service'
import type { ForgotPasswordDTO } from '../../interfaces/auth'
import { notify } from '../../utils/notify'
import { hasErrors, normalizeEmail, validateForgotPassword } from '../../utils/validation'
import { AuthField, AuthPanel, IconMail, PrimaryAuthButton } from '../../components/auth/AuthUI'

type Props = {
  embedded?: boolean
}

export default function ForgotPassword({ embedded }: Props) {
  const formRef = useRef<HTMLFormElement | null>(null)
  const location = useLocation()

  const modalState = (location.state as { backgroundLocation?: unknown } | null)?.backgroundLocation
    ? location.state
    : undefined

  const [formData, setFormData] = useState<ForgotPasswordDTO>({
    email: '',
  })

  const [errors, setErrors] = useState<Partial<Record<keyof ForgotPasswordDTO, string>>>({})

  const [loading, setLoading] = useState(false)
  const [resetToken, setResetToken] = useState<string | null>(null)
  const [requestSent, setRequestSent] = useState(false)
  const [cooldownSeconds, setCooldownSeconds] = useState(0)

  const shouldExposeToken = import.meta.env.DEV

  const genericSuccessMessage =
    'Se o email estiver cadastrado, vocÃª receberÃ¡ instruÃ§Ãµes para redefinir sua senha.'

  useEffect(() => {
    if (cooldownSeconds <= 0) return

    const id = window.setInterval(() => {
      setCooldownSeconds((s) => (s > 1 ? s - 1 : 0))
    }, 1000)

    return () => window.clearInterval(id)
  }, [cooldownSeconds])

  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    setFormData((prev) => ({ ...prev, [e.target.name]: e.target.value }))
    const name = e.target.name as keyof ForgotPasswordDTO
    if (errors[name]) setErrors((prev) => ({ ...prev, [name]: undefined }))
  }

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault()

    if (loading || cooldownSeconds > 0) return

    const nextErrors = validateForgotPassword(formData)
    if (hasErrors(nextErrors)) {
      setErrors(nextErrors)

      setTimeout(() => {
        const form = formRef.current
        if (!form) return
        const el = form.querySelector<HTMLElement>('[name="email"]')
        el?.focus()
      }, 0)

      return
    }

    setLoading(true)
    setResetToken(null)
    setRequestSent(true)

    const payload: ForgotPasswordDTO = {
      email: normalizeEmail(formData.email),
    }

    try {
      const response = await authService.forgotPassword(payload)
      setResetToken(response.token)
      notify.success(genericSuccessMessage)
      setCooldownSeconds(10)
    } catch (error) {
      const status = axios.isAxiosError(error) ? error.response?.status : undefined

      // Comportamento mais seguro: nÃ£o revela se o email existe
      if (status === 404) {
        notify.success(genericSuccessMessage)
        setCooldownSeconds(10)
        return
      }

      notify.apiError(error)
    } finally {
      setLoading(false)
    }
  }

  const copyToken = async () => {
    if (!resetToken) return

    try {
      await navigator.clipboard.writeText(resetToken)
      notify.success('Token copiado.')
    } catch {
      notify.error('NÃ£o foi possÃ­vel copiar o token.')
    }
  }

  return (
    <div className={embedded ? 'w-full' : 'flex min-h-screen items-center justify-center bg-bg-primary px-4'}>
      <form
        ref={formRef}
        onSubmit={handleSubmit}
        autoComplete={embedded ? 'off' : 'on'}
        className="w-full"
      >
        <AuthPanel embedded={embedded}>
          <h1 className="text-center text-2xl font-bold text-fg-primary">Esqueci minha senha</h1>
          <p className="mt-2 text-center text-sm text-fg-secondary">
            Informe seu email para gerar um token de redefiniÃ§Ã£o.
          </p>

          <div className="mt-8 space-y-4">
            <AuthField
              label="Email"
              name="email"
              type="email"
              placeholder="Digite seu email"
              value={formData.email}
              onChange={handleChange}
              autoComplete={embedded ? 'off' : 'email'}
              leftIcon={<IconMail />}
              error={errors.email}
              required
            />

            {!requestSent ? (
              <PrimaryAuthButton
                disabled={
                  loading ||
                  cooldownSeconds > 0 ||
                  hasErrors(errors as Record<string, string | undefined>)
                }
              >
                {loading
                  ? 'Carregando...'
                  : cooldownSeconds > 0
                    ? `Aguarde ${cooldownSeconds}s...`
                    : 'Gerar token de reset'}
              </PrimaryAuthButton>
            ) : null}
          </div>

          {requestSent && (
            <div className="mt-6 rounded-2xl border border-white/10 bg-bg-primary/20 p-4">
              <p className="text-sm font-semibold text-fg-primary mb-2">PrÃ³ximos passos</p>
              <p className="text-sm text-fg-secondary">
                {genericSuccessMessage} Se vocÃª nÃ£o receber nada, verifique o spam/lixeira.
              </p>

              {shouldExposeToken && resetToken ? (
                <>
                  <p className="mt-4 text-sm font-semibold text-fg-primary mb-2">Token (apenas DEV):</p>
                  <code className="block text-xs break-all rounded-xl border border-white/10 bg-bg-primary/40 p-3 text-fg-primary">
                    {resetToken}
                  </code>
                  <div className="mt-3 flex gap-3">
                    <button
                      type="button"
                      className="flex-1 rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-fg-primary hover:bg-white/10"
                      onClick={copyToken}
                    >
                      Copiar
                    </button>
                    <Link
                      className="flex-1 rounded-2xl bg-accent-pool px-4 py-3 text-center text-sm font-semibold text-black hover:opacity-90"
                      to={`/reset-password?token=${encodeURIComponent(resetToken)}`}
                      state={modalState}
                    >
                      Resetar Senha
                    </Link>
                  </div>
                </>
              ) : (
                <div className="mt-4">
                  <Link
                    className="block w-full rounded-2xl bg-accent-pool px-4 py-3 text-center text-sm font-semibold text-black hover:opacity-90"
                    to="/reset-password"
                    state={modalState}
                  >
                    Ir para redefinir senha
                  </Link>
                </div>
              )}

              <div className="mt-4 text-center">
                <button
                  type="button"
                  disabled={
                    loading ||
                    cooldownSeconds > 0 ||
                    hasErrors(errors as Record<string, string | undefined>)
                  }
                  className="text-sm font-semibold text-accent-sky hover:underline disabled:cursor-not-allowed disabled:opacity-60 disabled:no-underline"
                  onClick={() => formRef.current?.requestSubmit()}
                >
                  {cooldownSeconds > 0 ? `Gerar novo token (${cooldownSeconds}s)` : 'Gerar novo token'}
                </button>
              </div>
            </div>
          )}

          <div className="mt-5 text-center text-sm text-fg-secondary">
            <Link className="font-semibold text-accent-sky hover:underline" to="/login" state={modalState}>
              Voltar para login
            </Link>
          </div>
        </AuthPanel>
      </form>
    </div>
  )
}

  </file>
  <file name='src\pages\Home\index.tsx'>
import HomeMainContent from '../../components/home/HomeMainContent'
import HomeHero from '../../components/home/Home'

export default function Home() {
  return (
    <div className="min-h-screen overflow-y-auto bg-bg-primary">
      <HomeHero />
      <HomeMainContent />
    </div>
  )
}

  </file>
  <file name='src\pages\Legal\Privacy.tsx'>
type Props = {
  embedded?: boolean
}

export default function Privacy({ embedded }: Props) {
  return (
    <div className={embedded ? 'w-full' : 'min-h-screen bg-bg-primary px-4 py-10'}>
      <div className="mx-auto w-full max-w-3xl rounded-3xl border border-white/10 bg-bg-secondary p-8 shadow-[0_1.5rem_3.75rem_rgba(0,0,0,0.55)]">
        <div className="flex items-start justify-between gap-4">
          <h1 className="text-2xl font-bold text-fg-primary">PolÃ­tica de Privacidade</h1>
        </div>

        <div className="mt-6 space-y-3 text-sm text-fg-secondary">
          <p>
            1) Coleta: podemos coletar informaÃ§Ãµes necessÃ¡rias para autenticaÃ§Ã£o e funcionamento do
            serviÃ§o.
          </p>
          <p>
            2) Uso: os dados sÃ£o usados para operar a plataforma, melhorar a experiÃªncia e manter
            a seguranÃ§a.
          </p>
          <p>
            3) SeguranÃ§a: adotamos medidas tÃ©cnicas para proteger informaÃ§Ãµes, mas nenhum sistema
            Ã© 100% infalÃ­vel.
          </p>
        </div>
      </div>
    </div>
  )
}

  </file>
  <file name='src\pages\Legal\Terms.tsx'>
type Props = {
  embedded?: boolean
}

export default function Terms({ embedded }: Props) {
  return (
    <div className={embedded ? 'w-full' : 'min-h-screen bg-bg-primary px-4 py-10'}>
      <div className="mx-auto w-full max-w-3xl rounded-3xl border border-white/10 bg-bg-secondary p-8 shadow-[0_1.5rem_3.75rem_rgba(0,0,0,0.55)]">
        <div className="flex items-start justify-between gap-4">
          <h1 className="text-2xl font-bold text-fg-primary">Termos de ServiÃ§o</h1>
        </div>

        <div className="mt-6 space-y-3 text-sm text-fg-secondary">
          <p>
            1) Uso do serviÃ§o: ao utilizar a plataforma, vocÃª concorda em fornecer informaÃ§Ãµes
            verdadeiras e manter suas credenciais seguras.
          </p>
          <p>
            2) Responsabilidades: esta aplicaÃ§Ã£o pode integrar com serviÃ§os de terceiros; nÃ£o nos
            responsabilizamos por indisponibilidade externa.
          </p>
          <p>
            3) AlteraÃ§Ãµes: podemos atualizar estes termos periodicamente. Verifique esta pÃ¡gina
            para acompanhar mudanÃ§as.
          </p>
        </div>
      </div>
    </div>
  )
}

  </file>
  <file name='src\pages\Login\index.tsx'>
import { useEffect, useRef, useState } from 'react'
import type { FormEvent, ChangeEvent } from 'react'
import { useLocation, useNavigate } from 'react-router-dom'
import { Link } from 'react-router-dom'
import type { LoginDTO } from '../../interfaces/auth'
import { useAuth } from '../../hooks/useAuth'
import { notify } from '../../utils/notify'
import { hasErrors, normalizeEmail, validateLogin } from '../../utils/validation'
import {
  AuthField,
  AuthPanel,
  IconEye,
  IconEyeOff,
  IconLock,
  IconMail,
  PrimaryAuthButton,
} from '../../components/auth/AuthUI'

type Props = {
  embedded?: boolean
}

export default function Login({ embedded }: Props) {
  const formRef = useRef<HTMLFormElement | null>(null)
  const navigate = useNavigate()
  const location = useLocation()
  const { login } = useAuth()

  const modalState = (location.state as { backgroundLocation?: unknown } | null)?.backgroundLocation
    ? location.state
    : undefined

  useEffect(() => {
    const reason = sessionStorage.getItem('auth:redirectReason')
    if (reason) {
      sessionStorage.removeItem('auth:redirectReason')
      notify.info(reason)
    }
  }, [])

  const [formData, setFormData] = useState<LoginDTO>({
    email: '',
    senha: '',
  })

  const [errors, setErrors] = useState<Partial<Record<keyof LoginDTO, string>>>({})

  const [rememberMe, setRememberMe] = useState(true)
  const [showPassword, setShowPassword] = useState(false)

  const [loading, setLoading] = useState(false)

  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    setFormData((prev) => ({ ...prev, [e.target.name]: e.target.value }))
    const name = e.target.name as keyof LoginDTO
    if (errors[name]) setErrors((prev) => ({ ...prev, [name]: undefined }))
  }

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault()
    setLoading(true)

    const nextErrors = validateLogin(formData)
    if (hasErrors(nextErrors)) {
      setErrors(nextErrors)
      setLoading(false)

      setTimeout(() => {
        const form = formRef.current
        const firstInvalid = (['email', 'senha'] as const).find((key) => nextErrors[key])
        if (!form || !firstInvalid) return
        const el = form.querySelector<HTMLElement>(`[name="${firstInvalid}"]`)
        el?.focus()
      }, 0)

      return
    }

    const payload: LoginDTO = {
      email: normalizeEmail(formData.email),
      senha: formData.senha,
    }

    try {
      await login(payload)
      notify.success('Login realizado com sucesso.')
      navigate('/dashboard/home', { replace: true })
    } catch (error) {
      notify.apiError(error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className={embedded ? 'w-full' : 'flex min-h-screen items-center justify-center bg-bg-primary px-4'}>
      <form
        ref={formRef}
        onSubmit={handleSubmit}
        autoComplete={embedded ? 'off' : 'on'}
        className="w-full"
      >
        <AuthPanel embedded={embedded}>
          <h1 className="text-center text-2xl font-bold text-fg-primary">Entrar</h1>
          <p className="mt-2 text-center text-sm text-fg-secondary">
            Acesse sua conta para gerenciar seus pontos e milhas.
          </p>

          <div className="mt-8 space-y-4">
            <AuthField
              label="Email"
              name="email"
              type="email"
              placeholder="Digite seu email"
              value={formData.email}
              onChange={handleChange}
              autoComplete="email"
              leftIcon={<IconMail />}
              error={errors.email}
            />

            <AuthField
              label="Senha"
              name="senha"
              type={embedded ? 'text' : showPassword ? 'text' : 'password'}
              placeholder="Digite sua senha"
              value={formData.senha}
              onChange={handleChange}
              autoComplete={embedded ? 'off' : rememberMe ? 'current-password' : 'off'}
              leftIcon={<IconLock />}
              rightIcon={showPassword ? <IconEyeOff /> : <IconEye />}
              rightIconLabel={showPassword ? 'Ocultar senha' : 'Mostrar senha'}
              onRightIconClick={() => setShowPassword((v) => !v)}
              error={errors.senha}
              inputStyle={
                embedded
                  ? ({ WebkitTextSecurity: showPassword ? 'none' : 'disc' } as React.CSSProperties)
                  : undefined
              }
            />

            <div className="flex items-center justify-between gap-4">
              <label className="flex items-center gap-2 text-sm text-fg-secondary">
                <input
                  type="checkbox"
                  className="h-4 w-4 rounded border-white/20 bg-bg-primary/40 text-accent-sky focus:ring-accent-sky/30"
                  checked={rememberMe}
                  onChange={(e) => setRememberMe(e.target.checked)}
                />
                Lembrar-me
              </label>
              <Link
                className="text-sm font-semibold text-accent-sky hover:underline"
                to="/forgot-password"
                state={modalState}
              >
                Esqueci a senha
              </Link>
            </div>

            <PrimaryAuthButton disabled={loading || hasErrors(errors as Record<string, string | undefined>)}>
              {loading ? 'Carregando...' : 'Entrar'}
            </PrimaryAuthButton>
          </div>

          <div className="mt-5 text-center text-sm text-fg-secondary">
            NÃ£o tem uma conta?{' '}
            <Link className="font-semibold text-accent-sky hover:underline" to="/register" state={modalState}>
              Criar conta
            </Link>
          </div>
        </AuthPanel>
      </form>
    </div>
  )
}

  </file>
  <file name='src\pages\Register\index.tsx'>
import { useRef, useState } from 'react'
import type { ChangeEvent, FormEvent } from 'react'
import { Link, useLocation, useNavigate } from 'react-router-dom'
import type { RegisterDTO } from '../../interfaces/auth'
import { useAuth } from '../../hooks/useAuth'
import { notify } from '../../utils/notify'
import { hasErrors, normalizeEmail, validateRegister } from '../../utils/validation'
import {
  AuthField,
  AuthPanel,
  IconEye,
  IconEyeOff,
  IconLock,
  IconMail,
  IconUser,
  PrimaryAuthButton,
} from '../../components/auth/AuthUI'

type Props = {
  embedded?: boolean
}

export default function Register({ embedded }: Props) {
  const formRef = useRef<HTMLFormElement | null>(null)
  const navigate = useNavigate()
  const location = useLocation()
  const { register } = useAuth()

  const incomingDraft = (location.state as { draft?: Partial<RegisterDTO> } | null)?.draft
  const incomingAcceptedTerms = (location.state as { acceptedTerms?: boolean } | null)?.acceptedTerms

  const modalState = (location.state as { backgroundLocation?: unknown } | null)?.backgroundLocation
    ? location.state
    : undefined
  
  const [formData, setFormData] = useState<RegisterDTO>({
    nome: incomingDraft?.nome ?? '',
    email: incomingDraft?.email ?? '',
    senha: incomingDraft?.senha ?? '',
  })

  const [errors, setErrors] = useState<Partial<Record<keyof RegisterDTO | 'terms', string>>>({})

  const [loading, setLoading] = useState(false)
  const [acceptedTerms, setAcceptedTerms] = useState(Boolean(incomingAcceptedTerms))
  const [showPassword, setShowPassword] = useState(false)

  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    setFormData((prev) => ({ ...prev, [e.target.name]: e.target.value }))
    const name = e.target.name as keyof RegisterDTO
    if (errors[name]) setErrors((prev) => ({ ...prev, [name]: undefined }))
  }

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault()

    const nextErrors = {
      ...validateRegister(formData),
      ...(acceptedTerms
        ? null
        : { terms: 'VocÃª precisa aceitar os Termos de ServiÃ§o e a PolÃ­tica de Privacidade.' }),
    } as Partial<Record<keyof RegisterDTO | 'terms', string>>

    if (hasErrors(nextErrors as Record<string, string | undefined>)) {
      setErrors(nextErrors)
      setTimeout(() => {
        const form = formRef.current
        const firstInvalid = (['nome', 'email', 'senha', 'terms'] as const).find((key) => nextErrors[key])
        if (!form || !firstInvalid) return
        const el = form.querySelector<HTMLElement>(`[name="${firstInvalid}"]`)
        el?.focus()
      }, 0)
      return
    }

    setLoading(true)

    const payload: RegisterDTO = {
      nome: formData.nome.trim(),
      email: normalizeEmail(formData.email),
      senha: formData.senha,
    }

    try {
      await register(payload)
      notify.success('Conta criada com sucesso.')
      navigate('/dashboard/home', { replace: true })
    } catch (error) {
      notify.apiError(error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className={embedded ? 'w-full' : 'flex min-h-screen items-center justify-center bg-bg-primary px-4'}>
      <form ref={formRef} onSubmit={handleSubmit} autoComplete={embedded ? 'off' : 'on'} className="w-full">
        <AuthPanel embedded={embedded}>
          <h1 className="text-center text-2xl font-bold text-fg-primary">Criar conta</h1>
          <p className="mt-2 text-center text-sm text-fg-secondary">
            Comece a centralizar seus programas em poucos passos.
          </p>

          <div className="mt-8 space-y-4">
            <AuthField
              label="Nome"
              name="nome"
              placeholder="Digite seu nome"
              value={formData.nome}
              onChange={handleChange}
              autoComplete="name"
              leftIcon={<IconUser />}
              error={errors.nome}
            />

            <AuthField
              label="Email"
              name="email"
              type="email"
              placeholder="Digite seu email"
              value={formData.email}
              onChange={handleChange}
              autoComplete="email"
              leftIcon={<IconMail />}
              error={errors.email}
            />

            <AuthField
              label="Senha"
              name="senha"
              type={embedded ? 'text' : showPassword ? 'text' : 'password'}
              placeholder="Crie uma senha"
              value={formData.senha}
              onChange={handleChange}
              autoComplete={embedded ? 'off' : 'new-password'}
              leftIcon={<IconLock />}
              rightIcon={showPassword ? <IconEyeOff /> : <IconEye />}
              rightIconLabel={showPassword ? 'Ocultar senha' : 'Mostrar senha'}
              onRightIconClick={() => setShowPassword((v) => !v)}
              error={errors.senha}
              inputStyle={
                embedded
                  ? ({ WebkitTextSecurity: showPassword ? 'none' : 'disc' } as React.CSSProperties)
                  : undefined
              }
            />

            <label className="flex items-start gap-3 rounded-2xl border border-white/10 bg-bg-primary/20 p-4 text-sm text-fg-secondary">
              <input
                name="terms"
                type="checkbox"
                className="mt-1 h-4 w-4 rounded border-white/20 bg-bg-primary/40 text-accent-sky focus:ring-accent-sky/30"
                checked={acceptedTerms}
                onChange={(e) => {
                  setAcceptedTerms(e.target.checked)
                  if (errors.terms) setErrors((prev) => ({ ...prev, terms: undefined }))
                }}
                required
              />
              <span>
                Eu aceito os{' '}
                <Link
                  className="font-semibold text-accent-sky hover:underline"
                  to="/terms"
                  state={{
                    backgroundLocation: (location.state as { backgroundLocation?: unknown } | null)?.backgroundLocation ?? location,
                    returnTo: '/register',
                    draft: formData,
                    acceptedTerms,
                  }}
                >
                  Termos de ServiÃ§o
                </Link>{' '}
                e a{' '}
                <Link
                  className="font-semibold text-accent-sky hover:underline"
                  to="/privacy"
                  state={{
                    backgroundLocation: (location.state as { backgroundLocation?: unknown } | null)?.backgroundLocation ?? location,
                    returnTo: '/register',
                    draft: formData,
                    acceptedTerms,
                  }}
                >
                  PolÃ­tica de Privacidade
                </Link>
                .
              </span>
            </label>

            {errors.terms ? (
              <span className="-mt-2 block text-xs font-semibold text-red-300">{errors.terms}</span>
            ) : null}

            <PrimaryAuthButton disabled={loading || hasErrors(errors as Record<string, string | undefined>)}>
              {loading ? 'Carregando...' : 'Cadastrar'}
            </PrimaryAuthButton>
          </div>

          <div className="mt-5 text-center text-sm text-fg-secondary">
            JÃ¡ tem uma conta?{' '}
            <Link className="font-semibold text-accent-sky hover:underline" to="/login" state={modalState}>
              Entrar
            </Link>
          </div>
        </AuthPanel>
      </form>
    </div>
  )
}
  </file>
  <file name='src\pages\ResetPassword\index.tsx'>
import { useEffect, useRef, useState } from 'react'
import type { ChangeEvent, FormEvent } from 'react'
import { Link, useLocation, useNavigate, useSearchParams } from 'react-router-dom'
import { authService } from '../../services/auth/auth.service'
import type { ResetPasswordDTO } from '../../interfaces/auth'
import { notify } from '../../utils/notify'
import { hasErrors, validateResetPassword } from '../../utils/validation'
import { AuthField, AuthPanel, IconEye, IconEyeOff, IconLock, PrimaryAuthButton } from '../../components/auth/AuthUI'

type Props = {
  embedded?: boolean
}

export default function ResetPassword({ embedded }: Props) {
  const navigate = useNavigate()
  const location = useLocation()
  const [searchParams] = useSearchParams()

  const modalState = (location.state as { backgroundLocation?: unknown } | null)?.backgroundLocation
    ? location.state
    : undefined

  const [formData, setFormData] = useState<ResetPasswordDTO>({
    token: '',
    novaSenha: '',
  })

  const [loading, setLoading] = useState(false)
  const [showPassword, setShowPassword] = useState(false)

  const [errors, setErrors] = useState<Partial<Record<'token' | 'novaSenha', string>>>({})
  const tokenRef = useRef<HTMLInputElement | null>(null)
  const passwordRef = useRef<HTMLInputElement | null>(null)

  useEffect(() => {
    const tokenFromQuery = searchParams.get('token')
    if (tokenFromQuery) {
      setFormData((prev) => ({ ...prev, token: tokenFromQuery }))
    }
  }, [searchParams])

  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target
    setFormData((prev) => {
      const next = { ...prev, [name]: value } as ResetPasswordDTO
      setErrors(validateResetPassword(next))
      return next
    })
  }

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault()

    const nextErrors = validateResetPassword(formData)
    setErrors(nextErrors)
    if (hasErrors(nextErrors)) {
      if (nextErrors.token) {
        tokenRef.current?.focus()
      } else if (nextErrors.novaSenha) {
        passwordRef.current?.focus()
      }
      return
    }

    setLoading(true)

    try {
      const message = await authService.resetPassword(formData)
      notify.success(message || 'Senha alterada com sucesso.')
      if (embedded && modalState) {
        navigate('/login', { state: modalState, replace: true })
      } else {
        navigate('/login')
      }
    } catch (error) {
      notify.apiError(error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className={embedded ? 'w-full' : 'flex min-h-screen items-center justify-center bg-bg-primary px-4'}>
      <form onSubmit={handleSubmit} autoComplete={embedded ? 'off' : 'on'} className="w-full">
        <AuthPanel embedded={embedded}>
          <h1 className="text-center text-2xl font-bold text-fg-primary">Redefinir senha</h1>
          <p className="mt-2 text-center text-sm text-fg-secondary">
            Informe o token e defina uma nova senha.
          </p>

          <div className="mt-8 space-y-4">
            <AuthField
              label="Token"
              name="token"
              placeholder="Cole o token aqui"
              value={formData.token}
              onChange={handleChange}
              required
              error={errors.token}
              inputRef={tokenRef}
            />

            <AuthField
              label="Nova senha"
              name="novaSenha"
              type={embedded ? 'text' : showPassword ? 'text' : 'password'}
              placeholder="Crie uma nova senha"
              value={formData.novaSenha}
              onChange={handleChange}
              required
              autoComplete={embedded ? 'off' : 'new-password'}
              leftIcon={<IconLock />}
              rightIcon={showPassword ? <IconEyeOff /> : <IconEye />}
              rightIconLabel={showPassword ? 'Ocultar senha' : 'Mostrar senha'}
              onRightIconClick={() => setShowPassword((v) => !v)}
              error={errors.novaSenha}
              inputRef={passwordRef}
              inputStyle={
                embedded
                  ? ({ WebkitTextSecurity: showPassword ? 'none' : 'disc' } as React.CSSProperties)
                  : undefined
              }
            />

            <PrimaryAuthButton disabled={loading || hasErrors(errors)}>
              {loading ? 'Carregando...' : 'Salvar nova senha'}
            </PrimaryAuthButton>
          </div>

          <div className="mt-5 flex items-center justify-between text-sm">
            <Link className="font-semibold text-accent-sky hover:underline" to="/forgot-password" state={modalState}>
              Gerar token
            </Link>
            <Link className="font-semibold text-accent-sky hover:underline" to="/login" state={modalState}>
              Login
            </Link>
          </div>
        </AuthPanel>
      </form>
    </div>
  )
}

  </file>
  <file name='src\components\auth\AuthUI.tsx'>
import type { ReactNode } from 'react'
import type { CSSProperties } from 'react'

type PanelProps = {
  embedded?: boolean
  children: ReactNode
}

export function AuthPanel({ embedded, children }: PanelProps) {
  return (
    <div
      className={
        embedded
          ? 'w-full'
          : 'w-full max-w-md rounded-3xl border border-white/10 bg-bg-secondary p-8 shadow-[0_1.5rem_3.75rem_rgba(0,0,0,0.55)]'
      }
    >
      {children}
    </div>
  )
}

type FieldProps = {
  label: string
  name: string
  type?: string
  placeholder?: string
  value: string
  required?: boolean
  autoComplete?: string
  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void
  leftIcon?: ReactNode
  rightIcon?: ReactNode
  rightIconLabel?: string
  onRightIconClick?: () => void
  error?: string
  inputStyle?: CSSProperties
  inputRef?: React.Ref<HTMLInputElement>
}

export function AuthField({
  label,
  name,
  type = 'text',
  placeholder,
  value,
  required,
  autoComplete,
  onChange,
  leftIcon,
  rightIcon,
  rightIconLabel,
  onRightIconClick,
  error,
  inputStyle,
  inputRef,
}: FieldProps) {
  return (
    <label className="block">
      <span className="mb-2 block text-sm font-semibold text-fg-primary">{label}</span>
      <span className="relative block">
        {leftIcon ? (
          <span className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-fg-secondary">
            {leftIcon}
          </span>
        ) : null}

        <input
          className={
            'w-full rounded-2xl border bg-bg-primary/40 px-4 py-3 text-sm text-fg-primary ' +
            'placeholder:text-fg-secondary/60 shadow-inner outline-none ' +
            'focus:border-accent-sky/60 focus:ring-2 focus:ring-accent-sky/25 ' +
            (error ? 'border-red-500/60 focus:border-red-400/70 focus:ring-red-500/20 ' : 'border-white/10 ') +
            (leftIcon ? 'pl-10 ' : '') +
            (rightIcon ? 'pr-11' : '')
          }
          style={inputStyle}
          ref={inputRef}
          type={type}
          name={name}
          value={value}
          placeholder={placeholder}
          onChange={onChange}
          required={required}
          autoComplete={autoComplete}
        />

        {rightIcon ? (
          <button
            type="button"
            aria-label={rightIconLabel ?? 'AÃ§Ã£o'}
            onClick={onRightIconClick}
            className="absolute right-2 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-xl bg-transparent text-fg-secondary hover:bg-white/5 hover:text-fg-primary focus:outline-none focus:ring-2 focus:ring-accent-sky/25"
          >
            {rightIcon}
          </button>
        ) : null}
      </span>

      {error ? <span className="mt-2 block text-xs font-semibold text-red-300">{error}</span> : null}
    </label>
  )
}

type ButtonProps = {
  children: ReactNode
  disabled?: boolean
  type?: 'button' | 'submit'
  onClick?: () => void
}

export function PrimaryAuthButton({ children, disabled, type = 'submit', onClick }: ButtonProps) {
  return (
    <button
      type={type}
      onClick={onClick}
      disabled={disabled}
      className="w-full rounded-2xl bg-accent-pool py-3 text-sm font-semibold text-black shadow hover:opacity-90 disabled:opacity-60"
    >
      {children}
    </button>
  )
}

export function IconMail() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M4 6.5A2.5 2.5 0 0 1 6.5 4h11A2.5 2.5 0 0 1 20 6.5v11A2.5 2.5 0 0 1 17.5 20h-11A2.5 2.5 0 0 1 4 17.5v-11Z"
        stroke="currentColor"
        strokeWidth="1.6"
      />
      <path
        d="M6.5 7l5.1 4.08a1.5 1.5 0 0 0 1.87 0L18.5 7"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  )
}

export function IconLock() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M7 11V8.8a5 5 0 0 1 10 0V11"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinecap="round"
      />
      <path
        d="M6.5 11h11A2.5 2.5 0 0 1 20 13.5v5A2.5 2.5 0 0 1 17.5 21h-11A2.5 2.5 0 0 1 4 18.5v-5A2.5 2.5 0 0 1 6.5 11Z"
        stroke="currentColor"
        strokeWidth="1.6"
      />
    </svg>
  )
}

export function IconUser() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"
        stroke="currentColor"
        strokeWidth="1.6"
      />
      <path
        d="M4.5 20a7.5 7.5 0 0 1 15 0"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinecap="round"
      />
    </svg>
  )
}

export function IconEye() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M2.2 12s3.5-7 9.8-7 9.8 7 9.8 7-3.5 7-9.8 7-9.8-7-9.8-7Z"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinejoin="round"
      />
      <path
        d="M12 15.2a3.2 3.2 0 1 0 0-6.4 3.2 3.2 0 0 0 0 6.4Z"
        stroke="currentColor"
        strokeWidth="1.6"
      />
    </svg>
  )
}

export function IconEyeOff() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M4 4l16 16"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinecap="round"
      />
      <path
        d="M10.6 10.7a2.8 2.8 0 0 0 3.8 3.8"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinecap="round"
      />
      <path
        d="M6.2 6.6C3.7 8.4 2.2 12 2.2 12s3.5 7 9.8 7c2 0 3.7-.5 5.1-1.2"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinejoin="round"
      />
      <path
        d="M19.8 17.4C21.7 15.8 22.9 14 22.9 14s-3.5-7-9.8-7c-1.1 0-2.2.2-3.1.5"
        stroke="currentColor"
        strokeWidth="1.6"
        strokeLinejoin="round"
      />
    </svg>
  )
}

  </file>
  <file name='src\components\dashboard\cartoes\CartaoFormModal.tsx'>
import { useEffect, useMemo, useState } from 'react'
import type { CartaoRequestDTO, CartaoResponseDTO } from '../../../interfaces/cartaoUsuario'
import type { BandeiraEnum, TipoCartaoEnum } from '../../../interfaces/enums'
import type { ProgramaResponseDTO } from '../../../interfaces/programaFidelidade'
import { BANDEIRAS, TIPOS } from '../../../utils/cardConstants'
import { notify } from '../../../utils/notify'

interface CartaoFormModalProps {
    isOpen: boolean
    onClose: () => void
    onSave: (data: CartaoRequestDTO) => Promise<void>
    initialData: CartaoResponseDTO | null
    programas: ProgramaResponseDTO[]
    isSaving: boolean
}

export function CartaoFormModal({
    isOpen,
    onClose,
    onSave,
    initialData,
    programas,
    isSaving,
}: CartaoFormModalProps) {
    const [form, setForm] = useState<{
        nome: string
        bandeira: BandeiraEnum
        tipo: TipoCartaoEnum
        numero: string
        dataValidade: string
        programaIds: number[]
    }>({
        nome: '',
        bandeira: 'VISA',
        tipo: 'CREDITO',
        numero: '',
        dataValidade: '',
        programaIds: [],
    })

    useEffect(() => {
        if (isOpen) {
            if (initialData) {
                setForm({
                    nome: initialData.nome ?? '',
                    bandeira: initialData.bandeira ?? 'VISA',
                    tipo: initialData.tipo ?? 'CREDITO',
                    numero: initialData.numero ?? '',
                    dataValidade: initialData.dataValidade ?? '',
                    programaIds: initialData.programas?.map((p) => p.id) ?? [],
                })
            } else {
                setForm({
                    nome: '',
                    bandeira: 'VISA',
                    tipo: 'CREDITO',
                    numero: '',
                    dataValidade: '',
                    programaIds: [],
                })
            }
        }
    }, [isOpen, initialData])

    const togglePrograma = (programaId: number) => {
        setForm((prev) => {
            const exists = prev.programaIds.includes(programaId)
            return {
                ...prev,
                programaIds: exists
                    ? prev.programaIds.filter((id) => id !== programaId)
                    : [...prev.programaIds, programaId],
            }
        })
    }

    const selectedProgramNames = useMemo(() => {
        return programas.filter((p) => form.programaIds.includes(p.id)).map((p) => p.nome)
    }, [form.programaIds, programas])

    const handleSubmit = async (event: React.FormEvent) => {
        event.preventDefault()

        if (!form.nome.trim()) {
            notify.warn('Informe o nome do cartÃ£o.')
            return
        }

        if (!form.programaIds.length) {
            notify.warn('Selecione ao menos um programa de fidelidade.')
            return
        }

        const cleanedNumero = form.numero.replace(/\s/g, '')
        if (cleanedNumero.length !== 16) {
            notify.warn('O nÃºmero do cartÃ£o deve conter 16 dÃ­gitos.')
            return
        }

        if (!form.dataValidade) {
            notify.warn('Informe a data de validade do cartÃ£o.')
            return
        }

        const payload: CartaoRequestDTO = {
            nome: form.nome.trim(),
            bandeira: form.bandeira,
            tipo: form.tipo,
            numero: cleanedNumero,
            dataValidade: form.dataValidade,
            programaIds: form.programaIds,
        }

        await onSave(payload)
    }

    if (!isOpen) return null

    return (
        <div className="dashboard-card mb-6">
            <div className="section-header">
                <div className="card-icon">
                    <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                    </svg>
                </div>
                <div className="flex-1">
                    <h2 className="section-title">{initialData ? 'Editar cartÃ£o' : 'Novo cartÃ£o'}</h2>
                </div>
                <button
                    type="button"
                    onClick={onClose}
                    className="rounded-lg p-2 text-fg-secondary hover:bg-white/10 hover:text-fg-primary transition-colors"
                >
                    <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <form onSubmit={handleSubmit} className="mt-6 space-y-6">
                <div className="grid gap-5 md:grid-cols-2">
                    {/* Nome */}
                    <div className="space-y-2">
                        <label htmlFor="card-nome" className="block text-sm font-medium text-fg-primary">
                            Nome do cartÃ£o
                        </label>
                        <input
                            id="card-nome"
                            value={form.nome}
                            onChange={(e) => setForm((prev) => ({ ...prev, nome: e.target.value }))}
                            placeholder="Ex: Nubank Platinum"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        />
                    </div>

                    {/* Bandeira */}
                    <div className="space-y-2">
                        <label htmlFor="card-bandeira" className="block text-sm font-medium text-fg-primary">
                            Bandeira
                        </label>
                        <select
                            id="card-bandeira"
                            value={form.bandeira}
                            onChange={(e) => setForm((prev) => ({ ...prev, bandeira: e.target.value as BandeiraEnum }))}
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        >
                            {BANDEIRAS.map((b) => (
                                <option key={b.value} value={b.value}>
                                    {b.label}
                                </option>
                            ))}
                        </select>
                    </div>

                    {/* Tipo */}
                    <div className="space-y-2">
                        <label htmlFor="card-tipo" className="block text-sm font-medium text-fg-primary">
                            Tipo
                        </label>
                        <select
                            id="card-tipo"
                            value={form.tipo}
                            onChange={(e) => setForm((prev) => ({ ...prev, tipo: e.target.value as TipoCartaoEnum }))}
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        >
                            {TIPOS.map((t) => (
                                <option key={t.value} value={t.value}>
                                    {t.label}
                                </option>
                            ))}
                        </select>
                    </div>

                    {/* NÃºmero do CartÃ£o */}
                    <div className="space-y-2">
                        <label htmlFor="card-numero" className="block text-sm font-medium text-fg-primary">
                            NÃºmero do cartÃ£o
                        </label>
                        <input
                            id="card-numero"
                            type="text"
                            maxLength={19}
                            value={form.numero.replace(/(\d{4})(?=\d)/g, '$1 ')}
                            onChange={(e) => {
                                const onlyNumbers = e.target.value.replace(/\D/g, '').slice(0, 16)
                                setForm((prev) => ({ ...prev, numero: onlyNumbers }))
                            }}
                            placeholder="0000 0000 0000 0000"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary font-mono tracking-wider placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        />
                        <p className="text-xs text-fg-secondary">
                            Os 12 primeiros dÃ­gitos serÃ£o ocultados por seguranÃ§a.
                        </p>
                    </div>

                    {/* Data de Validade */}
                    <div className="space-y-2">
                        <label htmlFor="card-validade" className="block text-sm font-medium text-fg-primary">
                            Validade
                        </label>
                        <input
                            id="card-validade"
                            type="date"
                            value={form.dataValidade}
                            onChange={(e) => setForm((prev) => ({ ...prev, dataValidade: e.target.value }))}
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        />
                    </div>
                </div>

                {/* Programas */}
                <div className="space-y-3">
                    <label className="block text-sm font-medium text-fg-primary">
                        Programas de fidelidade vinculados
                    </label>
                    <div className="flex flex-wrap gap-2">
                        {programas.map((programa) => {
                            const isSelected = form.programaIds.includes(programa.id)
                            return (
                                <button
                                    key={programa.id}
                                    type="button"
                                    onClick={() => togglePrograma(programa.id)}
                                    className={`rounded-full px-4 py-2 text-xs font-semibold transition-all ${isSelected
                                        ? 'bg-gradient-to-r from-accent-sky to-accent-pool text-white shadow-lg shadow-accent-pool/25'
                                        : 'border border-white/10 bg-white/5 text-fg-secondary hover:bg-white/10 hover:text-fg-primary'
                                        }`}
                                >
                                    {isSelected && (
                                        <svg className="mr-1.5 inline h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                        </svg>
                                    )}
                                    {programa.nome}
                                </button>
                            )
                        })}
                    </div>
                    {programas.length === 0 && (
                        <p className="text-sm text-fg-secondary">Nenhum programa disponÃ­vel.</p>
                    )}
                    {selectedProgramNames.length > 0 && (
                        <p className="text-xs text-fg-secondary">
                            Selecionados: {selectedProgramNames.join(', ')}
                        </p>
                    )}
                </div>

                {/* AÃ§Ãµes */}
                <div className="flex justify-end gap-3 pt-2">
                    <button type="button" onClick={onClose} className="btn-secondary">
                        Cancelar
                    </button>
                    <button type="submit" disabled={isSaving} className="btn-primary disabled:opacity-50">
                        {isSaving ? (
                            <>
                                <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                                Salvando...
                            </>
                        ) : (
                            <>
                                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                </svg>
                                {initialData ? 'Atualizar' : 'Cadastrar'}
                            </>
                        )}
                    </button>
                </div>
            </form>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\cartoes\CartaoList.tsx'>
import { useState } from 'react'
import type { CartaoResponseDTO } from '../../../interfaces/cartaoUsuario'
import { getTipoLabel } from '../../../utils/cardConstants'
import CreditCardPreview, { type CardVariant } from './CreditCardPreview'

interface CartaoListProps {
    cards: CartaoResponseDTO[]
    loading: boolean
    onEdit: (card: CartaoResponseDTO) => void
    onDelete: (id: number) => Promise<void>
}

// Helper para converter bandeira em variante visual
const getCardVariant = (bandeira?: string): CardVariant => {
    switch (bandeira) {
        case 'VISA':
            return 'black'
        case 'MASTERCARD':
            return 'mastercard'
        case 'AMERICAN_EXPRESS':
            return 'gold'
        case 'ELO':
            return 'elo'
        case 'HIPERCARD':
            return 'hipercard'
        default:
            return 'platinum'
    }
}

export function CartaoList({ cards, loading, onEdit, onDelete }: CartaoListProps) {
    const [deletingId, setDeletingId] = useState<number | null>(null)
    const [confirmDeleteId, setConfirmDeleteId] = useState<number | null>(null)

    const handleDeleteClick = (id: number) => {
        setConfirmDeleteId(id)
    }

    const handleDeleteCancel = () => {
        setConfirmDeleteId(null)
    }

    const handleConfirmDelete = async (id: number) => {
        setDeletingId(id)
        setConfirmDeleteId(null)
        try {
            await onDelete(id)
        } finally {
            setDeletingId(null)
        }
    }

    if (loading) {
        return (
            <div className="dashboard-card flex items-center justify-center gap-4 py-12">
                <div className="relative">
                    <div className="h-10 w-10 rounded-full border-2 border-accent-pool/20" />
                    <div className="absolute inset-0 h-10 w-10 rounded-full border-2 border-transparent border-t-accent-pool animate-spin" />
                </div>
                <span className="text-sm text-fg-secondary">Carregando cartÃµes...</span>
            </div>
        )
    }

    if (cards.length === 0) {
        return (
            <div className="dashboard-card flex flex-col items-center justify-center gap-4 py-12">
                <div className="rounded-full bg-white/5 p-6">
                    <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                    </svg>
                </div>
                <div className="text-center">
                    <p className="font-medium text-fg-primary">Nenhum cartÃ£o cadastrado</p>
                    <p className="mt-1 text-sm text-fg-secondary">
                        Cadastre seu primeiro cartÃ£o para comeÃ§ar a acompanhar seus pontos.
                    </p>
                </div>
            </div>
        )
    }

    return (
        <div className="grid gap-6 grid-cols-[repeat(auto-fill,minmax(20rem,1fr))]">
            {cards.map((card, index) => {
                const programasList = card.programas ?? []
                const variant = getCardVariant(card.bandeira)

                return (
                    <div
                        key={card.id ?? `${card.nome}-${index}`}
                        className="group relative flex flex-col"
                    >
                        <div className="relative">
                            <CreditCardPreview
                                holderName={card.nome ?? `CartÃ£o ${index + 1}`}
                                lastDigits={card.numero ? card.numero.slice(-4) : '****'}
                                cardTier={getTipoLabel(card.tipo) ?? 'CrÃ©dito'}
                                variant={variant}
                                className="transition-transform duration-300 group-hover:scale-[1.02] group-hover:shadow-2xl"
                            />

                            {/* AÃ§Ãµes (Editar/Excluir) */}
                            <div className="absolute right-3 top-3 z-10 flex gap-1 opacity-0 transition-opacity duration-200 group-hover:opacity-100">
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.stopPropagation()
                                        onEdit(card)
                                    }}
                                    className="rounded-lg bg-black/50 p-2 text-white/80 backdrop-blur-sm hover:bg-black/70 hover:text-white transition-colors"
                                    title="Editar"
                                >
                                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                    </svg>
                                </button>
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.stopPropagation()
                                        if (card.id) handleDeleteClick(card.id)
                                    }}
                                    disabled={deletingId === card.id}
                                    className="rounded-lg bg-black/50 p-2 text-white/80 backdrop-blur-sm hover:bg-red-500/80 hover:text-white transition-colors disabled:opacity-50"
                                    title="Excluir"
                                >
                                    {deletingId === card.id ? (
                                        <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                                    ) : (
                                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                        </svg>
                                    )}
                                </button>
                            </div>

                            {/* ConfirmaÃ§Ã£o de ExclusÃ£o */}
                            {confirmDeleteId === card.id && (
                                <div className="absolute inset-0 z-20 flex items-center justify-center rounded-xl bg-black/80 backdrop-blur-sm">
                                    <div className="text-center p-4">
                                        <div className="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-red-500/20">
                                            <svg className="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                            </svg>
                                        </div>
                                        <p className="text-sm font-medium text-white">Excluir este cartÃ£o?</p>
                                        <p className="mt-1 text-xs text-white/60">Esta aÃ§Ã£o nÃ£o pode ser desfeita.</p>
                                        <div className="mt-4 flex justify-center gap-2">
                                            <button
                                                type="button"
                                                onClick={(e) => {
                                                    e.stopPropagation()
                                                    handleDeleteCancel()
                                                }}
                                                className="rounded-lg border border-white/20 bg-gray-600 px-4 py-2 text-xs font-semibold text-white hover:bg-gray-500 transition-colors"
                                            >
                                                Cancelar
                                            </button>
                                            <button
                                                type="button"
                                                onClick={(e) => {
                                                    e.stopPropagation()
                                                    if (card.id) handleConfirmDelete(card.id)
                                                }}
                                                className="rounded-lg bg-red-500 px-4 py-2 text-xs font-semibold text-white hover:bg-red-600 transition-colors"
                                            >
                                                Excluir
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* InformaÃ§Ãµes do CartÃ£o */}
                        <div className="mt-4 space-y-3 rounded-xl border border-white/10 bg-white/5 p-4">
                            <div className="flex items-center justify-between">
                                <span className="text-xs font-semibold uppercase tracking-wider text-fg-secondary">
                                    Validade
                                </span>
                                <div className="flex items-center gap-2">
                                    <span className="text-sm font-medium text-fg-primary">
                                        {card.dataValidade
                                            ? new Date(card.dataValidade + 'T00:00:00').toLocaleDateString('pt-BR', {
                                                month: '2-digit',
                                                year: 'numeric',
                                            })
                                            : 'â€”'}
                                    </span>
                                    {card.valido && (
                                        <span
                                            className={`rounded-full px-2 py-0.5 text-[0.625rem] font-semibold uppercase ${card.valido === 'ATIVO'
                                                ? 'bg-green-500/20 text-green-400'
                                                : card.valido === 'VENCIDO'
                                                    ? 'bg-red-500/20 text-red-400'
                                                    : 'bg-yellow-500/20 text-yellow-400'
                                                }`}
                                        >
                                            {card.valido === 'ATIVO' ? 'VÃ¡lido' : card.valido === 'VENCIDO' ? 'Expirado' : 'Bloqueado'}
                                        </span>
                                    )}
                                </div>
                            </div>

                            {programasList.length > 0 && (
                                <div className="border-t border-white/10 pt-3">
                                    <p className="mb-2 text-xs font-semibold uppercase tracking-wider text-fg-secondary">
                                        Pontua em
                                    </p>
                                    <div className="flex flex-wrap gap-2">
                                        {programasList.map((prog) => (
                                            <span
                                                key={prog.id}
                                                className="rounded-full bg-accent-pool/10 px-3 py-1 text-xs font-medium text-accent-pool"
                                            >
                                                {prog.nome}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                )
            })}
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\cartoes\CreditCardPreview.tsx'>
import visaLogo from '../../../assets/brands/bandeiras/visa.svg'
import mastercardLogo from '../../../assets/brands/bandeiras/mastercard.svg'
import amexLogo from '../../../assets/brands/bandeiras/amex.svg'
import eloLogo from '../../../assets/brands/bandeiras/elo.svg'
import hipercardLogo from '../../../assets/brands/bandeiras/hipercard.svg'

export type CardVariant = 'black' | 'platinum' | 'gold' | 'silver' | 'mastercard' | 'elo' | 'hipercard'
export type CardSize = 'default' | 'mini'

interface CreditCardPreviewProps {
    holderName: string
    lastDigits: string
    cardType?: string // e.x. "Black", "Gold"
    cardTier?: string // e.x. "Infinite", "Platinum"
    variant?: CardVariant
    bandeira?: string // e.x. "VISA", "MASTERCARD"
    size?: CardSize
    className?: string
}

const variantStyles: Record<CardVariant, {
    card: string
    tierColor: string
    textPrimary: string
    textSecondary: string
    numberColor: string
    shadow: string
    isLight: boolean
    chipStyle: 'gold' | 'silver' | 'gold-bordered'
    hasShine: boolean
    logo: string
    logoClass: string
}> = {
    // Visa Black - Premium escuro neutro (Prata Fosco / Branco Gelo)
    black: {
        card: 'from-zinc-800 via-neutral-900 to-zinc-950',
        tierColor: 'text-amber-400',
        textPrimary: 'text-gray-200',
        textSecondary: 'text-gray-400',
        numberColor: 'text-gray-300/80',
        shadow: 'drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]',
        isLight: false,
        chipStyle: 'gold',
        hasShine: false,
        logo: visaLogo,
        logoClass: 'h-6 w-auto opacity-90',
    },
    // Generic Platinum - Gunmetal/TitÃ¢nio (Branco + Ciano sutil)
    platinum: {
        card: 'from-slate-500 via-slate-600 to-slate-700',
        tierColor: 'text-cyan-300',
        textPrimary: 'text-white',
        textSecondary: 'text-slate-300',
        numberColor: 'text-white/80',
        shadow: 'drop-shadow-[0_1px_2px_rgba(0,0,0,0.6)]',
        isLight: false,
        chipStyle: 'gold',
        hasShine: true,
        logo: visaLogo,
        logoClass: 'h-6 w-auto opacity-90',
    },
    // Amex Gold - Azul Marinho / Cinza CarvÃ£o para contraste elegante
    gold: {
        card: 'from-amber-500 via-yellow-600 to-amber-700',
        tierColor: 'text-blue-900',
        textPrimary: 'text-slate-800',
        textSecondary: 'text-amber-900/70',
        numberColor: 'text-slate-700/90',
        shadow: 'drop-shadow-[0_1px_1px_rgba(255,255,255,0.4)]',
        isLight: true,
        chipStyle: 'gold-bordered',
        hasShine: true,
        logo: amexLogo,
        logoClass: 'h-8 w-auto',
    },
    // Generic Silver - Prata claro (texto escuro)
    silver: {
        card: 'from-gray-300 via-gray-400 to-gray-500',
        tierColor: 'text-gray-700',
        textPrimary: 'text-gray-800',
        textSecondary: 'text-gray-600',
        numberColor: 'text-gray-700/90',
        shadow: 'drop-shadow-[0_1px_1px_rgba(255,255,255,0.5)]',
        isLight: true,
        chipStyle: 'silver',
        hasShine: true,
        logo: visaLogo,
        logoClass: 'h-6 w-auto invert',
    },
    // Mastercard Platinum - Grafite escuro (Branco + Laranja PÃ¡lido)
    mastercard: {
        card: 'from-gray-800 via-gray-900 to-black',
        tierColor: 'text-orange-400',
        textPrimary: 'text-white',
        textSecondary: 'text-orange-200/60',
        numberColor: 'text-white/80',
        shadow: 'drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]',
        isLight: false,
        chipStyle: 'gold',
        hasShine: false,
        logo: mastercardLogo,
        logoClass: 'h-8 w-auto',
    },
    // Hipercard - Vermelho Rubi (Branco / Prata metÃ¡lico)
    hipercard: {
        card: 'from-red-600 via-rose-700 to-red-800',
        tierColor: 'text-red-100',
        textPrimary: 'text-white',
        textSecondary: 'text-red-200/70',
        numberColor: 'text-white/85',
        shadow: 'drop-shadow-[0_1px_2px_rgba(0,0,0,0.6)]',
        isLight: false,
        chipStyle: 'gold',
        hasShine: false,
        logo: hipercardLogo,
        logoClass: 'h-6 w-auto',
    },
    // Elo - Prata com azul (Preto / Azul PetrÃ³leo escuro)
    elo: {
        card: 'from-slate-200 via-blue-100 to-slate-300',
        tierColor: 'text-blue-700',
        textPrimary: 'text-slate-800',
        textSecondary: 'text-blue-800/60',
        numberColor: 'text-slate-700/90',
        shadow: 'drop-shadow-[0_1px_1px_rgba(255,255,255,0.5)]',
        isLight: true,
        chipStyle: 'silver',
        hasShine: true,
        logo: eloLogo,
        logoClass: 'h-7 w-auto',
    },
}

// Componente de Chip com variantes de cor e tamanho
function CardChip({ style, size = 'default' }: { style: 'gold' | 'silver' | 'gold-bordered'; size?: CardSize }) {
    const isMini = size === 'mini'
    const baseClasses = isMini
        ? 'h-4 w-6 rounded-sm shadow-inner'
        : 'h-8 w-11 rounded shadow-inner'
    const gridClasses = isMini ? 'p-0.5 gap-[1px]' : 'p-1 gap-px'

    if (style === 'silver') {
        return (
            <div className={`${baseClasses} bg-gradient-to-br from-slate-300 via-gray-400 to-slate-500`}>
                <div className={`grid h-full grid-cols-3 ${gridClasses}`}>
                    {[...Array(6)].map((_, i) => (
                        <div key={i} className="rounded-sm bg-slate-600/40" />
                    ))}
                </div>
            </div>
        )
    }

    if (style === 'gold-bordered') {
        return (
            <div className={`${baseClasses} bg-gradient-to-br from-amber-300 via-amber-400 to-amber-600 ring-1 ring-amber-900/30`}>
                <div className={`grid h-full grid-cols-3 ${gridClasses}`}>
                    {[...Array(6)].map((_, i) => (
                        <div key={i} className="rounded-sm bg-amber-700/40" />
                    ))}
                </div>
            </div>
        )
    }

    // Default gold
    return (
        <div className={`${baseClasses} bg-gradient-to-br from-amber-300 via-amber-400 to-amber-600`}>
            <div className={`grid h-full grid-cols-3 ${gridClasses}`}>
                {[...Array(6)].map((_, i) => (
                    <div key={i} className="rounded-sm bg-amber-700/40" />
                ))}
            </div>
        </div>
    )
}

export default function CreditCardPreview({
    holderName = 'SEU NOME',
    lastDigits = '1234',
    cardTier = 'INFINITE',
    variant = 'black',
    size = 'default',
    className = '',
}: CreditCardPreviewProps) {
    const styles = variantStyles[variant]
    const isMini = size === 'mini'

    // Mini card - versÃ£o compacta para dashboards
    if (isMini) {
        return (
            <div
                className={`relative h-20 w-full overflow-hidden rounded-lg bg-gradient-to-br ${styles.card} p-2.5 shadow-md ${className}`}
            >
                {/* Listra hologrÃ¡fica do cartÃ£o */}
                <div className={`absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent ${styles.isLight ? 'via-black/10' : 'via-white/20'} to-transparent`} />

                {/* CabeÃ§alho: Chip + Logo da Bandeira */}
                <div className="flex items-center justify-between">
                    <CardChip style={styles.chipStyle} size="mini" />
                    <img
                        src={styles.logo}
                        alt="Card Brand"
                        className="h-4 w-auto opacity-90"
                    />
                </div>

                {/* RodapÃ© do cartÃ£o - nome e Ãºltimos dÃ­gitos */}
                <div className="mt-2 flex items-end justify-between">
                    <p className={`text-[10px] font-medium ${styles.textPrimary} truncate max-w-[60%] ${styles.shadow}`}>{holderName}</p>
                    <span className={`font-mono text-[11px] ${styles.numberColor}`}>â€¢â€¢â€¢â€¢ {lastDigits}</span>
                </div>
            </div>
        )
    }

    // CartÃ£o em tamanho real padrÃ£o
    return (
        <div
            className={`relative h-44 w-full overflow-hidden rounded-xl bg-gradient-to-br ${styles.card} p-5 shadow-[0_8px_32px_rgba(0,0,0,0.4)] ${className}`}
        >
            {/* Efeito de brilho animado para cartÃµes metÃ¡licos - VisÃ­vel apenas ao pairar */}
            {styles.hasShine && (
                <div className="pointer-events-none absolute inset-0 overflow-hidden rounded-xl opacity-0 transition-opacity duration-500 group-hover:opacity-100">
                    <div className="absolute -inset-full animate-[shimmer_3s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12" />
                </div>
            )}

            {/* Listra hologrÃ¡fica do cartÃ£o */}
            <div className={`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent ${styles.isLight ? 'via-black/10' : 'via-white/20'} to-transparent`} />

            {/* CabeÃ§alho: Chip + Logo da Bandeira */}
            <div className="flex items-start justify-between">
                <CardChip style={styles.chipStyle} />
                <img
                    src={styles.logo}
                    alt="Card Brand"
                    className={styles.logoClass}
                />
            </div>

            {/* NÃºmero do cartÃ£o - Fonte monospace para realismo */}
            <div className={`mt-4 flex gap-3 font-mono text-lg font-medium tracking-widest ${styles.numberColor} ${styles.shadow}`}>
                <span>â€¢â€¢â€¢â€¢</span>
                <span>â€¢â€¢â€¢â€¢</span>
                <span>â€¢â€¢â€¢â€¢</span>
                <span>{lastDigits}</span>
            </div>

            {/* RodapÃ© do cartÃ£o */}
            <div className="mt-4 flex items-end justify-between">
                <div>
                    <p className={`text-[10px] uppercase tracking-wider ${styles.textSecondary}`}>Titular</p>
                    <p className={`text-sm font-medium ${styles.textPrimary} ${styles.shadow}`}>{holderName}</p>
                </div>
                <div className="text-right">
                    <p className={`text-xs font-semibold tracking-wide ${styles.tierColor} ${styles.shadow}`}>{cardTier}</p>
                </div>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\config\AppearanceSettings.tsx'>

import { useTheme } from '../../../hooks/useTheme'
import { ThemeCard } from './ThemeCard'

export function AppearanceSettings() {
    const { theme, setTheme } = useTheme()

    return (
        <div className="space-y-6">
            {/* Theme Selection */}
            <div className="dashboard-card">
                <div className="section-header">
                    <div className="card-icon">
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                        </svg>
                    </div>
                    <div className="flex-1">
                        <h2 className="section-title">Tema da Interface</h2>
                        <p className="text-xs text-fg-secondary">Escolha como a interface serÃ¡ exibida</p>
                    </div>
                </div>

                <div className="mt-4 grid grid-cols-3 gap-4">
                    <ThemeCard
                        theme="light"
                        label="Claro"
                        isSelected={theme === 'light'}
                        onClick={() => setTheme('light')}
                        icon={
                            <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                            </svg>
                        }
                    />
                    <ThemeCard
                        theme="dark"
                        label="Escuro"
                        isSelected={theme === 'dark'}
                        onClick={() => setTheme('dark')}
                        icon={
                            <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                            </svg>
                        }
                    />
                    <ThemeCard
                        theme="system"
                        label="Sistema"
                        isSelected={theme === 'system'}
                        onClick={() => setTheme('system')}
                        icon={
                            <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25" />
                            </svg>
                        }
                    />
                </div>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\config\GeneralSettings.tsx'>

import { usePreferences } from '../../../hooks/usePreferences'
import { Toggle } from '../../ui/Toggle'

export function GeneralSettings() {
    const { preferences, setPreference } = usePreferences()

    return (
        <div className="space-y-6">
            {/* Accessibility */}
            <div className="dashboard-card">
                <div className="section-header">
                    <div className="card-icon">
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
                        </svg>
                    </div>
                    <div className="flex-1">
                        <h2 className="section-title">Acessibilidade</h2>
                        <p className="text-xs text-fg-secondary">Ajuste a experiÃªncia visual</p>
                    </div>
                </div>

                <div className="mt-4 divide-y divide-white/10">
                    <Toggle
                        enabled={preferences.reduceMotion}
                        onToggle={() => setPreference('reduceMotion', !preferences.reduceMotion)}
                        label="Reduzir efeitos visuais"
                        description="Desabilita animaÃ§Ãµes, transiÃ§Ãµes e efeitos de blur para melhor desempenho"
                    />
                </div>
            </div>

            {/* Privacy */}
            <div className="dashboard-card">
                <div className="section-header">
                    <div className="card-icon">
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                        </svg>
                    </div>
                    <div className="flex-1">
                        <h2 className="section-title">Privacidade</h2>
                        <p className="text-xs text-fg-secondary">Controle a visibilidade dos seus dados</p>
                    </div>
                </div>

                <div className="mt-4 divide-y divide-white/10">
                    <Toggle
                        enabled={preferences.hideValues}
                        onToggle={() => setPreference('hideValues', !preferences.hideValues)}
                        label="Ocultar valores monetÃ¡rios/pontos"
                        description="Mascara os valores exibidos na Dashboard"
                    />
                </div>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\config\NotificationSettings.tsx'>

import { usePreferences } from '../../../hooks/usePreferences'
import { Toggle } from '../../ui/Toggle'

export function NotificationSettings() {
    const { preferences, setNotificationPreference } = usePreferences()

    return (
        <div className="space-y-6">
            <div className="dashboard-card">
                <div className="section-header">
                    <div className="card-icon">
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
                        </svg>
                    </div>
                    <div className="flex-1">
                        <h2 className="section-title">PreferÃªncias de NotificaÃ§Ã£o</h2>
                        <p className="text-xs text-fg-secondary">Escolha quais alertas deseja receber</p>
                    </div>
                    <span className="badge">SimulaÃ§Ã£o</span>
                </div>

                <div className="mt-4 divide-y divide-white/10">
                    <Toggle
                        enabled={preferences.notifications.expirationAlerts}
                        onToggle={() => setNotificationPreference('expirationAlerts', !preferences.notifications.expirationAlerts)}
                        label="Alertas de expiraÃ§Ã£o de pontos"
                        description="Receba avisos quando seus pontos estiverem prÃ³ximos de expirar"
                    />
                    <Toggle
                        enabled={preferences.notifications.newPromotions}
                        onToggle={() => setNotificationPreference('newPromotions', !preferences.notifications.newPromotions)}
                        label="Novas promoÃ§Ãµes"
                        description="Seja notificado sobre promoÃ§Ãµes de milhas e pontos"
                    />
                    <Toggle
                        enabled={preferences.notifications.weeklySummary}
                        onToggle={() => setNotificationPreference('weeklySummary', !preferences.notifications.weeklySummary)}
                        label="Resumo semanal"
                        description="Receba um resumo semanal das suas atividades"
                    />
                </div>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\config\SecuritySettings.tsx'>
import React, { useState, useCallback } from 'react'
import { notify } from '../../../utils/notify'

export function SecuritySettings() {
    const [passwordForm, setPasswordForm] = useState({
        currentPassword: '',
        newPassword: '',
        confirmPassword: '',
    })
    const [changingPassword, setChangingPassword] = useState(false)

    const handlePasswordChange = useCallback(async (e: React.FormEvent) => {
        e.preventDefault()

        if (!passwordForm.currentPassword) {
            notify.error('Informe a senha atual.')
            return
        }

        if (passwordForm.newPassword.length < 6) {
            notify.error('A nova senha deve ter pelo menos 6 caracteres.')
            return
        }

        if (passwordForm.newPassword !== passwordForm.confirmPassword) {
            notify.error('As senhas nÃ£o coincidem.')
            return
        }

        setChangingPassword(true)
        try {
            // Simulate API call
            await new Promise((resolve) => setTimeout(resolve, 1000))
            notify.success('Senha alterada com sucesso!')
            setPasswordForm({ currentPassword: '', newPassword: '', confirmPassword: '' })
        } catch (error) {
            notify.apiError(error, { fallback: 'NÃ£o foi possÃ­vel alterar a senha.' })
        } finally {
            setChangingPassword(false)
        }
    }, [passwordForm])

    return (
        <div className="space-y-6">
            <div className="dashboard-card">
                <div className="section-header">
                    <div className="card-icon">
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" />
                        </svg>
                    </div>
                    <div className="flex-1">
                        <h2 className="section-title">Alterar Senha</h2>
                        <p className="text-xs text-fg-secondary">Atualize sua senha de acesso</p>
                    </div>
                </div>

                <form onSubmit={handlePasswordChange} className="mt-6 space-y-4">
                    {/* Current Password */}
                    <div className="space-y-2">
                        <label htmlFor="currentPassword" className="block text-sm font-medium text-fg-primary">
                            Senha atual
                        </label>
                        <input
                            id="currentPassword"
                            type="password"
                            value={passwordForm.currentPassword}
                            onChange={(e) => setPasswordForm((prev) => ({ ...prev, currentPassword: e.target.value }))}
                            placeholder="Digite sua senha atual"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        />
                    </div>

                    {/* New Password */}
                    <div className="space-y-2">
                        <label htmlFor="newPassword" className="block text-sm font-medium text-fg-primary">
                            Nova senha
                        </label>
                        <input
                            id="newPassword"
                            type="password"
                            value={passwordForm.newPassword}
                            onChange={(e) => setPasswordForm((prev) => ({ ...prev, newPassword: e.target.value }))}
                            placeholder="Digite a nova senha"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        />
                    </div>

                    {/* Confirm Password */}
                    <div className="space-y-2">
                        <label htmlFor="confirmPassword" className="block text-sm font-medium text-fg-primary">
                            Confirmar nova senha
                        </label>
                        <input
                            id="confirmPassword"
                            type="password"
                            value={passwordForm.confirmPassword}
                            onChange={(e) => setPasswordForm((prev) => ({ ...prev, confirmPassword: e.target.value }))}
                            placeholder="Confirme a nova senha"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 transition-all"
                        />
                    </div>

                    {/* Submit Button */}
                    <div className="flex justify-end pt-2">
                        <button
                            type="submit"
                            disabled={changingPassword}
                            className="btn-primary group relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            {changingPassword ? (
                                <>
                                    <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                                    Alterando...
                                </>
                            ) : (
                                <>
                                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                                    </svg>
                                    Alterar senha
                                </>
                            )}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\config\ThemeCard.tsx'>
import React from 'react'

interface ThemeCardProps {
    label: string
    icon: React.ReactNode
    isSelected: boolean
    onClick: () => void
    theme?: 'light' | 'dark' | 'system'
}

export function ThemeCard({ label, icon, isSelected, onClick }: ThemeCardProps) {
    return (
        <button
            type="button"
            onClick={onClick}
            className={`group relative flex flex-col items-center gap-3 rounded-xl border p-4 transition-all duration-300 ${isSelected
                    ? 'border-accent-pool/50 bg-gradient-to-br from-accent-sky/10 to-accent-pool/10 shadow-lg shadow-accent-pool/20'
                    : 'border-white/10 bg-white/5 hover:border-white/20 hover:bg-white/10'
                }`}
        >
            <div
                className={`flex h-12 w-12 items-center justify-center rounded-xl transition-all duration-300 ${isSelected
                        ? 'bg-gradient-to-br from-accent-sky to-accent-pool text-white'
                        : 'bg-white/10 text-fg-secondary group-hover:text-fg-primary'
                    }`}
            >
                {icon}
            </div>
            <span
                className={`text-sm font-medium transition-colors ${isSelected ? 'text-accent-pool' : 'text-fg-secondary group-hover:text-fg-primary'
                    }`}
            >
                {label}
            </span>
            {isSelected && (
                <div className="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-accent-pool">
                    <svg
                        className="h-3 w-3 text-white"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        strokeWidth={3}
                    >
                        <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                    </svg>
                </div>
            )}
        </button>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\DashboardCards.tsx'>
import type { FC } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { getBrandLogo } from '../../../pages/Dashboard/utils'
import type { CartaoResponseDTO } from '../../../interfaces/cartaoUsuario'

interface DashboardCardsProps {
    cards: CartaoResponseDTO[]
}

export const DashboardCards: FC<DashboardCardsProps> = ({ cards }) => {
    const navigate = useNavigate()

    const CardIcon = (
        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
        </svg>
    )

    return (
        <div className="dashboard-card">
            {/* Section Header */}
            <div className="section-header">
                <div className="card-icon">
                    {CardIcon}
                </div>
                <div className="flex-1">
                    <h2 className="section-title">CartÃµes cadastrados</h2>
                </div>
                <span className="badge">{cards.length} ativos</span>
            </div>
            {/* Lista Compacta de CartÃµes */}
            <div className={`mt-4 flex-1 flex flex-col ${cards.length > 4 ? 'overflow-y-auto max-h-[16rem]' : ''}`}>
                {cards.length ? (
                    <div className="space-y-2">
                        {cards.map((card, index) => {
                            const brandLogo = getBrandLogo(card.bandeira as string)
                            return (
                                <div
                                    key={card.id ?? `${card.nome}-${index}`}
                                    onClick={() => navigate('/dashboard/cartoes', { state: { editCardId: card.id } })}
                                    className="group flex items-center gap-3 p-3 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 hover:border-accent-pool/30 transition-all duration-200 cursor-pointer"
                                >
                                    {/* Logo da Bandeira ou Ãcone de Fallback */}
                                    <div className="flex-shrink-0 w-10 h-7 flex items-center justify-center rounded bg-white/10">
                                        {brandLogo ? (
                                            <img src={brandLogo} alt={card.bandeira ?? 'Card'} className="h-5 w-auto" />
                                        ) : (
                                            <svg className="h-4 w-4 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                                            </svg>
                                        )}
                                    </div>
                                    {/* Info do CartÃ£o */}
                                    <div className="flex-1 min-w-0">
                                        <p className="text-sm font-medium text-fg-primary truncate group-hover:text-accent-pool transition-colors">
                                            {card.nome ?? `CartÃ£o ${index + 1}`}
                                        </p>
                                        <p className="text-xs text-fg-secondary truncate">
                                            {card.tipo?.replace('_', ' ') ?? 'CrÃ©dito'} â€¢ â€¢â€¢â€¢â€¢ {card.numero?.slice(-4) ?? '****'}
                                        </p>
                                    </div>
                                    {/* Indicador de seta ao passar mouse */}
                                    <svg className="h-4 w-4 text-fg-secondary opacity-0 group-hover:opacity-100 group-hover:text-accent-pool transition-all" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                                    </svg>
                                </div>
                            )
                        })}
                    </div>
                ) : null}

                {/* BotÃ£o CTA - Mostra quando hÃ¡ poucos ou nenhum cartÃ£o */}
                {cards.length < 3 && (
                    <Link
                        to="/dashboard/cartoes"
                        className="mt-3 flex items-center justify-center gap-2 p-4 rounded-lg border-2 border-dashed border-fg-secondary/30 hover:border-accent-pool/50 hover:bg-accent-pool/5 transition-all duration-200 group"
                    >
                        <svg className="h-5 w-5 text-fg-secondary group-hover:text-accent-pool transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        <span className="text-sm font-medium text-fg-secondary group-hover:text-accent-pool transition-colors">
                            Adicionar novo cartÃ£o
                        </span>
                    </Link>
                )}
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\DashboardHeader.tsx'>
import type { FC } from 'react'

interface DashboardHeaderProps {
    onExportCsv: () => void
    onExportPdf: () => void
}

export const DashboardHeader: FC<DashboardHeaderProps> = ({ onExportCsv, onExportPdf }) => {
    return (
        <header className="flex flex-wrap items-center justify-between gap-4">
            <div>
                <h1 className="titulo-grafico text-3xl font-bold">
                    Resumo geral
                </h1>
                <p className="mt-2 text-sm text-fg-secondary">
                    Acompanhe seus pontos e milhas em um sÃ³ lugar.
                </p>
            </div>
            <div className="flex items-center gap-3">
                <button
                    type="button"
                    onClick={onExportCsv}
                    className="btn-secondary group"
                >
                    <svg className="h-4 w-4 text-fg-secondary group-hover:text-accent-pool transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    Exportar CSV
                </button>
                <button
                    type="button"
                    onClick={onExportPdf}
                    className="btn-primary group"
                >
                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    Exportar PDF
                </button>
            </div>
        </header>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\DashboardStats.tsx'>
import type { FC } from 'react'
import SensitiveValue from '../../ui/SensitiveValue'
import { toNumber } from '../../../pages/Dashboard/utils'
import type { RelatorioResponseDTO } from '../../../interfaces/relatorio'

interface DashboardStatsProps {
    totalPoints: number
    programSummary: { label: string; value: number }[]
    relatorio: RelatorioResponseDTO | null
}

export const DashboardStats: FC<DashboardStatsProps> = ({ totalPoints, programSummary, relatorio }) => {
    // CÃ¡lculos financeiros
    const avgPointValue = 0.02 // R$ 0,02 per point (average)
    const estimatedValue = totalPoints * avgPointValue

    // Calcula crescimento mensal real via evolucaoMensal
    const evolucao = relatorio?.evolucaoMensal ?? []
    let monthlyGrowth = 0
    let hasGrowthData = false

    if (evolucao.length >= 2) {
        // Ordena por data para obter os dois Ãºltimos meses
        const sorted = [...evolucao]
            .filter((item) => item.ano != null && item.mes != null)
            .sort((a, b) => {
                const aDate = new Date(a.ano, a.mes - 1, 1)
                const bDate = new Date(b.ano, b.mes - 1, 1)
                return aDate.getTime() - bDate.getTime()
            })

        if (sorted.length >= 2) {
            const currentMonth = sorted[sorted.length - 1]
            const previousMonth = sorted[sorted.length - 2]
            const currentTotal = toNumber(currentMonth.totalPontos)
            const previousTotal = toNumber(previousMonth.totalPontos)

            if (previousTotal > 0) {
                monthlyGrowth = ((currentTotal - previousTotal) / previousTotal) * 100
                hasGrowthData = true
            }
        }
    }

    // Cores dos programas para barra de distribuiÃ§Ã£o
    const programColors = [
        'bg-accent-pool', 'bg-accent-sky', 'bg-purple-500',
        'bg-amber-500', 'bg-rose-500', 'bg-emerald-500'
    ]

    // Define estilo do badge baseado na direÃ§Ã£o do crescimento
    const isPositiveGrowth = monthlyGrowth >= 0
    const badgeBgClass = isPositiveGrowth ? 'bg-emerald-500/20' : 'bg-red-500/20'
    const badgeTextClass = isPositiveGrowth ? 'text-emerald-400' : 'text-red-400'
    const growthSign = isPositiveGrowth ? '+' : ''

    const WalletIcon = (
        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3" />
        </svg>
    )

    return (
        <div className="dashboard-card stat-card">
            {/* ===== MEIO: SeÃ§Ã£o Financeira Principal ===== */}
            <div className="flex flex-wrap gap-6 mb-6">
                {/* Esquerda: Total de Pontos */}
                <div className="flex-1 min-w-[12rem]">
                    <div className="flex items-start gap-3">
                        <div className="card-icon">
                            {WalletIcon}
                        </div>
                        <div>
                            <p className="text-xs font-semibold uppercase tracking-[0.15em] text-fg-secondary">
                                Saldo Total
                            </p>
                            <p className="stat-value mt-1">
                                <SensitiveValue>{totalPoints.toLocaleString('pt-BR')}</SensitiveValue> <span className="text-lg">pts</span>
                            </p>
                            {/* Badge de TendÃªncia */}
                            {hasGrowthData && (
                                <div className={`mt-2 inline-flex items-center gap-1.5 px-2 py-1 rounded-full ${badgeBgClass} ${badgeTextClass}`}>
                                    {isPositiveGrowth ? (
                                        <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25" />
                                        </svg>
                                    ) : (
                                        <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 4.5l-15 15m0 0h11.25M4.5 19.5V8.25" />
                                        </svg>
                                    )}
                                    <span className="text-xs font-semibold">{growthSign}{monthlyGrowth.toFixed(1)}% este mÃªs</span>
                                </div>
                            )}
                        </div>
                    </div>
                </div>

                {/* Direita: Valor Estimado */}
                <div className="flex-1 min-w-[12rem]">
                    <div className="p-4 rounded-xl border border-white/10 bg-white/5">
                        <p className="text-xs font-semibold uppercase tracking-[0.15em] text-fg-secondary mb-1">
                            ConversÃ£o Estimada
                        </p>
                        <p className="text-3xl font-bold titulo-grafico">
                            <SensitiveValue placeholder="R$ â€¢â€¢â€¢â€¢â€¢â€¢">R$ {estimatedValue.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</SensitiveValue>
                        </p>
                        <p className="mt-1 text-xs text-fg-secondary">
                            CotaÃ§Ã£o mÃ©dia: R$ {avgPointValue.toFixed(2)}/pt
                        </p>
                    </div>
                </div>
            </div>

            {/* ===== ABAIXO: DistribuiÃ§Ã£o por Programa ===== */}
            {programSummary.length > 0 && (
                <div>
                    <p className="text-xs font-semibold uppercase tracking-[0.15em] text-fg-secondary mb-3">
                        DistribuiÃ§Ã£o por Programa
                    </p>

                    {/* Barra de DistribuiÃ§Ã£o Segmentada */}
                    <div className="h-3 rounded-full overflow-hidden flex bg-white/10">
                        {programSummary.map((item, idx) => {
                            const percentage = totalPoints > 0 ? (item.value / totalPoints) * 100 : 0
                            return (
                                <div
                                    key={item.label}
                                    className={`${programColors[idx % programColors.length]} transition-all duration-500 first:rounded-l-full last:rounded-r-full`}
                                    style={{ width: `${percentage}%` }}
                                    title={`${item.label}: ${item.value.toLocaleString('pt-BR')} pts (${percentage.toFixed(1)}%)`}
                                />
                            )
                        })}
                    </div>

                    {/* Grade de Legenda */}
                    <div className="mt-4 grid grid-cols-2 sm:grid-cols-3 gap-2">
                        {programSummary.map((item, idx) => {
                            const percentage = totalPoints > 0 ? (item.value / totalPoints) * 100 : 0
                            return (
                                <div
                                    key={item.label}
                                    className="flex items-center gap-2 p-2 rounded-lg border border-white/10 bg-white/5"
                                >
                                    <div className={`h-3 w-3 rounded-full ${programColors[idx % programColors.length]}`} />
                                    <div className="flex-1 min-w-0">
                                        <p className="text-xs font-medium text-fg-primary truncate">{item.label}</p>
                                        <p className="text-[10px] text-fg-secondary">
                                            <SensitiveValue>{item.value.toLocaleString('pt-BR')}</SensitiveValue> pts â€¢ {percentage.toFixed(0)}%
                                        </p>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            )}

            {programSummary.length === 0 && (
                <p className="text-sm text-fg-secondary text-center py-4">
                    Nenhum programa conectado ainda.
                </p>
            )}
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\HistoryChart.tsx'>
import type { FC } from 'react'
import SensitiveValue from '../../ui/SensitiveValue'
import { buildAreaPolygon, buildLinePoints, chartHeight, chartWidth } from '../../../pages/Dashboard/utils'

interface HistoryChartProps {
    historySeries: { label: string; value: number }[]
}

export const HistoryChart: FC<HistoryChartProps> = ({ historySeries }) => {
    const ClockIcon = (
        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
    )

    const historyValues = historySeries.map((item) => item.value)
    const maxHistory = Math.max(...historyValues, 1)
    const areaPolygon = buildAreaPolygon(historyValues)
    const historyLine = buildLinePoints(historyValues)

    const formatYLabel = (value: number) => {
        if (value >= 1000) return `${(value / 1000).toFixed(1).replace(/\.0$/, '')}k`
        return value.toString()
    }

    return (
        <div className="dashboard-card">
            {/* Section Header */}
            <div className="section-header">
                <div className="card-icon">
                    {ClockIcon}
                </div>
                <div className="flex-1">
                    <h2 className="section-title">HistÃ³rico de acÃºmulo</h2>
                </div>
                <span className="badge">{historySeries.length} movimentaÃ§Ãµes</span>
            </div>
            {/* Chart Container */}
            <div className="chart-container mt-4">
                {historySeries.length ? (
                    <>
                        <div className="flex gap-2">
                            {/* Y-axis labels - 5 values */}
                            <div className="flex flex-col justify-between text-[0.625rem] h-28 py-1 pr-1 text-right min-w-[2rem]">
                                <span className="titulo-grafico font-semibold"><SensitiveValue>{formatYLabel(maxHistory)}</SensitiveValue></span>
                                <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxHistory * 0.75))}</SensitiveValue></span>
                                <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxHistory * 0.5))}</SensitiveValue></span>
                                <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxHistory * 0.25))}</SensitiveValue></span>
                                <span className="text-fg-secondary">0</span>
                            </div>
                            {/* Chart SVG */}
                            <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="h-28 flex-1" aria-hidden="true">
                                {/* DefiniÃ§Ãµes de gradiente */}
                                <defs>
                                    <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stopColor="rgba(39, 121, 167, 0.4)" />
                                        <stop offset="100%" stopColor="rgba(39, 121, 167, 0)" />
                                    </linearGradient>
                                    <linearGradient id="historyLineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stopColor="rgb(39, 121, 167)" />
                                        <stop offset="100%" stopColor="rgb(73, 197, 182)" />
                                    </linearGradient>
                                </defs>
                                {/* Grid lines - 4 lines for 5 sections */}
                                <line x1="0" y1={chartHeight * 0.2} x2={chartWidth} y2={chartHeight * 0.2} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                <line x1="0" y1={chartHeight * 0.4} x2={chartWidth} y2={chartHeight * 0.4} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                <line x1="0" y1={chartHeight * 0.6} x2={chartWidth} y2={chartHeight * 0.6} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                <line x1="0" y1={chartHeight * 0.8} x2={chartWidth} y2={chartHeight * 0.8} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                {/* Ãrea */}
                                <polygon points={areaPolygon} fill="url(#areaGradient)" />
                                {/* Line */}
                                <polyline
                                    fill="none"
                                    stroke="url(#historyLineGradient)"
                                    strokeWidth="2.5"
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    points={historyLine}
                                />
                                {/* Points */}
                                {historyLine.split(' ').map((point, idx) => {
                                    const [x, y] = point.split(',')
                                    const isLast = idx === historyLine.split(' ').length - 1
                                    return (
                                        <g key={`hist-${point}`}>
                                            {isLast && <circle cx={x} cy={y} r="8" fill="rgba(73,197,182,0.2)" />}
                                            <circle
                                                cx={x}
                                                cy={y}
                                                r={isLast ? "4" : "2.5"}
                                                fill={isLast ? "rgb(73, 197, 182)" : "rgb(39, 121, 167)"}
                                            />
                                        </g>
                                    )
                                })}
                            </svg>
                        </div>
                        <div className="mt-3 flex items-center justify-between text-xs text-fg-secondary pl-9">
                            {historySeries.map((item, idx) => (
                                <span key={item.label} className={idx === historySeries.length - 1 ? 'titulo-grafico font-semibold' : ''}>
                                    {item.label}
                                </span>
                            ))}
                        </div>
                    </>
                ) : (
                    <p className="text-sm text-fg-secondary">Nenhuma movimentaÃ§Ã£o registrada.</p>
                )}
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\PointsPerCardChart.tsx'>
import type { FC } from 'react'
import SensitiveValue from '../../ui/SensitiveValue'
import { toNumber } from '../../../pages/Dashboard/utils'
import type { RelatorioResponseDTO } from '../../../interfaces/relatorio'

interface PointsPerCardChartProps {
    pontosPorCartao: NonNullable<RelatorioResponseDTO['pontosPorCartao']>
}

export const PointsPerCardChart: FC<PointsPerCardChartProps> = ({ pontosPorCartao }) => {
    const ChartBarIcon = (
        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
        </svg>
    )

    const maxCardPoints = Math.max(
        1,
        ...pontosPorCartao.map((item) => toNumber(item.totalPontos))
    )

    // Format point values for Y-axis labels
    const formatYLabel = (value: number) => {
        if (value >= 1000) return `${(value / 1000).toFixed(1).replace(/\.0$/, '')}k`
        return value.toString()
    }

    // Usa layout de barras verticais para 6 ou menos cartÃµes, horizontal para mais
    const useVerticalBars = pontosPorCartao.length <= 6 && pontosPorCartao.length > 0

    return (
        <div className="dashboard-card h-full">
            {/* CabeÃ§alho da SeÃ§Ã£o */}
            <div className="section-header">
                <div className="card-icon">
                    {ChartBarIcon}
                </div>
                <div className="flex-1">
                    <h2 className="section-title">Pontos por cartÃ£o</h2>
                </div>
                <span className="badge">Comparativo</span>
            </div>

            {/* ConteÃºdo do GrÃ¡fico */}
            {useVerticalBars ? (
                /* Layout de Barras Verticais */
                <div className="mt-4 flex-1 flex flex-col justify-end">
                    <div className="flex gap-3">
                        {/* RÃ³tulos do eixo Y */}
                        <div className="flex flex-col justify-between text-xs h-[16rem] py-1 text-right min-w-[3rem]">
                            <span className="titulo-grafico font-semibold"><SensitiveValue>{formatYLabel(maxCardPoints)}</SensitiveValue></span>
                            <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxCardPoints * 0.75))}</SensitiveValue></span>
                            <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxCardPoints * 0.5))}</SensitiveValue></span>
                            <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxCardPoints * 0.25))}</SensitiveValue></span>
                            <span className="text-fg-secondary">0</span>
                        </div>
                        {/* Container das barras */}
                        <div className="flex-1 flex items-end justify-around gap-3" style={{ height: '16rem' }}>
                            {pontosPorCartao.map((item) => {
                                const value = toNumber(item.totalPontos)
                                const percent = Math.round((value / maxCardPoints) * 100)
                                const barHeight = (percent / 100) * 16
                                return (
                                    <div key={item.cartaoId} className="flex flex-col items-center group flex-1 h-full justify-end">
                                        {/* Valor ao passar mouse */}
                                        <span className="titulo-grafico text-sm font-bold mb-2 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                            <SensitiveValue>{value.toLocaleString('pt-BR')}</SensitiveValue>
                                        </span>
                                        {/* Barra Vertical */}
                                        <div
                                            className="w-full max-w-[3.5rem] rounded-t-lg bg-gradient-to-t from-accent-sky to-accent-pool relative overflow-hidden transition-all duration-500 group-hover:shadow-lg group-hover:shadow-accent-pool/30"
                                            style={{ height: `${barHeight}rem`, minHeight: percent > 0 ? '0.5rem' : '0' }}
                                        >
                                            <div className="absolute inset-0 bg-gradient-to-t from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                    {/* RÃ³tulos do eixo X */}
                    <div className="flex gap-3 mt-3 pt-3 border-t border-white/5">
                        <div className="min-w-[3rem]" /> {/* Spacer for Y-axis */}
                        <div className="flex-1 flex justify-around gap-3">
                            {pontosPorCartao.map((item) => (
                                <span key={item.cartaoId} className="text-xs text-fg-secondary text-center flex-1 leading-tight">
                                    {item.nomeCartao}
                                </span>
                            ))}
                        </div>
                    </div>
                </div>
            ) : (
                /* Layout de Barras Horizontais (original) */
                <div className="mt-4 space-y-4 flex-1">
                    {pontosPorCartao.length ? (
                        pontosPorCartao.map((item, idx) => {
                            const value = toNumber(item.totalPontos)
                            const percent = Math.round((value / maxCardPoints) * 100)
                            return (
                                <div key={item.cartaoId} className="group" style={{ animationDelay: `${idx * 100}ms` }}>
                                    <div className="flex items-center justify-between text-sm mb-2">
                                        <span className="text-fg-secondary group-hover:text-fg-primary transition-colors">{item.nomeCartao}</span>
                                        <span className="titulo-grafico font-bold"><SensitiveValue>{value.toLocaleString('pt-BR')}</SensitiveValue></span>
                                    </div>
                                    <div className="progress-bar">
                                        <div
                                            className="progress-bar-fill"
                                            style={{ width: `${percent}%`, animationDelay: `${idx * 150}ms` }}
                                        />
                                    </div>
                                </div>
                            )
                        })
                    ) : (
                        <p className="text-sm text-fg-secondary">Sem dados de pontos por cartÃ£o.</p>
                    )}
                </div>
            )}
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\PointsPerMonthChart.tsx'>
import type { FC } from 'react'
import SensitiveValue from '../../ui/SensitiveValue'
import { buildLinePoints, chartHeight, chartWidth } from '../../../pages/Dashboard/utils'

interface PointsPerMonthChartProps {
    monthlyPoints: { label: string; value: number; date: Date }[]
}

export const PointsPerMonthChart: FC<PointsPerMonthChartProps> = ({ monthlyPoints }) => {
    const TrendingUpIcon = (
        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
        </svg>
    )

    const monthlyValues = monthlyPoints.map((item) => item.value)
    const maxMonthly = Math.max(...monthlyValues, 1)
    const linePoints = buildLinePoints(monthlyValues)

    // Format point values for Y-axis labels
    const formatYLabel = (value: number) => {
        if (value >= 1000) return `${(value / 1000).toFixed(1).replace(/\.0$/, '')}k`
        return value.toString()
    }

    return (
        <div className="dashboard-card">
            {/* Section Header */}
            <div className="section-header">
                <div className="card-icon">
                    {TrendingUpIcon}
                </div>
                <div className="flex-1">
                    <h2 className="section-title">Pontos por mÃªs</h2>
                </div>
                <span className="badge">Ãšltimos 7 meses</span>
            </div>
            {/* Chart Container */}
            <div className="chart-container mt-4">
                {monthlyPoints.length ? (
                    <>
                        <div className="flex gap-2">
                            {/* Y-axis labels - 5 values */}
                            <div className="flex flex-col justify-between text-[0.625rem] h-28 py-1 pr-1 text-right min-w-[2rem]">
                                <span className="titulo-grafico font-semibold"><SensitiveValue>{formatYLabel(maxMonthly)}</SensitiveValue></span>
                                <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxMonthly * 0.75))}</SensitiveValue></span>
                                <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxMonthly * 0.5))}</SensitiveValue></span>
                                <span className="text-fg-secondary"><SensitiveValue>{formatYLabel(Math.round(maxMonthly * 0.25))}</SensitiveValue></span>
                                <span className="text-fg-secondary">0</span>
                            </div>
                            {/* Chart SVG */}
                            <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="h-28 flex-1" aria-hidden="true">
                                {/* Grid lines - 4 lines for 5 sections */}
                                <line x1="0" y1={chartHeight * 0.2} x2={chartWidth} y2={chartHeight * 0.2} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                <line x1="0" y1={chartHeight * 0.4} x2={chartWidth} y2={chartHeight * 0.4} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                <line x1="0" y1={chartHeight * 0.6} x2={chartWidth} y2={chartHeight * 0.6} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                <line x1="0" y1={chartHeight * 0.8} x2={chartWidth} y2={chartHeight * 0.8} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                                {/* DefiniÃ§Ã£o de gradiente */}
                                <defs>
                                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stopColor="rgb(39, 121, 167)" />
                                        <stop offset="100%" stopColor="rgb(73, 197, 182)" />
                                    </linearGradient>
                                    <filter id="glow">
                                        <feGaussianBlur stdDeviation="2" result="coloredBlur" />
                                        <feMerge>
                                            <feMergeNode in="coloredBlur" />
                                            <feMergeNode in="SourceGraphic" />
                                        </feMerge>
                                    </filter>
                                </defs>
                                {/* Line */}
                                <polyline
                                    fill="none"
                                    stroke="url(#lineGradient)"
                                    strokeWidth="3"
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    points={linePoints}
                                    filter="url(#glow)"
                                />
                                {/* Points */}
                                {linePoints.split(' ').map((point, idx) => {
                                    const [x, y] = point.split(',')
                                    const isLast = idx === linePoints.split(' ').length - 1
                                    return (
                                        <g key={point}>
                                            {isLast && <circle cx={x} cy={y} r="8" fill="rgba(73,197,182,0.2)" />}
                                            <circle
                                                cx={x}
                                                cy={y}
                                                r={isLast ? "5" : "3"}
                                                fill={isLast ? "rgb(73, 197, 182)" : "rgb(39, 121, 167)"}
                                            />
                                        </g>
                                    )
                                })}
                            </svg>
                        </div>
                        <div className="mt-3 flex items-center justify-between text-xs text-fg-secondary pl-9">
                            {monthlyPoints.map((item, idx) => (
                                <span key={item.label} className={idx === monthlyPoints.length - 1 ? 'titulo-grafico font-semibold' : ''}>
                                    {item.label}
                                </span>
                            ))}
                        </div>
                    </>
                ) : (
                    <p className="text-sm text-fg-secondary">Sem dados mensais disponÃ­veis.</p>
                )}
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\dashboard\PointsPerProgramChart.tsx'>
import type { FC } from 'react'

interface PointsPerProgramChartProps {
    programSummary: { label: string; value: number }[]
}

export const PointsPerProgramChart: FC<PointsPerProgramChartProps> = ({ programSummary }) => {
    const PieChartIcon = (
        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" />
        </svg>
    )

    const programTotal = Math.max(1, programSummary.reduce((acc, item) => acc + item.value, 0))

    return (
        <div className="dashboard-card">
            {/* Section Header */}
            <div className="section-header">
                <div className="card-icon">
                    {PieChartIcon}
                </div>
                <div className="flex-1">
                    <h2 className="section-title">Pontos por programa</h2>
                </div>
                <span className="badge">DistribuiÃ§Ã£o</span>
            </div>
            {/* Barras de Progresso */}
            <div className="mt-4 space-y-4">
                {programSummary.length ? (
                    programSummary.map((item, idx) => {
                        const percent = Math.round((item.value / programTotal) * 100)
                        return (
                            <div key={item.label} className="group" style={{ animationDelay: `${idx * 100}ms` }}>
                                <div className="flex items-center justify-between text-sm mb-2">
                                    <span className="text-fg-secondary group-hover:text-fg-primary transition-colors">{item.label}</span>
                                    <span className="titulo-grafico font-bold">{percent}%</span>
                                </div>
                                <div className="progress-bar">
                                    <div
                                        className="progress-bar-fill"
                                        style={{
                                            width: `${percent}%`,
                                            animationDelay: `${idx * 150}ms`,
                                            background: 'linear-gradient(90deg, rgb(39, 121, 167), rgb(73, 197, 182))'
                                        }}
                                    />
                                </div>
                            </div>
                        )
                    })
                ) : (
                    <p className="text-sm text-fg-secondary">Sem dados por programa.</p>
                )}
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\movimentacoes\MovimentacoesHeader.tsx'>
import React, { memo } from 'react'
import SensitiveValue from '../../ui/SensitiveValue'
import { formatCurrency, formatPoints } from '../../../utils/format'

interface MovimentacoesHeaderProps {
    totalValor: number
    saldoGlobal: number
}

const MovimentacoesHeader: React.FC<MovimentacoesHeaderProps> = ({ totalValor, saldoGlobal }) => {
    return (
        <header className="flex flex-wrap items-center justify-between gap-4">
            <div>
                <h1 className="titulo-grafico text-2xl font-bold">MovimentaÃ§Ãµes</h1>
                <p className="mt-1 text-sm text-fg-secondary">
                    HistÃ³rico completo de pontos e compras registradas.
                </p>
            </div>
            <div className="flex items-center gap-4">
                <div className="text-right">
                    <p className="text-xs text-fg-secondary">Total movimentado</p>
                    <p className="text-lg font-bold text-fg-primary"><SensitiveValue>{formatCurrency(totalValor)}</SensitiveValue></p>
                </div>
                <div className="text-right">
                    <p className="text-xs text-fg-secondary">Saldo Global</p>
                    <p className="text-lg font-bold text-accent-pool"><SensitiveValue>{formatPoints(saldoGlobal)}</SensitiveValue></p>
                </div>
            </div>
        </header>
    )
}

export default memo(MovimentacoesHeader)

  </file>
  <file name='src\components\dashboard\movimentacoes\MovimentacoesList.tsx'>
import React, { memo } from 'react'
import { formatDate, formatCurrency, formatPoints } from '../../../utils/format'
import SensitiveValue from '../../ui/SensitiveValue'
import StatusBadge, { getStatusString, STATUS_CONFIG } from '../../ui/StatusBadge'
import { type Movimentacao, type Cartao, getId, getComprovanteUrl } from '../../../hooks/useMovimentacoes'
import type { ProgramaResponseDTO } from '../../../interfaces/programaFidelidade'

interface MovimentacoesListProps {
    movimentacoes: Movimentacao[]
    editingId: number | null
    form: { cartaoId: string; programaId: string; valor: string }
    setForm: React.Dispatch<React.SetStateAction<{ cartaoId: string; programaId: string; valor: string }>>
    cards: Cartao[]
    programas: ProgramaResponseDTO[]
    cardMap: Map<number, string>
    programMap: Map<number, string>
    startEdit: (item: Movimentacao) => void
    cancelEdit: () => void
    handleSave: () => void
    handleDelete: (item: Movimentacao) => void
}

const MovimentacoesList: React.FC<MovimentacoesListProps> = ({
    movimentacoes,
    editingId,
    form,
    setForm,
    cards,
    programas,
    cardMap,
    programMap,
    startEdit,
    cancelEdit,
    handleSave,
    handleDelete
}) => {
    return (
        <div className="lg:hidden space-y-3">
            {movimentacoes.map((item) => {
                const id = getId(item)
                const isEditing = editingId === id
                const comprovanteUrl = getComprovanteUrl(item)
                const cartaoNome = item.cartaoNome ?? item.cartao?.nome ?? (item.cartaoId ? cardMap.get(item.cartaoId) : '-')
                const programaNome = item.programaNome ?? item.saldo?.programa?.nome ?? (item.programaId ? programMap.get(item.programaId) : '-')
                const statusKey = getStatusString(item.status)
                const statusConfig = STATUS_CONFIG[statusKey] ?? STATUS_CONFIG.PENDENTE

                return (
                    <div key={id} className={`rounded-xl border p-4 ${statusConfig.bg} ${statusConfig.border}`}>
                        <div className="flex items-start justify-between gap-3">
                            <div className="flex-1 min-w-0">
                                {isEditing ? (
                                    <div className="space-y-3">
                                        <select
                                            value={form.cartaoId}
                                            onChange={(e) => setForm((prev) => ({ ...prev, cartaoId: e.target.value }))}
                                            className="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-fg-primary focus:border-accent-pool focus:outline-none"
                                        >
                                            <option value="">Selecione cartÃ£o</option>
                                            {cards.map((card) => (
                                                <option key={card.id} value={card.id}>{card.nome}</option>
                                            ))}
                                        </select>
                                        <select
                                            value={form.programaId}
                                            onChange={(e) => setForm((prev) => ({ ...prev, programaId: e.target.value }))}
                                            className="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-fg-primary focus:border-accent-pool focus:outline-none"
                                        >
                                            <option value="">Selecione programa</option>
                                            {programas.map((p) => (
                                                <option key={p.id} value={p.id}>{p.nome}</option>
                                            ))}
                                        </select>
                                        <input
                                            type="number"
                                            placeholder="Valor"
                                            value={form.valor}
                                            onChange={(e) => setForm((prev) => ({ ...prev, valor: e.target.value }))}
                                            className="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-fg-primary focus:border-accent-pool focus:outline-none"
                                        />
                                        <div className="flex gap-2">
                                            <button onClick={handleSave} className="btn-primary text-xs flex-1">Salvar</button>
                                            <button onClick={cancelEdit} className="btn-secondary text-xs flex-1">Cancelar</button>
                                        </div>
                                    </div>
                                ) : (
                                    <>
                                        <div className="flex items-center gap-2 mb-2">
                                            <StatusBadge status={item.status} pontosCalculados={item.pontosCalculados} />
                                            <span className="text-xs text-fg-secondary">{formatDate(item.dataOcorrencia ?? item.data)}</span>
                                        </div>
                                        <p className="font-semibold text-fg-primary truncate">{cartaoNome}</p>
                                        <p className="text-xs text-fg-secondary">{programaNome}</p>
                                        <div className="flex items-baseline gap-4 mt-2">
                                            <div>
                                                <p className="text-xs text-fg-secondary">Valor</p>
                                                <p className="font-medium text-fg-primary"><SensitiveValue>{formatCurrency(item.valor)}</SensitiveValue></p>
                                            </div>
                                            <div>
                                                <p className="text-xs text-fg-secondary">Pontos</p>
                                                <p className={`font-semibold ${(item.pontosCalculados ?? 0) < 0 ? 'text-red-400' : 'text-accent-pool'}`}><SensitiveValue>{formatPoints(item.pontosCalculados)}</SensitiveValue></p>
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                            {!isEditing && (
                                <div className="flex flex-col gap-1">
                                    {comprovanteUrl && (
                                        <a
                                            href={comprovanteUrl}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="p-2 rounded-lg text-accent-pool hover:bg-accent-pool/10 transition-colors"
                                            title="Ver comprovante"
                                        >
                                            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13" />
                                            </svg>
                                        </a>
                                    )}
                                    <button
                                        type="button"
                                        onClick={() => startEdit(item)}
                                        className="p-2 rounded-lg text-fg-secondary hover:text-accent-pool hover:bg-accent-pool/10 transition-colors"
                                    >
                                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z" />
                                        </svg>
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => handleDelete(item)}
                                        className="p-2 rounded-lg text-fg-secondary hover:text-red-400 hover:bg-red-500/10 transition-colors"
                                    >
                                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                        </svg>
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                )
            })}
        </div>
    )
}

export default memo(MovimentacoesList)

  </file>
  <file name='src\components\dashboard\movimentacoes\MovimentacoesStats.tsx'>
import React, { memo } from 'react'
import { STATUS_CONFIG } from '../../ui/StatusBadge'

interface MovimentacoesStatsProps {
    counts: Record<string, number>
}

const MovimentacoesStats: React.FC<MovimentacoesStatsProps> = ({ counts }) => {
    return (
        <div className="grid grid-cols-2 gap-4 sm:grid-cols-4">
            {(['PENDENTE', 'CREDITADO', 'EXPIRADO', 'CANCELADO'] as const).map((status) => {
                const count = counts[status] ?? 0
                const config = STATUS_CONFIG[status]
                return (
                    <div key={status} className={`dashboard-card !min-h-0 p-4 ${config.bg} border ${config.border}`}>
                        <p className={`text-xs font-medium ${config.text}`}>{config.label}</p>
                        <p className="text-2xl font-bold text-fg-primary">{count}</p>
                    </div>
                )
            })}
        </div>
    )
}

export default memo(MovimentacoesStats)

  </file>
  <file name='src\components\dashboard\movimentacoes\MovimentacoesTable.tsx'>
import React, { memo } from 'react'
import { formatDate, formatCurrency, formatPoints } from '../../../utils/format'
import SensitiveValue from '../../ui/SensitiveValue'
import StatusBadge from '../../ui/StatusBadge'
import { type Movimentacao, type Cartao, getId, getComprovanteUrl, getStatusMotivo } from '../../../hooks/useMovimentacoes'
import type { ProgramaResponseDTO } from '../../../interfaces/programaFidelidade'

interface MovimentacoesTableProps {
    movimentacoes: Movimentacao[]
    editingId: number | null
    form: { cartaoId: string; programaId: string; valor: string }
    setForm: React.Dispatch<React.SetStateAction<{ cartaoId: string; programaId: string; valor: string }>>
    cards: Cartao[]
    programas: ProgramaResponseDTO[]
    cardMap: Map<number, string>
    programMap: Map<number, string>
    startEdit: (item: Movimentacao) => void
    cancelEdit: () => void
    handleSave: () => void
    handleDelete: (item: Movimentacao) => void
}

const MovimentacoesTable: React.FC<MovimentacoesTableProps> = ({
    movimentacoes,
    editingId,
    form,
    setForm,
    cards,
    programas,
    cardMap,
    programMap,
    startEdit,
    cancelEdit,
    handleSave,
    handleDelete
}) => {
    return (
        <div className="hidden lg:block overflow-x-auto">
            <table className="w-full text-sm">
                <thead>
                    <tr className="border-b border-white/10 text-xs uppercase tracking-wider text-fg-secondary">
                        <th className="px-4 py-3 text-left font-medium">Data</th>
                        <th className="px-4 py-3 text-left font-medium">CartÃ£o</th>
                        <th className="px-4 py-3 text-left font-medium">Programa</th>
                        <th className="px-4 py-3 text-right font-medium">Valor (R$)</th>
                        <th className="px-4 py-3 text-right font-medium">Pontos</th>
                        <th className="px-4 py-3 text-center font-medium">Status</th>
                        <th className="px-4 py-3 text-center font-medium">Comprov.</th>
                        <th className="px-4 py-3 text-right font-medium">AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody className="divide-y divide-white/5">
                    {movimentacoes.map((item) => {
                        const id = getId(item)
                        const isEditing = editingId === id
                        const comprovanteUrl = getComprovanteUrl(item)
                        const cartaoNome = item.cartaoNome ?? item.cartao?.nome ?? (item.cartaoId ? cardMap.get(item.cartaoId) : '-')
                        const programaNome = item.programaNome ?? item.saldo?.programa?.nome ?? (item.programaId ? programMap.get(item.programaId) : '-')
                        const statusMotivo = getStatusMotivo(item)
                        const comprovantesCount = item.comprovantes?.length ?? (item.comprovante?.id ? 1 : 0)

                        return (
                            <tr key={id} className="hover:bg-white/[0.02] transition-colors">
                                <td className="px-4 py-3 text-fg-secondary">
                                    {formatDate(item.dataOcorrencia ?? item.data)}
                                </td>
                                <td className="px-4 py-3">
                                    {isEditing ? (
                                        <select
                                            value={form.cartaoId}
                                            onChange={(e) => setForm((prev) => ({ ...prev, cartaoId: e.target.value }))}
                                            className="w-full rounded-lg border border-white/10 bg-white/5 px-2 py-1.5 text-xs text-fg-primary focus:border-accent-pool focus:outline-none"
                                        >
                                            <option value="">Selecione</option>
                                            {cards.map((card) => (
                                                <option key={card.id} value={card.id}>
                                                    {card.nome ?? `CartÃ£o ${card.id}`}
                                                </option>
                                            ))}
                                        </select>
                                    ) : (
                                        <span className="text-fg-primary">{cartaoNome}</span>
                                    )}
                                </td>
                                <td className="px-4 py-3">
                                    {isEditing ? (
                                        <select
                                            value={form.programaId}
                                            onChange={(e) => setForm((prev) => ({ ...prev, programaId: e.target.value }))}
                                            className="w-full rounded-lg border border-white/10 bg-white/5 px-2 py-1.5 text-xs text-fg-primary focus:border-accent-pool focus:outline-none"
                                        >
                                            <option value="">Selecione</option>
                                            {programas.map((programa) => (
                                                <option key={programa.id} value={programa.id}>
                                                    {programa.nome}
                                                </option>
                                            ))}
                                        </select>
                                    ) : (
                                        <span className="text-fg-primary">{programaNome}</span>
                                    )}
                                </td>
                                <td className="px-4 py-3 text-right">
                                    {isEditing ? (
                                        <input
                                            type="number"
                                            value={form.valor}
                                            onChange={(e) => setForm((prev) => ({ ...prev, valor: e.target.value }))}
                                            className="w-24 rounded-lg border border-white/10 bg-white/5 px-2 py-1.5 text-xs text-fg-primary text-right focus:border-accent-pool focus:outline-none"
                                        />
                                    ) : (
                                        <span className="text-fg-primary font-medium"><SensitiveValue>{formatCurrency(item.valor)}</SensitiveValue></span>
                                    )}
                                </td>
                                <td className="px-4 py-3 text-right">
                                    <span className={`font-semibold ${(item.pontosCalculados ?? 0) < 0 ? 'text-red-400' : 'text-accent-pool'}`}><SensitiveValue>{formatPoints(item.pontosCalculados)}</SensitiveValue></span>
                                </td>
                                <td className="px-4 py-3 text-center">
                                    <div className="inline-flex items-center" title={statusMotivo || undefined}>
                                        <StatusBadge status={item.status} pontosCalculados={item.pontosCalculados} />
                                        {statusMotivo && (
                                            <svg className="ml-1 h-3 w-3 text-fg-secondary/50" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                                            </svg>
                                        )}
                                    </div>
                                </td>
                                <td className="px-4 py-3 text-center">
                                    {comprovanteUrl ? (
                                        <a
                                            href={comprovanteUrl}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="inline-flex items-center justify-center gap-1 p-1.5 rounded-lg text-accent-pool hover:bg-accent-pool/10 transition-colors"
                                            title={comprovantesCount > 1 ? `${comprovantesCount} comprovantes` : 'Ver comprovante'}
                                        >
                                            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13" />
                                            </svg>
                                            {comprovantesCount > 1 && (
                                                <span className="text-[0.625rem] font-medium">{comprovantesCount}</span>
                                            )}
                                        </a>
                                    ) : (
                                        <span className="text-fg-secondary/40">â€”</span>
                                    )}
                                </td>
                                <td className="px-4 py-3 text-right">
                                    {isEditing ? (
                                        <div className="flex justify-end gap-2">
                                            <button
                                                type="button"
                                                onClick={handleSave}
                                                className="btn-primary text-xs !px-3 !py-1.5"
                                            >
                                                Salvar
                                            </button>
                                            <button
                                                type="button"
                                                onClick={cancelEdit}
                                                className="btn-secondary text-xs !px-3 !py-1.5"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="flex justify-end gap-1">
                                            <button
                                                type="button"
                                                onClick={() => startEdit(item)}
                                                className="p-1.5 rounded-lg text-fg-secondary hover:text-accent-pool hover:bg-accent-pool/10 transition-colors"
                                                title="Editar"
                                            >
                                                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                                </svg>
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => handleDelete(item)}
                                                className="p-1.5 rounded-lg text-fg-secondary hover:text-red-400 hover:bg-red-500/10 transition-colors"
                                                title="Excluir"
                                            >
                                                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                                </svg>
                                            </button>
                                        </div>
                                    )}
                                </td>
                            </tr>
                        )
                    })}
                </tbody>
            </table>
        </div>
    )
}

export default memo(MovimentacoesTable)

  </file>
  <file name='src\components\dashboard\programas\DeleteConfirmModal.tsx'>
import type { DeleteConfirmModalProps } from '../../../interfaces/programa'

export default function DeleteConfirmModal({
    isOpen,
    programa,
    onClose,
    onConfirm,
    loading,
}: DeleteConfirmModalProps) {
    if (!isOpen || !programa) return null

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
            <div className="w-full max-w-md rounded-2xl border border-white/10 bg-bg-secondary p-6 shadow-xl">
                <div className="flex items-center justify-between mb-4">
                    <h2 className="text-lg font-semibold text-fg-primary">Excluir Programa</h2>
                    <button
                        type="button"
                        onClick={onClose}
                        className="p-1 rounded-lg text-fg-secondary hover:text-fg-primary hover:bg-white/10 transition-colors"
                    >
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div className="mb-6">
                    <div className="flex items-center gap-3 p-3 rounded-lg bg-red-500/10 border border-red-500/20 mb-4">
                        <svg className="h-6 w-6 text-red-400 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                        <div>
                            <p className="text-sm font-medium text-red-400">AtenÃ§Ã£o!</p>
                            <p className="text-xs text-fg-secondary">Esta aÃ§Ã£o nÃ£o pode ser desfeita.</p>
                        </div>
                    </div>
                    <p className="text-sm text-fg-secondary">
                        Tem certeza que deseja excluir o programa <span className="font-semibold text-fg-primary">"{programa.nome}"</span>?
                    </p>
                    <p className="text-xs text-fg-secondary mt-2">
                        Todos os dados associados a este programa serÃ£o removidos permanentemente.
                    </p>
                </div>

                <div className="flex gap-3">
                    <button
                        type="button"
                        onClick={onClose}
                        className="btn-secondary flex-1"
                    >
                        Cancelar
                    </button>
                    <button
                        type="button"
                        onClick={() => onConfirm(programa.id)}
                        disabled={loading}
                        className="flex-1 px-4 py-2 rounded-xl bg-red-500 text-white font-medium hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                        {loading ? (
                            <>
                                <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                                Excluindo...
                            </>
                        ) : (
                            <>
                                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                </svg>
                                Excluir Programa
                            </>
                        )}
                    </button>
                </div>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\programas\index.ts'>
export { default as ProgramCard } from './ProgramCard'
export { default as ProgramFormModal } from './ProgramFormModal'
export { default as DeleteConfirmModal } from './DeleteConfirmModal'

  </file>
  <file name='src\components\dashboard\programas\ProgramCard.tsx'>
import { getBrandConfig, getProgramLogo, inferCategory, getInitials } from '../../../utils/brandHelpers'
import { formatPoints, getActivePromotions, isPromotionEndingSoon, formatDate } from '../../../utils/programaHelpers'
import CategoryBadge from '../../ui/CategoryBadge'
import SensitiveValue from '../../ui/SensitiveValue'
import type { ProgramCardProps } from '../../../interfaces/programa'

export default function ProgramCard({
    programa,
    mode,
    saldo,
    cartaoNome,
    isAdmin,
    onEdit,
    onDelete,
}: ProgramCardProps) {
    const initials = getInitials(programa.nome)
    const brandConfig = getBrandConfig(programa.nome)
    const logo = getProgramLogo(programa.nome)
    const category = inferCategory(programa.nome, programa.categoria)
    const activePromotions = getActivePromotions(programa.promocoes)
    const hasEndingSoon = activePromotions.some(isPromotionEndingSoon)

    const handleCardClick = (e: React.MouseEvent) => {
        // Previne navegaÃ§Ã£o se clicar em botÃµes ou links
        if ((e.target as HTMLElement).closest('button') || (e.target as HTMLElement).closest('a')) {
            return
        }
        if (programa.url) {
            window.open(programa.url, '_blank', 'noopener,noreferrer')
        }
    }

    return (
        <div
            onClick={handleCardClick}
            className={`dashboard-card flex flex-col h-full relative overflow-hidden group transition-all duration-300 ${programa.url ? 'cursor-pointer hover:shadow-lg hover:translate-y-[-2px] hover:border-accent-pool/30' : ''
                }`}
        >
            {/* Logo d'Ã¡gua */}
            {logo && (
                <img
                    src={logo}
                    alt=""
                    className="absolute -bottom-4 -right-4 w-32 h-32 opacity-[0.05] pointer-events-none grayscale transition-opacity duration-300 group-hover:opacity-10"
                />
            )}

            {/* AÃ§Ãµes de Admin */}
            {isAdmin && (
                <div className="absolute top-3 right-3 z-20 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                    <button
                        onClick={(e) => {
                            e.stopPropagation()
                            onEdit?.(programa)
                        }}
                        className="p-1.5 rounded-lg bg-black/50 text-white/80 hover:bg-black/70 hover:text-white backdrop-blur-sm transition-colors"
                        title="Editar"
                    >
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                    </button>
                    <button
                        onClick={(e) => {
                            e.stopPropagation()
                            onDelete?.(programa.id)
                        }}
                        className="p-1.5 rounded-lg bg-black/50 text-white/80 hover:bg-red-500/80 hover:text-white backdrop-blur-sm transition-colors"
                        title="Excluir"
                    >
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                    </button>
                </div>
            )}

            {/* Alerta de ExpiraÃ§Ã£o PrÃ³xima */}
            {hasEndingSoon && (
                <div className={`absolute top-3 ${isAdmin ? 'right-20' : 'right-3'} z-10 flex items-center gap-1 px-2 py-1 rounded-full bg-red-500/20 border border-red-500/30 transition-all`}>
                    <svg className="h-3 w-3 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                    </svg>
                    <span className="text-xs font-medium text-red-400">Expira em breve</span>
                </div>
            )}

            {/* CabeÃ§alho */}
            <div className="flex items-start gap-4 relative z-10">
                {/* Logo/Avatar de Iniciais */}
                {logo ? (
                    <div className="flex h-14 w-14 items-center justify-center rounded-xl bg-white p-2 shadow-lg shrink-0">
                        <img src={logo} alt={programa.nome} className="h-full w-full object-contain" />
                    </div>
                ) : (
                    <div className={`flex h-14 w-14 items-center justify-center rounded-xl bg-gradient-to-br ${brandConfig.gradient} text-lg font-bold text-white shrink-0 shadow-lg`}>
                        {initials}
                    </div>
                )}

                <div className="flex-1 min-w-0">
                    <h3 className="font-semibold text-fg-primary truncate">{programa.nome}</h3>
                    <div className="mt-1 flex flex-wrap items-center gap-2">
                        {category && <CategoryBadge category={category} />}
                        {programa.multiplicadorPontos !== undefined && programa.multiplicadorPontos !== null && (
                            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap ${brandConfig.bgColor} ${brandConfig.textColor}`}>
                                <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v18m9-9H3" />
                                </svg>
                                {programa.multiplicadorPontos}x
                            </span>
                        )}
                        {activePromotions.length > 0 && (
                            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap ${brandConfig.bgColor} ${brandConfig.textColor}`}>
                                <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z" />
                                </svg>
                                {activePromotions.length} promo{activePromotions.length > 1 ? 's' : ''}
                            </span>
                        )}
                    </div>
                </div>
            </div>

            {/* DescriÃ§Ã£o */}
            {programa.descricao && (!saldo || programa.descricao.length < 50) && (
                <p className="mt-3 text-sm text-fg-secondary line-clamp-2 relative z-10">{programa.descricao}</p>
            )}

            {/* Link URL */}
            {programa.url && (
                <div className={`mt-2 text-xs ${brandConfig.textColor} hover:underline truncate block relative z-10 pointer-events-none`}>
                    {programa.url} <span className="text-fg-secondary ml-1">(clique no card)</span>
                </div>
            )}

            {/* SeÃ§Ã£o de PromoÃ§Ãµes Ativas */}
            {activePromotions.length > 0 && (
                <div className="mt-4 space-y-2 relative z-10">
                    <div className="flex items-center gap-2 text-xs text-fg-secondary">
                        <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 6h.008v.008H6V6z" />
                        </svg>
                        <span className="font-medium">PromoÃ§Ãµes Ativas</span>
                    </div>
                    <div className="space-y-1.5">
                        {activePromotions.map((promo) => (
                            <div
                                key={promo.id}
                                className={`flex items-center justify-between p-2 rounded-lg ${brandConfig.bgColor} ${isPromotionEndingSoon(promo) ? 'ring-1 ring-red-500/30' : ''}`}
                            >
                                <div className="min-w-0 flex-1">
                                    <p className="text-xs font-medium text-fg-primary truncate">{promo.titulo}</p>
                                    <p className="text-xs text-fg-secondary">
                                        atÃ© {formatDate(promo.dataFim)}
                                        {isPromotionEndingSoon(promo) && (
                                            <span className="ml-1 text-red-400">âš </span>
                                        )}
                                    </p>
                                </div>
                                <div className={`ml-2 px-2 py-0.5 rounded-full text-xs font-bold ${brandConfig.textColor} bg-white/10`}>
                                    {promo.pontosPorReal}x
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* EspaÃ§ador */}
            <div className="flex-1" />

            {/* SeÃ§Ã£o de Saldo */}
            {saldo !== undefined && (
                <div className={`mt-4 pt-4 border-t border-white/10 ${mode === 'all' ? 'opacity-80' : ''} relative z-10`}>
                    <div className="flex items-end justify-between">
                        <div>
                            <p className="text-xs text-fg-secondary">Seu saldo</p>
                            <p className={`${mode === 'mine' ? 'text-2xl' : 'text-lg'} font-bold ${brandConfig.textColor}`}>
                                <SensitiveValue>{formatPoints(saldo)}</SensitiveValue> <span className="text-sm font-normal text-fg-secondary">pts</span>
                            </p>
                        </div>
                    </div>

                    {/* CartÃ£o Associado - Apenas no modo meu */}
                    {mode === 'mine' && cartaoNome && (
                        <div className="mt-3 flex items-center gap-2 text-xs text-fg-secondary">
                            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                            </svg>
                            <span>Associado via: <span className="text-fg-primary font-medium">{cartaoNome}</span></span>
                        </div>
                    )}
                </div>
            )}
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\programas\ProgramFormModal.tsx'>
import { useEffect, useState } from 'react'
import { notify } from '../../../utils/notify'
import type { CategoriaPrograma, ProgramFormModalProps } from '../../../interfaces/programa'

export default function ProgramFormModal({
    isOpen,
    mode,
    programa,
    onClose,
    onSubmit,
    loading,
}: ProgramFormModalProps) {
    const [form, setForm] = useState({
        nome: '',
        descricao: '',
        categoria: 'OUTRO' as CategoriaPrograma,
        multiplicadorPontos: '',
    })

    // Sincroniza formulÃ¡rio com programa quando em modo de ediÃ§Ã£o
    useEffect(() => {
        if (mode === 'edit' && programa) {
            setForm(prev => {
                if (prev.nome === (programa.nome || '') && prev.descricao === (programa.descricao || '')) {
                    return prev
                }
                return {
                    nome: programa.nome || '',
                    descricao: programa.descricao || '',
                    categoria: (programa.categoria || 'OUTRO') as CategoriaPrograma,
                    multiplicadorPontos: programa.multiplicadorPontos !== undefined && programa.multiplicadorPontos !== null
                        ? String(programa.multiplicadorPontos)
                        : '',
                }
            })
        } else if (mode === 'create') {
            setForm(prev => {
                if (prev.nome === '' && prev.descricao === '' && prev.categoria === 'OUTRO' && prev.multiplicadorPontos === '') return prev
                return { nome: '', descricao: '', categoria: 'OUTRO', multiplicadorPontos: '' }
            })
        }
    }, [mode, programa])

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault()

        if (!form.nome.trim()) {
            notify.error('Informe o nome do programa.')
            return
        }

        if (!form.descricao.trim()) {
            notify.error('Informe a descriÃ§Ã£o do programa.')
            return
        }

        if (form.nome.length > 100) {
            notify.error('O nome deve ter no mÃ¡ximo 100 caracteres.')
            return
        }

        if (form.descricao.length > 500) {
            notify.error('A descriÃ§Ã£o deve ter no mÃ¡ximo 500 caracteres.')
            return
        }

        const multiplicadorValue = form.multiplicadorPontos.trim()
            ? Number(form.multiplicadorPontos.replace(',', '.'))
            : undefined

        if (multiplicadorValue !== undefined && (Number.isNaN(multiplicadorValue) || multiplicadorValue <= 0)) {
            notify.error('Informe um multiplicador vÃ¡lido (maior que 0).')
            return
        }

        const categoriaValue = (form.categoria || 'OUTRO') as CategoriaPrograma

        await onSubmit({
            nome: form.nome,
            descricao: form.descricao,
            categoria: categoriaValue,
            multiplicadorPontos: multiplicadorValue,
        })

        // Reseta o formulÃ¡rio apenas apÃ³s sucesso na criaÃ§Ã£o
        if (mode === 'create') {
            setForm({ nome: '', descricao: '', categoria: 'OUTRO', multiplicadorPontos: '' })
        }
    }

    if (!isOpen) return null
    if (mode === 'edit' && !programa) return null

    const isEditMode = mode === 'edit'
    const title = isEditMode ? 'Editar Programa' : 'Novo Programa de Fidelidade'
    const submitText = isEditMode ? 'Salvar AlteraÃ§Ãµes' : 'Criar Programa'
    const loadingText = isEditMode ? 'Salvando...' : 'Criando...'
    const inputIdPrefix = isEditMode ? 'edit-' : ''

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
            <div className="w-full max-w-md rounded-2xl border border-white/10 bg-bg-secondary p-6 shadow-xl">
                <div className="flex items-center justify-between mb-6">
                    <h2 className="text-lg font-semibold text-fg-primary">{title}</h2>
                    <button
                        type="button"
                        onClick={onClose}
                        className="p-1 rounded-lg text-fg-secondary hover:text-fg-primary hover:bg-white/10 transition-colors"
                    >
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <label htmlFor={`${inputIdPrefix}nome`} className="block text-sm font-medium text-fg-primary">
                                Nome do Programa *
                            </label>
                            <span className={`text-xs ${form.nome.length > 100 ? 'text-red-400' : 'text-fg-secondary'}`}>
                                {form.nome.length}/100
                            </span>
                        </div>
                        <input
                            id={`${inputIdPrefix}nome`}
                            type="text"
                            value={form.nome}
                            maxLength={100}
                            onChange={(e) => setForm((prev) => ({ ...prev, nome: e.target.value }))}
                            placeholder="Ex: Smiles, Livelo, Esfera"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20"
                        />
                    </div>

                    <div className="space-y-2">
                        <label htmlFor={`${inputIdPrefix}categoria`} className="block text-sm font-medium text-fg-primary">
                            Categoria *
                        </label>
                        <select
                            id={`${inputIdPrefix}categoria`}
                            value={form.categoria}
                            onChange={(e) => setForm((prev) => ({ ...prev, categoria: e.target.value as CategoriaPrograma }))}
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20"
                        >
                            <option value="AEREA" className="bg-bg-secondary">AÃ©rea</option>
                            <option value="BANCO" className="bg-bg-secondary">Banco</option>
                            <option value="VAREJO" className="bg-bg-secondary">Varejo</option>
                            <option value="FINANCEIRO" className="bg-bg-secondary">Financeiro</option>
                            <option value="OUTRO" className="bg-bg-secondary">Outro</option>
                        </select>
                    </div>

                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <label htmlFor={`${inputIdPrefix}descricao`} className="block text-sm font-medium text-fg-primary">
                                DescriÃ§Ã£o *
                            </label>
                            <span className={`text-xs ${form.descricao.length > 500 ? 'text-red-400' : 'text-fg-secondary'}`}>
                                {form.descricao.length}/500
                            </span>
                        </div>
                        <textarea
                            id={`${inputIdPrefix}descricao`}
                            value={form.descricao}
                            maxLength={500}
                            rows={3}
                            onChange={(e) => setForm((prev) => ({ ...prev, descricao: e.target.value }))}
                            placeholder="DescriÃ§Ã£o do programa de fidelidade"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20 resize-none"
                        />
                    </div>

                    <div className="space-y-2">
                        <label htmlFor={`${inputIdPrefix}multiplicador`} className="block text-sm font-medium text-fg-primary">
                            Multiplicador de Pontos
                        </label>
                        <input
                            id={`${inputIdPrefix}multiplicador`}
                            type="text"
                            inputMode="decimal"
                            value={form.multiplicadorPontos}
                            onChange={(e) => setForm((prev) => ({ ...prev, multiplicadorPontos: e.target.value }))}
                            placeholder="Ex: 1.5"
                            className="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-fg-primary placeholder:text-fg-secondary/60 focus:border-accent-pool focus:outline-none focus:ring-2 focus:ring-accent-pool/20"
                        />
                    </div>

                    <div className="flex gap-3 pt-2">
                        <button
                            type="button"
                            onClick={onClose}
                            className="btn-secondary flex-1"
                        >
                            Cancelar
                        </button>
                        <button
                            type="submit"
                            disabled={loading}
                            className="btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            {loading ? (
                                <>
                                    <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                                    {loadingText}
                                </>
                            ) : (
                                submitText
                            )}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\relatorios\RelatorioCharts.tsx'>
import { usePreferences } from '../../../hooks/usePreferences'
import type { EvolucaoMensalDTO, PontosPorCartaoDTO } from '../../../interfaces/relatorio'

// Month names in Portuguese
const MONTH_NAMES = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez']

// Colors for charts - Vibrant and distinct palette
const CHART_COLORS = [
    '#3B82F6', // blue
    '#8B5CF6', // violet/purple
    '#10B981', // emerald
    '#F97316', // orange
    '#EC4899', // pink
    '#06B6D4', // cyan
    '#6366F1', // indigo
    '#14B8A6', // teal
    '#F59E0B', // amber
]

function formatPoints(value: number): string {
    return new Intl.NumberFormat('pt-BR').format(value)
}

// Line Chart Component (SVG)
export function LineChart({ data }: { data: EvolucaoMensalDTO[] }) {
    const { preferences } = usePreferences()
    const hideValues = preferences.hideValues

    if (!data || data.length === 0) {
        return (
            <div className="flex items-center justify-center h-64 text-fg-secondary">
                <p className="text-sm">Sem dados de evoluÃ§Ã£o disponÃ­veis</p>
            </div>
        )
    }

    const sortedData = [...data].sort((a, b) => {
        if (a.ano !== b.ano) return a.ano - b.ano
        return a.mes - b.mes
    })

    const maxValue = Math.max(...sortedData.map((d) => d.totalPontos))
    const minValue = Math.min(...sortedData.map((d) => d.totalPontos))
    const range = maxValue - minValue || 1

    // Increased dimensions with left padding for Y-axis labels
    const width = 110
    const height = 60
    const paddingLeft = 15
    const paddingRight = 5
    const paddingTop = 5
    const paddingBottom = 5

    const chartWidth = width - paddingLeft - paddingRight
    const chartHeight = height - paddingTop - paddingBottom

    const points = sortedData.map((d, i) => {
        const x = paddingLeft + (i / (sortedData.length - 1 || 1)) * chartWidth
        const y = paddingTop + (1 - (d.totalPontos - minValue) / range) * chartHeight
        return { x, y, data: d }
    })

    const pathD = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ')
    const areaD = `${pathD} L ${points[points.length - 1].x} ${paddingTop + chartHeight} L ${points[0].x} ${paddingTop + chartHeight} Z`

    // Y-axis values (percentages of range)
    const yAxisValues = [0, 0.25, 0.5, 0.75, 1].map((ratio) => ({
        ratio,
        value: Math.round(maxValue - ratio * range),
        y: paddingTop + ratio * chartHeight,
    }))

    return (
        <div className="relative">
            <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-64" preserveAspectRatio="none">
                {/* Y-axis labels */}
                {yAxisValues.map((item) => (
                    <text
                        key={item.ratio}
                        x={paddingLeft - 2}
                        y={item.y}
                        textAnchor="end"
                        dominantBaseline="middle"
                        className="fill-current text-fg-secondary"
                        style={{ fontSize: '2.5px' }}
                    >
                        {hideValues ? 'â€¢â€¢â€¢â€¢' : formatPoints(item.value)}
                    </text>
                ))}

                {/* Grid lines */}
                {yAxisValues.map((item) => (
                    <line
                        key={item.ratio}
                        x1={paddingLeft}
                        y1={item.y}
                        x2={width - paddingRight}
                        y2={item.y}
                        stroke="currentColor"
                        strokeOpacity={0.1}
                        strokeWidth={0.2}
                    />
                ))}

                {/* Gradient area */}
                <defs>
                    <linearGradient id="areaGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stopColor="#00B4D8" stopOpacity={0.3} />
                        <stop offset="100%" stopColor="#00B4D8" stopOpacity={0} />
                    </linearGradient>
                </defs>
                <path d={areaD} fill="url(#areaGradient)" />

                {/* Main line */}
                <path
                    d={pathD}
                    fill="none"
                    stroke="#00B4D8"
                    strokeWidth={0.5}
                    strokeLinecap="round"
                    strokeLinejoin="round"
                />

                {/* Data points */}
                {points.map((p, i) => (
                    <circle
                        key={i}
                        cx={p.x}
                        cy={p.y}
                        r={1}
                        fill="#00B4D8"
                        className="hover:r-2 transition-all"
                    />
                ))}
            </svg>

            {/* X-axis labels */}
            <div className="flex justify-between mt-2 text-[0.625rem] text-fg-secondary px-1" style={{ paddingLeft: '12%' }}>
                {sortedData.map((d, i) => (
                    <span key={i}>{MONTH_NAMES[d.mes - 1]}/{String(d.ano).slice(-2)}</span>
                ))}
            </div>

            {/* Legend values */}
            <div className="flex justify-between mt-1 text-xs text-fg-secondary px-1">
                <span>MÃ­n: {hideValues ? 'â€¢â€¢â€¢â€¢â€¢â€¢' : formatPoints(minValue)}</span>
                <span>MÃ¡x: {hideValues ? 'â€¢â€¢â€¢â€¢â€¢â€¢' : formatPoints(maxValue)}</span>
            </div>
        </div>
    )
}

// Donut Chart Component (SVG)
export function DonutChart({ data }: { data: PontosPorCartaoDTO[] }) {
    const { preferences } = usePreferences()
    const hideValues = preferences.hideValues

    if (!data || data.length === 0) {
        return (
            <div className="flex items-center justify-center h-64 text-fg-secondary">
                <p className="text-sm">Sem dados de cartÃµes disponÃ­veis</p>
            </div>
        )
    }

    const total = data.reduce((acc, d) => acc + d.totalPontos, 0)
    const size = 120
    const strokeWidth = 20
    const radius = (size - strokeWidth) / 2
    const circumference = 2 * Math.PI * radius
    const center = size / 2

    const segments = data.reduce<{
        items: (PontosPorCartaoDTO & { percent: number; offset: number; length: number; color: string })[],
        currentAngle: number
    }>((acc, d, i) => {
        const percent = total > 0 ? d.totalPontos / total : 0
        const segmentLength = circumference * percent
        const offset = circumference - acc.currentAngle

        acc.items.push({
            ...d,
            percent,
            offset,
            length: segmentLength,
            color: CHART_COLORS[i % CHART_COLORS.length],
        })

        acc.currentAngle += segmentLength
        return acc
    }, { items: [], currentAngle: 0 }).items

    return (
        <div className="flex flex-col items-center gap-4">
            <div className="relative">
                <svg width={size} height={size} className="transform -rotate-90">
                    {segments.map((seg, i) => (
                        <circle
                            key={i}
                            cx={center}
                            cy={center}
                            r={radius}
                            fill="none"
                            stroke={seg.color}
                            strokeWidth={strokeWidth}
                            strokeDasharray={`${seg.length} ${circumference - seg.length}`}
                            strokeDashoffset={seg.offset}
                            className="transition-all duration-500"
                        />
                    ))}
                </svg>
                <div className="absolute inset-0 flex flex-col items-center justify-center">
                    <span className="text-2xl font-bold text-fg-primary">{hideValues ? 'â€¢â€¢â€¢â€¢â€¢â€¢' : formatPoints(total)}</span>
                    <span className="text-[0.625rem] text-fg-secondary">Total</span>
                </div>
            </div>

            {/* Legend */}
            <div className="w-full space-y-2">
                {segments.map((seg, i) => (
                    <div key={i} className="flex items-center gap-2 text-xs">
                        <span
                            className="w-3 h-3 rounded-full flex-shrink-0"
                            style={{ backgroundColor: seg.color }}
                        />
                        <span className="flex-1 text-fg-secondary truncate">{seg.nomeCartao}</span>
                        <span className="font-medium text-fg-primary">{hideValues ? 'â€¢â€¢â€¢â€¢â€¢â€¢' : formatPoints(seg.totalPontos)}</span>
                        <span className="text-fg-secondary">({(seg.percent * 100).toFixed(0)}%)</span>
                    </div>
                ))}
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\relatorios\RelatorioHistory.tsx'>
import StatusBadge from '../../ui/StatusBadge'
import SensitiveValue from '../../ui/SensitiveValue'
import type { HistoricoMovimentacaoDTO } from '../../../interfaces/relatorio'

// Format date for display
function formatDate(dateStr: string): string {
    const date = new Date(dateStr)
    return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
    })
}

// Format points with thousand separators
function formatPoints(value: number): string {
    return new Intl.NumberFormat('pt-BR').format(value)
}

interface RelatorioHistoryProps {
    historico: HistoricoMovimentacaoDTO[]
}

export function RelatorioHistory({ historico }: RelatorioHistoryProps) {
    return (
        <div className="dashboard-card">
            <div className="section-header mb-6">
                <div className="card-icon">
                    <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                    </svg>
                </div>
                <div className="flex-1">
                    <h2 className="section-title">HistÃ³rico de MovimentaÃ§Ãµes</h2>
                    <p className="text-xs text-fg-secondary">Todas as transaÃ§Ãµes registradas</p>
                </div>
                <span className="badge">{historico?.length ?? 0} registros</span>
            </div>

            {historico && historico.length > 0 ? (
                <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                        <thead>
                            <tr className="border-b border-white/10">
                                <th className="text-left py-3 px-4 text-xs font-semibold text-fg-secondary uppercase tracking-wider">Data</th>
                                <th className="text-left py-3 px-4 text-xs font-semibold text-fg-secondary uppercase tracking-wider">Programa</th>
                                <th className="text-left py-3 px-4 text-xs font-semibold text-fg-secondary uppercase tracking-wider">Status</th>
                                <th className="text-right py-3 px-4 text-xs font-semibold text-fg-secondary uppercase tracking-wider">Pontos</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-white/5">
                            {historico.map((item) => {
                                const isPositive = item.pontosCalculados >= 0

                                return (
                                    <tr key={item.movimentacaoId} className="hover:bg-white/5 transition-colors">
                                        <td className="py-3 px-4 text-fg-secondary">
                                            {formatDate(item.data)}
                                        </td>
                                        <td className="py-3 px-4 text-fg-primary font-medium">
                                            {item.programa}
                                        </td>
                                        <td className="py-3 px-4">
                                            <StatusBadge status={item.status || (isPositive ? 'CREDITADO' : 'CANCELADO')} pontosCalculados={item.pontosCalculados} />
                                        </td>
                                        <td className={`py-3 px-4 text-right font-bold ${isPositive ? 'text-emerald-400' : 'text-red-400'
                                            }`}>
                                            {isPositive ? '+' : '-'}<SensitiveValue>{formatPoints(Math.abs(item.pontosCalculados))}</SensitiveValue>
                                        </td>
                                    </tr>
                                )
                            })}
                        </tbody>
                    </table>
                </div>
            ) : (
                <div className="flex flex-col items-center justify-center py-12 text-center">
                    <div className="rounded-full bg-white/5 p-6 mb-4">
                        <svg className="h-12 w-12 text-fg-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                        </svg>
                    </div>
                    <p className="text-sm text-fg-secondary">Nenhuma movimentaÃ§Ã£o registrada ainda.</p>
                </div>
            )}
        </div>
    )
}

  </file>
  <file name='src\components\dashboard\relatorios\RelatorioSummary.tsx'>
import SensitiveValue from '../../ui/SensitiveValue'

function formatPoints(value: number): string {
    return new Intl.NumberFormat('pt-BR').format(value)
}

interface Stats {
    totalPoints: number
    totalCards: number
    totalMovements: number
    mediaPorMovimentacao: number
    totalEntradas: number
    totalSaidas: number
    saldoLiquido: number
    growthRate: number
    topPrograms: {
        name: string
        points: number
        percent: number
    }[]
}

interface RelatorioSummaryProps {
    stats: Stats
}

export function RelatorioSummary({ stats }: RelatorioSummaryProps) {
    return (
        <>
            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                <div className="dashboard-card !min-h-0 !p-4">
                    <div className="flex items-center gap-3">
                        <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-accent-pool/10">
                            <svg className="h-5 w-5 text-accent-pool" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                            </svg>
                        </div>
                        <div>
                            <p className="text-xl font-bold text-fg-primary"><SensitiveValue>{formatPoints(stats.totalPoints)}</SensitiveValue></p>
                            <p className="text-xs text-fg-secondary">Total de Pontos</p>
                        </div>
                    </div>
                </div>
                <div className="dashboard-card !min-h-0 !p-4">
                    <div className="flex items-center gap-3">
                        <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-green-500/10">
                            <svg className="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                            </svg>
                        </div>
                        <div>
                            <p className="text-xl font-bold text-fg-primary">{stats.totalCards}</p>
                            <p className="text-xs text-fg-secondary">CartÃµes Ativos</p>
                        </div>
                    </div>
                </div>
                <div className="dashboard-card !min-h-0 !p-4">
                    <div className="flex items-center gap-3">
                        <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/10">
                            <svg className="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
                            </svg>
                        </div>
                        <div>
                            <p className="text-xl font-bold text-fg-primary">{stats.totalMovements}</p>
                            <p className="text-xs text-fg-secondary">MovimentaÃ§Ãµes</p>
                        </div>
                    </div>
                </div>
                <div className="dashboard-card !min-h-0 !p-4">
                    <div className="flex items-center gap-3">
                        <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-amber-500/10">
                            <svg className="h-5 w-5 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <p className="text-xl font-bold text-fg-primary"><SensitiveValue>{formatPoints(stats.mediaPorMovimentacao)}</SensitiveValue> pts</p>
                            <p className="text-xs text-fg-secondary">MÃ©dia por MovimentaÃ§Ã£o</p>
                        </div>
                    </div>
                </div>
            </div>

            <div className="grid gap-6 grid-cols-1 lg:grid-cols-3">
                {/* Card 1: AcÃºmulo vs Resgates */}
                <div className="dashboard-card flex flex-col justify-between">
                    <div className="section-header mb-4">
                        <div className="card-icon">
                            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h2 className="section-title">AcÃºmulo vs Resgates</h2>
                            <p className="text-xs text-fg-secondary">Fluxo total de pontos</p>
                        </div>
                    </div>

                    <div className="space-y-4">
                        <div className="flex justify-between items-end">
                            <div>
                                <span className="text-xs text-fg-secondary">Entradas</span>
                                <p className="text-lg font-bold text-green-400">+<SensitiveValue>{formatPoints(stats.totalEntradas)}</SensitiveValue></p>
                            </div>
                            <div>
                                <span className="text-xs text-fg-secondary">SaÃ­das</span>
                                <p className="text-lg font-bold text-red-400">-<SensitiveValue>{formatPoints(stats.totalSaidas)}</SensitiveValue></p>
                            </div>
                        </div>

                        {/* Visual Progress Bar - Side by side */}
                        <div className="h-4 w-full bg-white/5 rounded-full overflow-hidden flex">
                            {(() => {
                                const total = stats.totalEntradas + stats.totalSaidas
                                if (total === 0) return null
                                const greenPercent = (stats.totalEntradas / total) * 100
                                const redPercent = (stats.totalSaidas / total) * 100
                                return (
                                    <>
                                        {stats.totalEntradas > 0 && (
                                            <div
                                                className="h-full bg-gradient-to-r from-green-500/60 to-green-500/40 transition-all duration-500"
                                                style={{ width: `${greenPercent}%` }}
                                            />
                                        )}
                                        {stats.totalSaidas > 0 && (
                                            <div
                                                className="h-full bg-gradient-to-r from-red-500/40 to-red-500/60 transition-all duration-500"
                                                style={{ width: `${redPercent}%` }}
                                            />
                                        )}
                                    </>
                                )
                            })()}
                        </div>
                        <p className="text-xs text-fg-secondary text-center">
                            {stats.totalEntradas > 0
                                ? `${Math.min((stats.totalSaidas / stats.totalEntradas) * 100, 100).toFixed(1)}% dos ganhos foram utilizados`
                                : 'Sem entradas registradas'}
                        </p>
                    </div>
                </div>

                {/* Card 2: Resultado LÃ­quido */}
                <div className="dashboard-card flex flex-col justify-between">
                    <div className="section-header mb-4">
                        <div className="card-icon">
                            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h2 className="section-title">BalanÃ§o do PerÃ­odo</h2>
                            <p className="text-xs text-fg-secondary">Saldo final das operaÃ§Ãµes</p>
                        </div>
                    </div>

                    <div className="flex flex-col items-center justify-center flex-1 space-y-2">
                        <p className={`text-3xl font-bold ${stats.saldoLiquido >= 0 ? 'text-fg-primary' : 'text-red-400'}`}>
                            <SensitiveValue>{formatPoints(stats.saldoLiquido)}</SensitiveValue>
                        </p>

                        <div className={`flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${stats.growthRate >= 0 ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'
                            }`}>
                            {stats.growthRate >= 0 ? 'â–²' : 'â–¼'} {Math.abs(stats.growthRate).toFixed(1)}% vs mÃªs anterior
                        </div>
                    </div>
                </div>

                {/* Card 3: Top Programas */}
                <div className="dashboard-card flex flex-col">
                    <div className="section-header mb-4">
                        <div className="card-icon">
                            <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={1.5}>
                                <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.504-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0V5.25m-5.007 0V5.25m0 0h5.007v3.375M9.497 5.25v3.375M12 15v3.75m0-12v3.75" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h2 className="section-title">Maior Pontuador</h2>
                            <p className="text-xs text-fg-secondary">Principais fontes de pontos</p>
                        </div>
                    </div>

                    <div className="space-y-4 overflow-y-auto max-h-[160px] pr-2 custom-scrollbar">
                        {stats.topPrograms.length > 0 ? (
                            stats.topPrograms.map((prog, i) => (
                                <div key={prog.name} className="space-y-1">
                                    <div className="flex justify-between text-xs">
                                        <span className="text-fg-primary font-medium">{i + 1}. {prog.name}</span>
                                        <span className="text-fg-secondary">{prog.percent.toFixed(0)}%</span>
                                    </div>
                                    <div className="h-1.5 w-full bg-white/5 rounded-full overflow-hidden">
                                        <div
                                            className="h-full rounded-full bg-accent-pool"
                                            style={{ width: `${prog.percent}%`, opacity: 1 - (i * 0.2) }}
                                        />
                                    </div>
                                </div>
                            ))
                        ) : (
                            <div className="flex flex-col items-center justify-center h-full text-fg-secondary text-xs">
                                Sem dados de entrada
                            </div>
                        )}
                    </div>
                </div>
            </div>
        </>
    )
}

  </file>
  <file name='src\components\home\Home.tsx'>
import logoUrl from '../../assets/logo/logo.png'

export default function Home() {
  return (
    <section className="relative h-screen bg-bg-primary text-fg-primary">
      <div className="pointer-events-none absolute inset-0">
        {/* PadrÃ£o sutil de rotas aÃ©reas */}
        <svg
          className="absolute inset-0 h-full w-full opacity-[0.04]"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 800 600"
          preserveAspectRatio="xMidYMid slice"
        >
          {/* Pontos simplificados do mapa mundi */}
          <g fill="currentColor" className="text-white">
            {/* Americas */}
            <circle cx="180" cy="200" r="2" />
            <circle cx="200" cy="250" r="2" />
            <circle cx="160" cy="280" r="2" />
            <circle cx="220" cy="320" r="2" />
            <circle cx="190" cy="380" r="2" />
            {/* Europa */}
            <circle cx="400" cy="180" r="2" />
            <circle cx="420" cy="200" r="2" />
            <circle cx="440" cy="190" r="2" />
            <circle cx="380" cy="210" r="2" />
            {/* Ãsia */}
            <circle cx="550" cy="200" r="2" />
            <circle cx="600" cy="220" r="2" />
            <circle cx="650" cy="250" r="2" />
            <circle cx="580" cy="280" r="2" />
            {/* Ãfrica */}
            <circle cx="420" cy="300" r="2" />
            <circle cx="450" cy="340" r="2" />
            {/* AustrÃ¡lia */}
            <circle cx="680" cy="400" r="2" />
            <circle cx="700" cy="380" r="2" />
          </g>
          {/* Rotas de voo */}
          <g stroke="currentColor" strokeWidth="0.5" fill="none" className="text-accent-pool">
            {/* Rota 1: Americas para Europa */}
            <path d="M200,250 Q300,150 400,180" strokeDasharray="4,4" />
            {/* Rota 2: Europa para Ãsia */}
            <path d="M420,200 Q500,180 580,220" strokeDasharray="4,4" />
            {/* Rota 3: Ãsia para AustrÃ¡lia */}
            <path d="M600,280 Q650,340 680,400" strokeDasharray="4,4" />
            {/* Rota 4: Americas para Ãsia (trans-pacÃ­fico) */}
            <path d="M180,280 Q400,100 600,220" strokeDasharray="4,4" />
            {/* Rota 5: Europa para Ãfrica */}
            <path d="M400,210 Q410,250 420,300" strokeDasharray="4,4" />
          </g>
          {/* Ãcones de aviÃ£o nos pontos mÃ©dios das rotas */}
          <g fill="currentColor" className="text-white">
            <text x="300" y="165" fontSize="12" transform="rotate(-20 300 165)">âœˆ</text>
            <text x="500" y="185" fontSize="12" transform="rotate(5 500 185)">âœˆ</text>
            <text x="400" y="140" fontSize="10" transform="rotate(-10 400 140)">âœˆ</text>
          </g>
        </svg>
        <div className="absolute inset-0 bg-[radial-gradient(55%_55%_at_50%_40%,rgba(255,255,255,0.10)_0%,rgba(255,255,255,0)_72%)]" />
        <div className="absolute inset-0 bg-[radial-gradient(90%_70%_at_50%_50%,rgba(0,0,0,0)_0%,rgba(0,0,0,0.55)_100%)]" />
      </div>

      <div className="relative flex h-screen flex-col items-center justify-center px-6 text-center">
        <img src={logoUrl} alt="Logo" className="h-44 w-44 md:h-50 md:w-50" />

        <h1 className="mt-8 text-5xl font-bold uppercase leading-none tracking-tight md:text-7xl">
          POINTS &amp; MILES
        </h1>

        <p className="mt-4 max-w-2xl text-xs font-light uppercase tracking-[0.35em] text-fg-secondary md:text-sm">
          GERENCIADOR DE PONTOS E MILHAS
        </p>

        <button
          type="button"
          onClick={() => {
            const target = document.getElementById('home-content')
            if (target) target.scrollIntoView({ behavior: 'smooth' })
          }}
          aria-label="Ir para o conteÃºdo"
          className="mt-16 rounded-full border border-white/20 bg-white/5 p-3 text-fg-primary transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-accent-pool/60 focus-visible:border-accent-pool active:border-accent-pool active:bg-white/10 animate-bounce"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="1.5"
            strokeLinecap="round"
            strokeLinejoin="round"
            className="h-6 w-6"
          >
            <path d="M6 9l6 6 6-6" />
          </svg>
        </button>
      </div>
    </section>
  )
}

  </file>
  <file name='src\components\home\HomeFeatures.tsx'>
const features = [
    {
        icon: (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
                className="h-6 w-6"
            >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
                <circle cx="12" cy="16" r="2" />
            </svg>
        ),
        title: 'Controle de Validade',
        description: 'Nunca mais perca milhas expiradas.',
    },
    {
        icon: (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
                className="h-6 w-6"
            >
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
                <line x1="1" y1="10" x2="23" y2="10" />
            </svg>
        ),
        title: 'GestÃ£o de CartÃµes',
        description: 'Vincule mÃºltiplos cartÃµes e programas.',
    },
    {
        icon: (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
                className="h-6 w-6"
            >
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17" />
                <polyline points="16 7 22 7 22 13" />
            </svg>
        ),
        title: 'CotaÃ§Ã£o Atualizada',
        description: 'Saiba quanto valem seus pontos hoje.',
    },
]

export default function HomeFeatures() {
    return (
        <section id="home-content" className="mx-auto w-full max-w-6xl px-6 pt-16 pb-10">
            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                {features.map((feature, index) => (
                    <div
                        key={feature.title}
                        className="group relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm transition-all duration-300 hover:border-accent-pool/30 hover:bg-white/10 hover:shadow-[0_0_1.5rem_rgba(73,197,182,0.15)]"
                        style={{ animationDelay: `${index * 100}ms` }}
                    >
                        {/* Brilho de gradiente ao passar o mouse */}
                        <div className="pointer-events-none absolute -top-12 -right-12 h-32 w-32 rounded-full bg-accent-pool/10 opacity-0 blur-2xl transition-opacity duration-300 group-hover:opacity-100" />

                        <div className="relative">
                            <div className="mb-4 inline-flex rounded-xl bg-gradient-to-br from-accent-sky/20 to-accent-pool/20 p-3 text-accent-pool transition-transform duration-300 group-hover:scale-110">
                                {feature.icon}
                            </div>

                            <h3 className="text-lg font-semibold text-fg-primary">
                                {feature.title}
                            </h3>

                            <p className="mt-2 text-sm leading-relaxed text-fg-secondary">
                                {feature.description}
                            </p>
                        </div>
                    </div>
                ))}
            </div>
        </section>
    )
}

  </file>
  <file name='src\components\home\HomeFooter.tsx'>
import { Link, useLocation } from 'react-router-dom'

export default function HomeFooter() {
    const location = useLocation()

    return (
        <footer className="mx-auto w-full max-w-6xl px-6 pb-8">
            <div className="flex flex-col items-center gap-4 border-t border-white/10 pt-6 text-center">
                <div className="flex flex-wrap items-center justify-center gap-4 text-xs text-fg-secondary">
                    <Link
                        to="/terms"
                        state={{ backgroundLocation: location }}
                        className="transition-colors hover:text-accent-pool"
                    >
                        Termos de Uso
                    </Link>
                    <span className="opacity-30">â€¢</span>
                    <Link
                        to="/privacy"
                        state={{ backgroundLocation: location }}
                        className="transition-colors hover:text-accent-pool"
                    >
                        PolÃ­tica de Privacidade
                    </Link>
                </div>

                <p className="text-xs text-fg-secondary/60">
                    Â© {new Date().getFullYear()} Points & Miles â€” {' '}
                    <a
                        href="https://github.com/ErickDevp"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-accent-pool/80 transition-colors hover:text-accent-pool"
                    >
                        RepositÃ³rio GitHub
                    </a>
                </p>
            </div>
        </footer>
    )
}

  </file>
  <file name='src\components\home\HomeMainContent.tsx'>
import { useEffect, useState } from 'react'
import { Link, useLocation } from 'react-router-dom'
import logoUrl from '../../assets/logo/logo.png'
import { useAuth } from '../../hooks/useAuth'
import { notify } from '../../utils/notify'
import HomeFeatures from './HomeFeatures'
import HomeFooter from './HomeFooter'
import CreditCardPreview from '../dashboard/cartoes/CreditCardPreview'
import { relatorioService } from '../../services/relatorio/relatorio.service'
import { cartaoUsuarioService } from '../../services/cartaoUsuario/cartaoUsuario.service'
import { programaFidelidadeService } from '../../services/programaFidelidade/programaFidelidade.service'

type UserStats = {
  totalPontos: number
  totalCartoes: number
  totalProgramas: number
  loading: boolean
}

export default function HomeMainContent() {
  const location = useLocation()
  const { isAuthenticated, logout } = useAuth()

  const modalState = { backgroundLocation: location }

  const [stats, setStats] = useState<UserStats>({
    totalPontos: 0,
    totalCartoes: 0,
    totalProgramas: 0,
    loading: true,
  })

  // Busca estatÃ­sticas do usuÃ¡rio quando autenticado
  useEffect(() => {
    if (!isAuthenticated) return

    let isActive = true

    const loadStats = async () => {
      try {
        const [relatorio, cartoes, programas] = await Promise.all([
          relatorioService.get().catch(() => null),
          cartaoUsuarioService.list().catch(() => []),
          programaFidelidadeService.list().catch(() => []),
        ])

        if (!isActive) return

        // Usa saldo global do relatÃ³rio
        const totalPontos = relatorio?.saldoGlobal ?? 0

        setStats({
          totalPontos,
          totalCartoes: Array.isArray(cartoes) ? cartoes.length : 0,
          totalProgramas: Array.isArray(programas) ? programas.length : 0,
          loading: false,
        })
      } catch {
        if (isActive) {
          setStats((prev) => ({ ...prev, loading: false }))
        }
      }
    }

    loadStats()

    return () => {
      isActive = false
    }
  }, [isAuthenticated])

  const handleLogout = () => {
    logout()
    notify.info('VocÃª saiu da sua conta.')
  }

  const formatNumber = (num: number): string => {
    if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`
    if (num >= 1000) return `${(num / 1000).toFixed(1)}K`
    return num.toLocaleString('pt-BR')
  }

  return (
    <main className="flex min-h-screen w-full flex-col justify-center">
      <HomeFeatures />
      <section className="mx-auto w-full max-w-6xl px-6 pb-20">
        <div className="relative overflow-hidden rounded-3xl border border-white/10 bg-bg-secondary shadow-[0_0_0_0.0625rem_rgba(255,255,255,0.04),0_1.5rem_3.75rem_rgba(0,0,0,0.55)]">
          <div className="pointer-events-none absolute inset-0">
            <div className="absolute -top-32 -right-24 h-72 w-72 rounded-full bg-accent-pool/20 blur-3xl" />
            <div className="absolute -bottom-40 -left-24 h-80 w-80 rounded-full bg-accent-sky/20 blur-3xl" />
            <div className="absolute inset-0 bg-[radial-gradient(60%_60%_at_20%_0%,rgba(255,255,255,0.06)_0%,rgba(255,255,255,0)_65%)]" />
          </div>

          <div className="relative flex flex-col gap-10 p-8 md:flex-row md:items-center md:justify-between md:gap-12 md:p-12">
            <div className="min-w-0">
              <div className="flex items-center gap-3">
                <img
                  src={logoUrl}
                  alt="Logo"
                  className="h-12 w-12 rounded-xl bg-white/5 p-1.5 ring-1 ring-white/10"
                />
                <span className="text-xs font-semibold tracking-[0.35em] text-fg-secondary">
                  POINTS &amp; MILES
                </span>
              </div>

              <h1 className="mt-6 text-3xl font-bold leading-tight text-fg-primary md:text-5xl">
                GERENCIADOR DE PONTOS E MILHAS
              </h1>

              <p className="mt-4 max-w-2xl text-sm leading-relaxed text-fg-secondary md:text-base">
                Centralize seus programas, acompanhe movimentaÃ§Ãµes e otimize seus pontos com uma
                experiÃªncia simples, rÃ¡pida e segura.
              </p>

              <div className="mt-8 flex flex-wrap gap-3">
                {isAuthenticated ? (
                  <button
                    type="button"
                    className="rounded-xl bg-accent-pool px-5 py-2.5 text-sm font-semibold text-black shadow hover:opacity-90"
                    onClick={handleLogout}
                  >
                    Sair
                  </button>
                ) : (
                  <>
                    <Link
                      to="/login"
                      state={modalState}
                      className="rounded-xl bg-accent-pool px-5 py-2.5 text-sm font-semibold text-black shadow hover:opacity-90"
                    >
                      Entrar
                    </Link>
                    <Link
                      to="/register"
                      state={modalState}
                      className="rounded-xl border border-white/10 bg-white/5 px-5 py-2.5 text-sm font-semibold text-fg-primary hover:bg-white/10"
                    >
                      Criar conta
                    </Link>

                    <Link
                      to="/forgot-password"
                      state={modalState}
                      className="rounded-xl border border-white/10 bg-transparent px-5 py-2.5 text-sm font-semibold text-fg-secondary hover:bg-white/5"
                    >
                      Recuperar senha
                    </Link>
                  </>
                )}
              </div>
            </div>

            <aside className="w-full max-w-md">
              {isAuthenticated ? (
                <Link
                  to="/dashboard"
                  className="group relative block overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br from-slate-900/80 via-slate-800/60 to-slate-900/80 p-6 backdrop-blur-sm transition-all duration-300 hover:border-accent-pool/30 hover:shadow-[0_0_2rem_rgba(73,197,182,0.2)]"
                >
                  {/* Fundo de gradiente animado */}
                  <div className="pointer-events-none absolute -top-20 -right-20 h-48 w-48 rounded-full bg-gradient-to-br from-accent-pool/30 to-accent-sky/20 blur-3xl transition-transform duration-500 group-hover:scale-125" />
                  <div className="pointer-events-none absolute -bottom-16 -left-16 h-40 w-40 rounded-full bg-gradient-to-tr from-accent-sky/20 to-accent-pool/10 blur-2xl transition-transform duration-500 group-hover:scale-125" />

                  <div className="relative text-center">
                    {/* Ãcone Dashboard */}
                    <div className="mx-auto mb-5 inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-accent-pool/20 to-accent-sky/20 transition-transform duration-300 group-hover:scale-110">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="1.5"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        className="h-8 w-8 text-accent-pool"
                      >
                        <rect x="3" y="3" width="7" height="7" rx="1" />
                        <rect x="14" y="3" width="7" height="7" rx="1" />
                        <rect x="3" y="14" width="7" height="7" rx="1" />
                        <rect x="14" y="14" width="7" height="7" rx="1" />
                      </svg>
                    </div>

                    {/* Texto de boas-vindas */}
                    <h3 className="text-lg font-semibold text-fg-primary">
                      Bem-vindo de volta!
                    </h3>
                    <p className="mt-2 text-sm text-fg-secondary">
                      Acesse seu painel para gerenciar seus pontos e milhas.
                    </p>

                    {/* BotÃ£o CTA */}
                    <div className="mt-6 inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-accent-pool to-accent-sky px-6 py-3 text-sm font-semibold text-black transition-all duration-300 group-hover:gap-3 group-hover:shadow-[0_0_1.5rem_rgba(73,197,182,0.4)]">
                      <span>Ir para o Dashboard</span>
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        className="h-4 w-4 transition-transform duration-300 group-hover:translate-x-1"
                      >
                        <path d="M5 12h14M12 5l7 7-7 7" />
                      </svg>
                    </div>

                    {/* PrÃ©via de estatÃ­sticas */}
                    <div className="mt-6 flex justify-center gap-6 border-t border-white/10 pt-5">
                      <div className="text-center">
                        <p className="text-2xl font-bold bg-gradient-to-r from-accent-pool to-accent-sky bg-clip-text text-transparent">
                          {stats.loading ? '...' : formatNumber(stats.totalPontos)}
                        </p>
                        <p className="text-[10px] uppercase tracking-wider text-fg-secondary/60">Pontos</p>
                      </div>
                      <div className="h-8 w-px bg-white/10" />
                      <div className="text-center">
                        <p className="text-2xl font-bold bg-gradient-to-r from-accent-pool to-accent-sky bg-clip-text text-transparent">
                          {stats.loading ? '...' : stats.totalCartoes}
                        </p>
                        <p className="text-[10px] uppercase tracking-wider text-fg-secondary/60">CartÃµes</p>
                      </div>
                      <div className="h-8 w-px bg-white/10" />
                      <div className="text-center">
                        <p className="text-2xl font-bold bg-gradient-to-r from-accent-pool to-accent-sky bg-clip-text text-transparent">
                          {stats.loading ? '...' : stats.totalProgramas}
                        </p>
                        <p className="text-[10px] uppercase tracking-wider text-fg-secondary/60">Programas</p>
                      </div>
                    </div>
                  </div>
                </Link>
              ) : (
                <div className="relative overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br from-slate-900/80 via-slate-800/60 to-slate-900/80 p-6 backdrop-blur-sm">
                  {/* Efeitos de fundo do cartÃ£o premium */}
                  <div className="pointer-events-none absolute -top-16 -right-16 h-40 w-40 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-600/10 blur-2xl" />
                  <div className="pointer-events-none absolute -bottom-12 -left-12 h-32 w-32 rounded-full bg-gradient-to-tr from-accent-pool/20 to-accent-sky/10 blur-2xl" />

                  {/* Mockup do cartÃ£o de crÃ©dito */}
                  <CreditCardPreview
                    holderName="SEU NOME"
                    lastDigits="1234"
                    cardTier="INFINITE"
                    variant="black"
                    className="mb-6"
                  />

                  {/* ExibiÃ§Ã£o de saldo */}
                  <div className="relative">
                    <p className="text-xs font-semibold uppercase tracking-wider text-fg-secondary">Saldo Total</p>
                    <p className="mt-1 bg-gradient-to-r from-accent-pool to-accent-sky bg-clip-text text-3xl font-bold text-transparent">
                      1.450.000 <span className="text-lg">pts</span>
                    </p>

                    {/* Mini grÃ¡fico sparkline */}
                    <div className="mt-4 flex h-10 items-end gap-1">
                      {[40, 55, 45, 70, 60, 80, 65, 90, 75, 100, 85, 95].map((h, i) => (
                        <div
                          key={i}
                          className="flex-1 rounded-t bg-gradient-to-t from-accent-pool/60 to-accent-sky/60 transition-all duration-300 hover:from-accent-pool hover:to-accent-sky"
                          style={{ height: `${h}%` }}
                        />
                      ))}
                    </div>
                    <p className="mt-2 text-[10px] text-fg-secondary/60">EvoluÃ§Ã£o dos Ãºltimos 12 meses</p>
                  </div>

                  {/* Dica CTA */}
                  <p className="mt-4 text-center text-xs text-fg-secondary/80">
                    Registre-se para comeÃ§ar a gerenciar seu saldo real!
                  </p>
                </div>
              )}
            </aside>
          </div>
        </div>
      </section>

      <HomeFooter />
    </main>
  )
}

  </file>
  <file name='src\components\layouts\AuthLayout.tsx'>
import { Outlet } from 'react-router-dom'

/**
 * AuthLayout - Wrapper de layout para pÃ¡ginas de autenticaÃ§Ã£o e legais
 * Centraliza o conteÃºdo verticalmente e horizontalmente com o fundo do aplicativo
 */
export default function AuthLayout() {
    return (
        <div className="min-h-screen w-full bg-bg-primary flex items-center justify-center px-4 py-8 sm:px-6 lg:px-8">
            {/* SobreposiÃ§Ã£o sutil de gradiente */}
            <div className="fixed inset-0 -z-10 overflow-hidden">
                <div className="absolute inset-0 bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(73,197,182,0.15),transparent)]" />
                <div className="absolute inset-0 bg-[radial-gradient(ellipse_60%_50%_at_80%_100%,rgba(39,121,167,0.1),transparent)]" />
            </div>

            {/* Container de conteÃºdo centralizado */}
            <div className="w-full max-w-md">
                <Outlet />
            </div>
        </div>
    )
}

  </file>
  <file name='src\components\sidebar\Sidebar.tsx'>
import { NavLink } from 'react-router-dom'
import { NAV_ITEMS } from '../../constants/navigation'
import logoUrl from '../../assets/logo/logo.png'
import { SidebarNavItem } from './SidebarNavItem'

type SidebarProps = {
    mobileMenuOpen: boolean
    onNavigate: () => void
    onLogout: () => void
}

export function Sidebar({ mobileMenuOpen, onNavigate, onLogout }: SidebarProps) {
    return (
        <aside
            className={`
        fixed top-0 left-0 z-50 h-[100dvh]
        flex w-64 md:w-28 lg:w-32 flex-col items-center gap-5
        bg-bg-secondary/95 backdrop-blur-xl md:bg-bg-secondary/80
        border-r border-white/5 shadow-2xl md:shadow-[0.375rem_0_1.5rem_rgba(0,0,0,0.35)]
        transition-transform duration-300 ease-out will-change-transform
        ${mobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}
      `}
        >
            <div className="flex w-full items-center justify-center py-6 md:py-6 relative">
                {/* Logo */}
                <NavLink to="/dashboard/home" onClick={onNavigate} className="flex items-center justify-center">
                    <img
                        src={logoUrl}
                        alt="Logo"
                        className="h-16 w-16 md:h-14 md:w-14 object-contain filter drop-shadow-[0_0_0.9375rem_rgba(73,197,182,0.3)] transition-all hover:scale-105"
                    />
                </NavLink>
            </div>

            <nav className="flex w-full flex-1 flex-col items-center gap-2 px-4 md:px-2 overflow-y-auto custom-scrollbar">
                {NAV_ITEMS.map((item) => (
                    <SidebarNavItem key={item.to} item={item} onNavigate={onNavigate} />
                ))}
            </nav>

            <div className="w-full px-4 md:px-2 pb-6 pt-2">
                <button
                    type="button"
                    onClick={onLogout}
                    className="group relative w-full overflow-hidden rounded-xl border border-red-500/20 bg-red-500/5 px-4 py-3 md:px-2 md:py-2 text-red-400 transition-all hover:border-red-500/40 hover:bg-red-500/10 hover:shadow-[0_0_1.25rem_rgba(239,68,68,0.15)] flex items-center md:flex-col justify-center gap-3 md:gap-1"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        className="h-5 w-5 transition-transform group-hover:-translate-x-1 md:group-hover:translate-x-0 md:group-hover:translate-y-0.5"
                    >
                        <path strokeLinecap="round" strokeLinejoin="round" d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4" />
                        <path strokeLinecap="round" strokeLinejoin="round" d="M10 17l5-5-5-5" />
                        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12H3" />
                    </svg>
                    <span className="text-sm md:text-[0.5625rem] font-bold uppercase tracking-wider">Sair</span>
                </button>
            </div>
        </aside>
    )
}

  </file>
  <file name='src\components\sidebar\SidebarNavItem.tsx'>
import { NavLink } from 'react-router-dom'
import type { NavItem } from '../../constants/navigation'

type SidebarNavItemProps = {
    item: NavItem
    onNavigate: () => void
}

export function SidebarNavItem({ item, onNavigate }: SidebarNavItemProps) {
    return (
        <NavLink
            to={item.to}
            onClick={onNavigate}
            end={item.to === '/dashboard/home'}
            className={({ isActive }) =>
                [
                    'flex items-center gap-3 rounded-xl px-4 py-3 transition-all duration-300 group relative overflow-hidden',
                    'md:w-full md:flex-col md:justify-center md:gap-1 md:px-2 md:py-2.5',
                    'w-full text-sm md:text-[0.5625rem] md:font-bold md:uppercase md:tracking-wider',
                    isActive
                        ? 'bg-gradient-to-r from-accent-sky/10 to-accent-sea/10 text-accent-pool shadow-[0_0_0_0.0625rem_rgba(73,197,182,0.3)]'
                        : 'text-fg-secondary hover:bg-white/5 hover:text-fg-primary hover:shadow-[0_0_0.9375rem_rgba(0,0,0,0.2)]',
                ].join(' ')
            }
        >
            {/* Faixa Indicadora Ativa */}
            {({ isActive }) => (
                <>
                    <div
                        className={`absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 rounded-r-full bg-accent-pool transition-all duration-300 ${isActive ? 'opacity-100' : 'opacity-0'
                            }`}
                    />
                    <div className="relative z-10 transition-transform duration-300 group-hover:scale-110 md:group-hover:translate-y-[-0.125rem]">
                        {item.icon}
                    </div>
                    <span className="relative z-10 font-medium md:text-center leading-tight truncate w-full md:w-auto">
                        {item.label}
                    </span>
                </>
            )}
        </NavLink>
    )
}

  </file>
  <file name='src\components\topbar\TopBar.tsx'>
import { useCallback, useEffect, useMemo, useRef, useState } from 'react'
import { NavLink, useLocation, useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import { useTheme } from '../../hooks/useTheme'
import { usuarioService } from '../../services/usuario/usuario.service'
import { notificacaoService } from '../../services/notificacao/notificacao.service'
import type { Notificacao } from '../../interfaces/notificacao'

function ThemeToggleButton() {
  const { resolvedTheme, toggleTheme } = useTheme()
  const isDark = resolvedTheme === 'dark'

  return (
    <button
      type="button"
      onClick={toggleTheme}
      className="flex h-9 w-9 items-center justify-center rounded-full border border-white/10 bg-white/5 text-fg-primary hover:bg-white/10 transition-all duration-300"
      aria-label={isDark ? 'Ativar modo claro' : 'Ativar modo escuro'}
    >
      {isDark ? (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
          <circle cx="12" cy="12" r="4" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M12 2v2" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M12 20v2" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M4.93 4.93l1.41 1.41" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M17.66 17.66l1.41 1.41" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M2 12h2" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M20 12h2" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M4.93 19.07l1.41-1.41" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M17.66 6.34l1.41-1.41" />
        </svg>
      ) : (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
          <path strokeLinecap="round" strokeLinejoin="round" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
        </svg>
      )}
    </button>
  )
}

type Props = {
  userName?: string
  userEmail?: string
  searchTerm?: string
  onSearchChange?: (value: string) => void
}

export default function TopBar({
  userName,
  userEmail,
  searchTerm = '',
  onSearchChange,
}: Props) {
  const [openMenu, setOpenMenu] = useState<'notifications' | 'settings' | 'profile' | null>(null)
  const [user, setUser] = useState<{ nome: string; email: string } | null>(null)
  const [notifications, setNotifications] = useState<Notificacao[]>([])
  const [userPhotoUrl, setUserPhotoUrl] = useState<string | null>(null)
  const { logout } = useAuth()
  const navigate = useNavigate()
  const location = useLocation()
  const containerRef = useRef<HTMLDivElement | null>(null)

  const pageTitle = useMemo(() => {
    if (!location.pathname.startsWith('/dashboard')) return 'Dashboard'

    const section = location.pathname.split('/')[2] || 'home'
    const titleMap: Record<string, string> = {
      home: 'Dashboard',
      perfil: 'Meu perfil',
      cartoes: 'CartÃµes',
      'registrar-pontos': 'Registrar pontos',
      notificacoes: 'NotificaÃ§Ãµes',
      movimentacoes: 'MovimentaÃ§Ãµes',
      relatorios: 'RelatÃ³rios',
      promocoes: 'PromoÃ§Ãµes',
      configuracoes: 'ConfiguraÃ§Ãµes',
    }

    return titleMap[section] ?? 'Dashboard'
  }, [location.pathname])

  useEffect(() => {
    const handleOutsideClick = (event: MouseEvent | TouchEvent) => {
      const target = event.target as Node | null
      if (!containerRef.current || !target) return
      if (!containerRef.current.contains(target)) {
        setOpenMenu(null)
      }
    }

    document.addEventListener('mousedown', handleOutsideClick)
    document.addEventListener('touchstart', handleOutsideClick)
    return () => {
      document.removeEventListener('mousedown', handleOutsideClick)
      document.removeEventListener('touchstart', handleOutsideClick)
    }
  }, [])

  useEffect(() => {
    let isActive = true
    let objectUrl: string | null = null

    const loadData = async () => {
      // Carrega dados de forma independente para evitar que uma falha bloqueie as outras
      try {
        const userData = await usuarioService.getMe()
        if (isActive) setUser({ nome: userData.nome, email: userData.email })
      } catch {
        // Falha ao carregar dados do usuÃ¡rio - continua
      }

      try {
        const notificationData = await notificacaoService.list()
        if (isActive && Array.isArray(notificationData)) {
          setNotifications(notificationData)
        }
      } catch {
        // Falha ao carregar notificaÃ§Ãµes - continua
      }

      try {
        const photoBlob = await usuarioService.getFoto()
        if (isActive && photoBlob) {
          objectUrl = URL.createObjectURL(photoBlob)
          setUserPhotoUrl(objectUrl)
        }
      } catch {
        // Falha ao carregar foto - continua com avatar padrÃ£o
      }
    }

    loadData()

    return () => {
      isActive = false
      if (objectUrl) URL.revokeObjectURL(objectUrl)
    }
  }, [])

  // Ouve eventos de notificaÃ§Ã£o da pÃ¡gina Notificacoes
  useEffect(() => {
    const handleNotificationRead = (e: Event) => {
      const customEvent = e as CustomEvent<{ id: number }>
      setNotifications((prev) =>
        prev.map((n) => (n.id === customEvent.detail.id ? { ...n, lida: true } : n))
      )
    }

    const handleNotificationDeleted = (e: Event) => {
      const customEvent = e as CustomEvent<{ id: number }>
      setNotifications((prev) => prev.filter((n) => n.id !== customEvent.detail.id))
    }

    const handleAllRead = () => {
      setNotifications((prev) => prev.map((n) => ({ ...n, lida: true })))
    }

    const handleAllDeleted = () => {
      setNotifications([])
    }

    const handleCreated = async () => {
      // Recarrega notificaÃ§Ãµes quando uma nova Ã© criada
      try {
        const data = await notificacaoService.list()
        if (Array.isArray(data)) setNotifications(data)
      } catch {
        // Falha silenciosa
      }
    }

    window.addEventListener('notification-read', handleNotificationRead)
    window.addEventListener('notification-deleted', handleNotificationDeleted)
    window.addEventListener('notifications-all-read', handleAllRead)
    window.addEventListener('notifications-all-deleted', handleAllDeleted)
    window.addEventListener('notification-created', handleCreated)

    return () => {
      window.removeEventListener('notification-read', handleNotificationRead)
      window.removeEventListener('notification-deleted', handleNotificationDeleted)
      window.removeEventListener('notifications-all-read', handleAllRead)
      window.removeEventListener('notifications-all-deleted', handleAllDeleted)
      window.removeEventListener('notification-created', handleCreated)
    }
  }, [])

  // Handler para marcar como lida no dropdown da TopBar
  const handleMarkAsRead = useCallback(async (id: number) => {
    try {
      await notificacaoService.markAsRead(id)
      setNotifications((prev) =>
        prev.map((n) => (n.id === id ? { ...n, lida: true } : n))
      )
    } catch {
      // Falha silenciosa na TopBar
    }
  }, [])

  const displayName = userName ?? user?.nome ?? 'UsuÃ¡rio'
  const displayEmail = userEmail ?? user?.email ?? ''
  const unreadNotifications = notifications.filter((n) => !n.lida)
  const unreadCount = unreadNotifications.length
  const recentNotifications = unreadNotifications.slice(0, 3)

  return (
    <div
      ref={containerRef}
      className="flex w-full items-center justify-between gap-4 rounded-2xl border border-white/10 bg-bg-secondary/60 px-5 py-3 shadow-[0_0.625rem_1.5rem_rgba(0,0,0,0.18)]"
    >
      <div className="min-w-[7.5rem] text-sm font-semibold uppercase tracking-[0.2em] text-fg-secondary">
        {pageTitle}
      </div>

      <div className="flex flex-1 justify-center">
        <label className="relative w-full max-w-md">
          <span className="sr-only">Pesquisar no dashboard</span>
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-fg-secondary pointer-events-none"
          >
            <circle cx="11" cy="11" r="8" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-4.35-4.35" />
          </svg>
          <input
            type="search"
            value={searchTerm}
            onChange={(e) => onSearchChange?.(e.target.value)}
            placeholder="Pesquisar cartÃµes, saldos e grÃ¡ficos..."
            className="w-full rounded-full border border-white/10 bg-white/5 pl-10 pr-4 py-2 text-sm text-fg-primary placeholder:text-fg-secondary focus:outline-none focus:ring-2 focus:ring-accent-pool/40"
          />
        </label>
      </div>

      <div className="relative flex items-center gap-3">
        <ThemeToggleButton />

        <div className="relative">
          <button
            type="button"
            onClick={() => setOpenMenu((prev) => (prev === 'notifications' ? null : 'notifications'))}
            className="relative flex h-9 w-9 items-center justify-center rounded-full border border-white/10 bg-white/5 text-fg-primary hover:bg-white/10"
            aria-label="NotificaÃ§Ãµes"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
              <path strokeLinecap="round" strokeLinejoin="round" d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M13.73 21a2 2 0 01-3.46 0" />
            </svg>
            {unreadCount > 0 ? (
              <span className="absolute -right-1 -top-1 flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-accent-pool px-1 text-[0.625rem] font-bold text-bg-primary">
                {unreadCount}
              </span>
            ) : null}
          </button>
          {openMenu === 'notifications' ? (
            <div className="absolute right-0 top-12 z-50 w-72 rounded-2xl border border-white/10 bg-bg-secondary p-4 text-sm text-fg-primary shadow-[0_0.75rem_1.875rem_rgba(0,0,0,0.35)]">
              <p className="mb-3 text-xs font-semibold uppercase tracking-[0.2em] text-fg-secondary">
                {unreadCount > 0 ? `${unreadCount} nÃ£o lida${unreadCount > 1 ? 's' : ''}` : 'NotificaÃ§Ãµes'}
              </p>
              {recentNotifications.length ? (
                <ul className="space-y-2">
                  {recentNotifications.map((item) => (
                    <li key={item.id}>
                      <button
                        type="button"
                        onClick={() => handleMarkAsRead(item.id)}
                        className="w-full flex items-start gap-2 rounded-lg bg-white/5 p-2 border border-white/5 hover:bg-white/10 transition-colors text-left"
                      >
                        <span className="mt-1.5 flex h-2 w-2 flex-shrink-0 rounded-full bg-accent-pool animate-pulse" />
                        <div className="min-w-0 flex-1">
                          <p className="font-semibold text-xs text-fg-primary truncate">{item.titulo}</p>
                          <p className="text-[0.625rem] text-fg-secondary line-clamp-1">{item.mensagem}</p>
                        </div>
                      </button>
                    </li>
                  ))}
                </ul>
              ) : (
                <p className="text-xs text-fg-secondary">Nenhuma notificaÃ§Ã£o nÃ£o lida.</p>
              )}
              <NavLink
                to="/dashboard/notificacoes"
                className="mt-3 inline-flex text-xs font-semibold text-accent-pool hover:underline"
              >
                Ver todas â†’
              </NavLink>
            </div>
          ) : null}
        </div>

        <div className="relative">
          <button
            type="button"
            onClick={() => setOpenMenu((prev) => (prev === 'settings' ? null : 'settings'))}
            className="flex h-9 w-9 items-center justify-center rounded-full border border-white/10 bg-white/5 text-fg-primary hover:bg-white/10"
            aria-label="ConfiguraÃ§Ãµes"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 8a4 4 0 100 8 4 4 0 000-8z" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M4.93 6.93l1.41-1.41 2.12 1.22a7.96 7.96 0 016.08 0l2.12-1.22 1.41 1.41-1.22 2.12a7.96 7.96 0 010 6.08l1.22 2.12-1.41 1.41-2.12-1.22a7.96 7.96 0 01-6.08 0l-2.12 1.22-1.41-1.41 1.22-2.12a7.96 7.96 0 010-6.08z" />
            </svg>
          </button>
          {openMenu === 'settings' ? (
            <div className="absolute right-0 top-12 z-50 w-60 rounded-2xl border border-white/10 bg-bg-secondary p-4 text-sm text-fg-primary shadow-[0_0.75rem_1.875rem_rgba(0,0,0,0.35)]">
              <p className="mb-3 text-xs font-semibold uppercase tracking-[0.2em] text-fg-secondary">
                Atalhos de configuraÃ§Ã£o
              </p>
              <ul className="space-y-2 text-xs text-fg-secondary">
                <li>â€¢ PreferÃªncias do painel</li>
                <li>â€¢ SeguranÃ§a da conta</li>
                <li>â€¢ IntegraÃ§Ãµes</li>
              </ul>
              <NavLink
                to="/dashboard/configuracoes"
                className="mt-3 inline-flex text-xs font-semibold text-accent-pool hover:underline"
              >
                Ir para configuraÃ§Ãµes
              </NavLink>
            </div>
          ) : null}
        </div>

        <div className="relative">
          <button
            type="button"
            onClick={() => setOpenMenu((prev) => (prev === 'profile' ? null : 'profile'))}
            className="flex h-9 w-9 items-center justify-center overflow-hidden rounded-full border border-white/10 bg-white/5"
            aria-label="Perfil do usuÃ¡rio"
          >
            <img
              src={userPhotoUrl ?? 'https://i.pravatar.cc/64?img=15'}
              alt="Foto do usuÃ¡rio"
              className="h-full w-full object-cover"
            />
          </button>
          {openMenu === 'profile' ? (
            <div className="absolute right-0 top-12 z-50 w-64 rounded-2xl border border-white/10 bg-bg-secondary p-4 text-sm text-fg-primary shadow-[0_0.75rem_1.875rem_rgba(0,0,0,0.35)]">
              <div className="space-y-1">
                <p className="text-sm font-semibold text-fg-primary">{displayName}</p>
                <p className="text-xs text-fg-secondary">{displayEmail}</p>
              </div>

              <div className="mt-4 space-y-2 text-xs">
                <NavLink
                  to="/dashboard/perfil"
                  className="flex items-center justify-between rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-fg-primary hover:bg-white/10"
                >
                  Meu perfil
                  <span className="text-fg-secondary">â€º</span>
                </NavLink>
                <button
                  type="button"
                  onClick={() => {
                    logout()
                    navigate('/', { replace: true })
                  }}
                  className="flex w-full items-center justify-between rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-fg-primary hover:bg-white/10"
                >
                  Sair
                  <span className="text-fg-secondary">â†©</span>
                </button>
              </div>
            </div>
          ) : null}
        </div>
      </div>
    </div>
  )
}

  </file>
  <file name='src\components\ui\CategoryBadge.tsx'>
type CategoryType = 'AEREA' | 'BANCO' | 'FINANCEIRO' | 'FINANCEIRA' | 'VAREJO' | 'OUTRO' | string

type CategoryConfig = {
    label: string
    bg: string
    text: string
}

const CATEGORY_CONFIG: Record<string, CategoryConfig> = {
    AEREA: {
        label: 'AÃ©rea',
        bg: 'bg-sky-500/10',
        text: 'text-sky-400',
    },
    BANCO: {
        label: 'Banco',
        bg: 'bg-violet-500/10',
        text: 'text-violet-400',
    },
    FINANCEIRO: {
        label: 'Financeiro',
        bg: 'bg-violet-500/10',
        text: 'text-violet-400',
    },
    FINANCEIRA: {
        label: 'Financeira',
        bg: 'bg-violet-500/10',
        text: 'text-violet-400',
    },
    VAREJO: {
        label: 'Varejo',
        bg: 'bg-emerald-500/10',
        text: 'text-emerald-400',
    },
    OUTRO: {
        label: 'Outro',
        bg: 'bg-white/5',
        text: 'text-fg-secondary',
    },
}

const DEFAULT_CATEGORY: CategoryConfig = {
    label: 'Outro',
    bg: 'bg-white/5',
    text: 'text-fg-secondary',
}

type CategoryBadgeProps = {
    /** Nome da categoria */
    category: CategoryType
    /** className opcional para estilizaÃ§Ã£o adicional */
    className?: string
}

export default function CategoryBadge({ category, className = '' }: CategoryBadgeProps) {
    const normalizedCategory = category?.toUpperCase() ?? ''
    const config = CATEGORY_CONFIG[normalizedCategory] ?? {
        ...DEFAULT_CATEGORY,
        label: category || 'Outro',
    }

    return (
        <span
            className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${config.bg} ${config.text} ${className}`}
        >
            {config.label}
        </span>
    )
}

export { CATEGORY_CONFIG }
export type { CategoryType }

  </file>
  <file name='src\components\ui\LoadingSpinner.tsx'>
type LoadingSpinnerProps = {
    /** Mensagem exibida ao lado do spinner */
    message?: string
    /** Tamanho do spinner */
    size?: 'sm' | 'md' | 'lg'
}

const sizeClasses = {
    sm: 'h-6 w-6',
    md: 'h-10 w-10',
    lg: 'h-14 w-14',
}

/**
 * Componente de loading spinner reutilizÃ¡vel.
 * MantÃ©m o mesmo visual usado nas pÃ¡ginas do dashboard.
 */
export default function LoadingSpinner({ message = 'Carregando...', size = 'md' }: LoadingSpinnerProps) {
    const spinnerSize = sizeClasses[size]

    return (
        <div className="flex items-center justify-center gap-4 py-12">
            <div className="relative">
                <div className={`${spinnerSize} rounded-full border-2 border-accent-pool/20`} />
                <div className={`absolute inset-0 ${spinnerSize} rounded-full border-2 border-transparent border-t-accent-pool animate-spin`} />
            </div>
            <span className="text-sm text-fg-secondary">{message}</span>
        </div>
    )
}

  </file>
  <file name='src\components\ui\MobileToggle.tsx'>
type MobileToggleProps = {
    isOpen: boolean
    onToggle: () => void
}

export function MobileToggle({ isOpen, onToggle }: MobileToggleProps) {
    return (
        <div className="md:hidden fixed z-[60] top-4 left-4">
            <button
                onClick={onToggle}
                className="p-2 rounded-xl bg-bg-secondary/80 backdrop-blur-md border border-white/10 shadow-lg text-fg-primary"
            >
                {isOpen ? (
                    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                ) : (
                    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                )}
            </button>
        </div>
    )
}

  </file>
  <file name='src\components\ui\Modal.tsx'>
import { useCallback, useEffect, useRef } from 'react'
import type { PropsWithChildren } from 'react'

type Props = PropsWithChildren<{
  title?: string
  onClose: () => void
}>

export default function Modal({ title, onClose, children }: Props) {
  const panelRef = useRef<HTMLDivElement | null>(null)

  const requestClose = useCallback(() => {
    // Tenta evitar prompts de senha/credenciais limpando campos sensÃ­veis antes de navegar.
    const panel = panelRef.current
    if (panel) {
      const inputs = Array.from(panel.querySelectorAll('input')) as HTMLInputElement[]
      for (const input of inputs) {
        const name = (input.getAttribute('name') ?? '').toLowerCase()
        const autoComplete = (input.getAttribute('autocomplete') ?? '').toLowerCase()
        const type = (input.getAttribute('type') ?? '').toLowerCase()

        const looksSensitive =
          type === 'password' ||
          name.includes('senha') ||
          name.includes('password') ||
          autoComplete.includes('password')

        if (!looksSensitive) continue

        try {
          input.value = ''
          input.dispatchEvent(new Event('input', { bubbles: true }))
          input.dispatchEvent(new Event('change', { bubbles: true }))
        } catch {
          // ignora
        }
      }
    }

    // chama apÃ³s limpar, para dar chance do React processar eventos
    setTimeout(() => onClose(), 0)
  }, [onClose])

  useEffect(() => {
    const onKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'Escape') requestClose()
    }

    window.addEventListener('keydown', onKeyDown)
    return () => window.removeEventListener('keydown', onKeyDown)
  }, [requestClose])

  useEffect(() => {
    // foco bÃ¡sico no painel
    panelRef.current?.focus()
  }, [])

  return (
    <div
      className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm"
      role="dialog"
      aria-modal="true"
      aria-label={title ?? 'Janela'}
      onMouseDown={(e) => {
        // fechar ao clicar fora do painel
        if (e.target === e.currentTarget) requestClose()
      }}
    >
      <div
        ref={panelRef}
        tabIndex={-1}
        className="relative w-full max-w-md rounded-2xl border border-white/10 bg-bg-secondary p-6 shadow-[0_1.5rem_3.75rem_rgba(0,0,0,0.65)] focus:outline-none"
      >
        <button
          type="button"
          onClick={requestClose}
          aria-label="Fechar"
          className="absolute right-3 top-3 inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/10 bg-white/5 text-red-400 hover:bg-white/10 hover:text-red-300"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M18 6 6 18M6 6l12 12"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
            />
          </svg>
        </button>

        {children}
      </div>
    </div>
  )
}

  </file>
  <file name='src\components\ui\PageHeader.tsx'>
import type { ReactNode } from 'react'

type PageHeaderProps = {
    /** TÃ­tulo principal da pÃ¡gina */
    title: string
    /** DescriÃ§Ã£o opcional abaixo do tÃ­tulo */
    description?: string
    /** BotÃµes de aÃ§Ã£o ou outros elementos Ã  direita */
    children?: ReactNode
}

/**
 * Componente de cabeÃ§alho de pÃ¡gina reutilizÃ¡vel.
 * MantÃ©m o layout padrÃ£o: tÃ­tulo + descriÃ§Ã£o Ã  esquerda, aÃ§Ãµes Ã  direita.
 */
export default function PageHeader({ title, description, children }: PageHeaderProps) {
    return (
        <header className="flex flex-wrap items-center justify-between gap-4">
            <div>
                <h1 className="titulo-grafico text-2xl font-bold">{title}</h1>
                {description && (
                    <p className="mt-1 text-sm text-fg-secondary">{description}</p>
                )}
            </div>
            {children}
        </header>
    )
}

  </file>
  <file name='src\components\ui\SensitiveValue.tsx'>
import { usePreferences } from '../../hooks/usePreferences'

type SensitiveValueProps = {
    /** O valor real para exibir (ou ocultar) */
    children: React.ReactNode
    /** Opcional: placeholder personalizado quando oculto (padrÃ£o: "â€¢â€¢â€¢â€¢â€¢â€¢") */
    placeholder?: string
    /** Opcional: classes CSS adicionais */
    className?: string
}


export default function SensitiveValue({
    children,
    placeholder = 'â€¢â€¢â€¢â€¢â€¢â€¢',
    className = '',
}: SensitiveValueProps) {
    const { preferences } = usePreferences()

    if (preferences.hideValues) {
        return (
            <span className={`select-none ${className}`} aria-label="Valor oculto">
                {placeholder}
            </span>
        )
    }

    return <>{children}</>
}

  </file>
  <file name='src\components\ui\StatusBadge.tsx'>
import type { StatusMovimentacaoEnum } from '../../interfaces/enums'

export type StatusType = 'PENDENTE' | 'CREDITADO' | 'EXPIRADO' | 'CANCELADO' | StatusMovimentacaoEnum | string

type StatusConfig = {
    label: string
    bg: string
    text: string
    border: string
    dot: string
}

const STATUS_CONFIG: Record<string, StatusConfig> = {
    CREDITADO: {
        label: 'Creditado',
        bg: 'bg-emerald-500/10',
        text: 'text-emerald-400',
        border: 'border-emerald-500/30',
        dot: 'bg-emerald-400',
    },
    PENDENTE: {
        label: 'Pendente',
        bg: 'bg-amber-500/10',
        text: 'text-amber-400',
        border: 'border-amber-500/30',
        dot: 'bg-amber-400',
    },
    EXPIRADO: {
        label: 'Expirado',
        bg: 'bg-red-500/10',
        text: 'text-red-400',
        border: 'border-red-500/30',
        dot: 'bg-red-400',
    },
    CANCELADO: {
        label: 'Cancelado',
        bg: 'bg-gray-500/10',
        text: 'text-gray-400',
        border: 'border-gray-500/30',
        dot: 'bg-gray-400',
    },
}

const DEFAULT_STATUS: StatusConfig = STATUS_CONFIG.PENDENTE

/**
 * FunÃ§Ã£o auxiliar para extrair string de status de vÃ¡rios formatos
 */
function getStatusString(status: StatusType | { status?: string } | undefined): string {
    if (!status) return 'PENDENTE'
    if (typeof status === 'string') return status.toUpperCase()
    if (typeof status === 'object' && 'status' in status) {
        return (status.status ?? 'PENDENTE').toUpperCase()
    }
    return 'PENDENTE'
}

type StatusBadgeProps = {
    /** O valor do status - pode ser uma string ou um objeto com uma propriedade status */
    status: StatusType | { status?: string } | undefined
    /** className opcional para estilizaÃ§Ã£o adicional */
    className?: string
    /** Variante de tamanho */
    size?: 'sm' | 'md'
    /** Pontos calculados - quando negativo e status CREDITADO, mostra vermelho */
    pontosCalculados?: number
}

/**
 * Componente StatusBadge para exibir indicadores de status com cores semÃ¢nticas.
 * 
 * @example
 * // Com status string
 * <StatusBadge status="CREDITADO" />
 * 
 * @example
 * // Com status objeto
 * <StatusBadge status={{ status: 'PENDENTE' }} />
 */
export default function StatusBadge({ status, className = '', size = 'sm', pontosCalculados }: StatusBadgeProps) {
    const statusKey = getStatusString(status)
    let config = STATUS_CONFIG[statusKey] ?? DEFAULT_STATUS

    // When CREDITADO but points are negative (redemption), use red styling
    if (statusKey === 'CREDITADO' && pontosCalculados !== undefined && pontosCalculados < 0) {
        config = {
            ...config,
            bg: 'bg-red-500/10',
            text: 'text-red-400',
            border: 'border-red-500/30',
            dot: 'bg-red-400',
        }
    }

    const sizeClasses = {
        sm: 'px-2 py-0.5 text-[0.625rem]',
        md: 'px-2.5 py-1 text-xs',
    }

    const dotSizeClasses = {
        sm: 'h-1.5 w-1.5',
        md: 'h-2 w-2',
    }

    return (
        <span
            className={`inline-flex items-center gap-1.5 rounded-full font-medium border ${config.bg} ${config.text} ${config.border} ${sizeClasses[size]} ${className}`}
        >
            <span className={`rounded-full ${config.dot} ${dotSizeClasses[size]}`} />
            {config.label}
        </span>
    )
}

// Exporta config para uso em cards de estatÃ­sticas
export { STATUS_CONFIG, getStatusString }
export type { StatusConfig }

  </file>
  <file name='src\components\ui\TabButton.tsx'>
type TabButtonProps = {
    active: boolean
    onClick: () => void
    children: React.ReactNode
    count?: number
}

export default function TabButton({ active, onClick, children, count }: TabButtonProps) {
    return (
        <button
            type="button"
            onClick={onClick}
            className={`relative px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${active
                ? 'bg-gradient-to-r from-accent-sky/10 to-accent-pool/10 text-accent-pool border border-accent-pool/30'
                : 'text-fg-secondary hover:text-fg-primary hover:bg-white/5'
                }`}
        >
            {children}
            {count !== undefined && (
                <span
                    className={`ml-2 px-1.5 py-0.5 text-xs rounded-full ${active ? 'bg-accent-pool/20 text-accent-pool' : 'bg-white/10 text-fg-secondary'
                        }`}
                >
                    {count}
                </span>
            )}
        </button>
    )
}

  </file>
  <file name='src\components\ui\Toggle.tsx'>


interface ToggleProps {
    enabled: boolean
    onToggle: () => void
    label: string
    description?: string
}

export function Toggle({ enabled, onToggle, label, description }: ToggleProps) {
    return (
        <div className="flex items-center justify-between gap-4 py-3">
            <div className="flex-1">
                <span className="text-sm font-medium text-fg-primary">{label}</span>
                {description && (
                    <p className="mt-0.5 text-xs text-fg-secondary">{description}</p>
                )}
            </div>
            <button
                type="button"
                role="switch"
                aria-checked={enabled}
                onClick={onToggle}
                className={`relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-accent-pool/50 ${enabled ? 'bg-gradient-to-r from-accent-sky to-accent-pool' : 'bg-white/10'
                    }`}
            >
                <span
                    className={`inline-block h-4 w-4 transform rounded-full bg-white shadow-lg transition-transform duration-300 ${enabled ? 'translate-x-6' : 'translate-x-1'
                        }`}
                />
            </button>
        </div>
    )
}

  </file>
</codebase>
